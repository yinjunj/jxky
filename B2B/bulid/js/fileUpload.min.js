~(function(d){var c='<form id="form"><input type="file" name="file" id="" class="imgFiles" style="display: none" accept="image/gif,image/jpeg,image/jpg,image/png,image/svg" multiple><div class="header">    <span class="imgTitle">        上传图片    </span>    <span class="imgClick">       <span style="background: #f5f5f5;padding: 0 5px;" class="hoverRed">选择图片</span>    </span>    <span class="imgcontent">        选择图片    </span></div><div class="imgAll">    <ul>    </ul></div></form>';var f=function(i,h){var j=this;this.bom=document.querySelector(i);if(h){h.call(j)}this.ready()};f.prototype={init:function(h){this.MAX=h.MAX||5;this.callback=h.callback;this.MW=h.MW||10000;this.MH=h.MH||10000},ready:function(){var h=this;this.dom=document.createElement("div");this.dom.className="imgFileUploade";this.dom.innerHTML=c;this.bom.appendChild(this.dom);this.files=this.bom.querySelector(".imgFiles");this.fileClick=this.bom.querySelector(".imgClick");this.fileBtn(this.fileClick,this.files);this.imgcontent=this.bom.querySelector(".imgcontent");this.imgcontent.innerHTML='可最多上传<b style="color:red">'+this.MAX+"</b>张图片"},fileBtn:function(k,j){var h=this;var i=$(k).parent().parent().find(".imgAll ul");$(k).off().on("click",function(){$(j).click();$(j).off().on("change",function(){var n=this;var l="https://img.aiucar.cn/";var m=$(n);$.ajax({url:"/api/oss/get.php?dir=fk",type:"get",async:false,dataType:"json",success:function(o){var s=document.getElementById("form");var t=new FormData;var v=new FormData(s);var u=new Date();var p=u.getTime()+""+Math.random()*100000000000000000;var q=m.attr("name");t.set("key",o.dir+p+".jpg");t.set("policy",o.policy);t.set("OSSAccessKeyId",o.accessid);t.set("success_action_status","200");t.set("expire",o.expire);t.set("host",o.host);t.set("Signature",o.signature);t.append("file",v.get(q));var r=new XMLHttpRequest();r.open("POST",l);r.send(t);r.onreadystatechange=function(){if(r.readyState==4&&r.status==200){newSrc=o.dir+p+".jpg";g.startUploadImg(i,n.files,h.MAX,h.callback,h.MW,h.MH,newSrc)}}}})})})}};var a=[];var g={startUploadImg:function(j,h,n,w,l,u,p){a.length=0;var t=this;var k=[];if(h.length>n){alert("上传数量不能大于"+n+"张");return false}var s=$(j).find("li").length;if(s>=n){alert("上传数量不能大于"+n+"张");return false}for(var q=0,m;m=h[q++];){var r=new FileReader();r.onload=(function(i){return function(o){var x=new Image();x.onload=function(){var z=x.width;var y=x.height;k.push({fileSrc:o.target.result,fileName:i.name,fileSize:i.size,height:y,width:z})};x.src=o.target.result}})(m);r.readAsDataURL(m)}var v=t.timeChunk(k,function(o){if(o.width>l||o.height>u){alert("上传图片不能大于"+l+"*"+u+"像素");return false}var i=new e(j,o.fileName,o.fileSrc,o.fileSize,w,p);i.init()},1);v()},timeChunk:function(i,k,l){var m,j;var h=i.length;var n=function(){for(var o=0;o<Math.min(l||1,i.length);o++){var p=i.shift();k(p)}};return function(){j=setInterval(function(){if(i.length===0){return clearInterval(j)}n()},200)}}};var e=function(h,i,k,j,m,l){this.b=h;this.newsrc=l;this.imgName=i;this.imgSize=j;this.imgSrc=k;this.callback=m};var b=1;e.prototype.init=function(){b++;var h=this;this.dom=document.createElement("li");this.dom.innerHTML='    <img src="img/login.gif" alt="" value="'+this.newsrc+'" data-src="'+this.imgSrc+'" class="imsg">    <i class="delImg">        X    </i>';$(this.dom).attr({"data-delId":b,"data-delName":this.imgName});$(this.b).append(this.dom);var o=new Image();o.src=$(this.dom).find("img").attr("data-src");o.onload=function(){$(h.dom).find("img").attr("src",o.src)};a.push({delId:b,src:this.imgSrc});h.callback(a);var l=$(this.b).find(".delImg");for(var m=0;m<l.length;m++){$(l[m]).off().on("click",function(){$(this).parent().fadeOut("slow",function(){$(this).remove()});var i=$(this).parent().attr("data-delId");for(var k=0;k<a.length;k++){if(a[k].delId==i){a.splice(k,1)}}h.callback(a)})}var n=$(this.b).find("img");for(var j=0;j<n.length;j++){$(n[j]).off().on("click",function(){console.log($(this).attr("src"))})}};d.ImgUploadeFiles=f})(window);