~(function(m){var n='<form id="form"><input type="file" name="file" id="" class="imgFiles" style="display: none" accept="image/gif,image/jpeg,image/jpg,image/png,image/svg" multiple><div class="header">    <span class="imgTitle">        上传图片    </span>    <span class="imgClick">       <span style="background: #f5f5f5;padding: 0 5px;" class="hoverRed">选择图片</span>    </span>    <span class="imgcontent">        选择图片    </span></div><div class="imgAll">    <ul>    </ul></div></form>';var k=function(b,c){var a=this;this.bom=document.querySelector(b);if(c){c.call(a)}this.ready()};k.prototype={init:function(a){this.MAX=a.MAX||5;this.callback=a.callback;this.MW=a.MW||10000;this.MH=a.MH||10000},ready:function(){var a=this;this.dom=document.createElement("div");this.dom.className="imgFileUploade";this.dom.innerHTML=n;this.bom.appendChild(this.dom);this.files=this.bom.querySelector(".imgFiles");this.fileClick=this.bom.querySelector(".imgClick");this.fileBtn(this.fileClick,this.files);this.imgcontent=this.bom.querySelector(".imgcontent");this.imgcontent.innerHTML='可最多上传<b style="color:red">'+this.MAX+"</b>张图片"},fileBtn:function(a,b){var d=this;var c=$(a).parent().parent().find(".imgAll ul");$(a).off().on("click",function(){$(b).click();$(b).off().on("change",function(){var g=this;var f="https://img.aiucar.cn/";var e=$(g);$.ajax({url:"/api/oss/get.php?dir=fk",type:"get",async:false,dataType:"json",success:function(D){var z=document.getElementById("form");var y=new FormData;var w=new FormData(z);var x=new Date();var C=x.getTime()+""+Math.random()*100000000000000000;var B=e.attr("name");y.set("key",D.dir+C+".jpg");y.set("policy",D.policy);y.set("OSSAccessKeyId",D.accessid);y.set("success_action_status","200");y.set("expire",D.expire);y.set("host",D.host);y.set("Signature",D.signature);y.append("file",w.get(B));var A=new XMLHttpRequest();A.open("POST",f);A.send(y);A.onreadystatechange=function(){if(A.readyState==4&&A.status==200){newSrc=D.dir+C+".jpg";j.startUploadImg(c,g.files,d.MAX,d.callback,d.MW,d.MH,newSrc)}}}})})})}};var i=[];var j={startUploadImg:function(o,x,d,y,f,A,c){i.length=0;var B=this;var g=[];if(x.length>d){alert("上传数量不能大于"+d+"张");return false}var C=$(o).find("li").length;if(C>=d){alert("上传数量不能大于"+d+"张");return false}for(var b=0,e;e=x[b++];){var a=new FileReader();a.onload=(function(p){return function(r){var q=new Image();q.onload=function(){var s=q.width;var t=q.height;g.push({fileSrc:r.target.result,fileName:p.name,fileSize:p.size,height:t,width:s})};q.src=r.target.result}})(e);a.readAsDataURL(e)}var z=B.timeChunk(g,function(q){if(q.width>f||q.height>A){alert("上传图片不能大于"+f+"*"+A+"像素");return false}var p=new l(o,q.fileName,q.fileSrc,q.fileSize,y,c);p.init()},1);z()},timeChunk:function(e,c,b){var a,d;var f=e.length;var g=function(){for(var r=0;r<Math.min(b||1,e.length);r++){var q=e.shift();c(q)}};return function(){d=setInterval(function(){if(e.length===0){return clearInterval(d)}g()},200)}}};var l=function(f,e,c,d,a,b){this.b=f;this.newsrc=b;this.imgName=e;this.imgSize=d;this.imgSrc=c;this.callback=a};var h=1;l.prototype.init=function(){h++;var d=this;this.dom=document.createElement("li");this.dom.innerHTML='    <img src="img/login.gif" alt="" value="'+this.newsrc+'" data-src="'+this.imgSrc+'" class="imsg">    <i class="delImg">        X    </i>';$(this.dom).attr({"data-delId":h,"data-delName":this.imgName});$(this.b).append(this.dom);var e=new Image();e.src=$(this.dom).find("img").attr("data-src");e.onload=function(){$(d.dom).find("img").attr("src",e.src)};i.push({delId:h,src:this.imgSrc});d.callback(i);var b=$(this.b).find(".delImg");for(var a=0;a<b.length;a++){$(b[a]).off().on("click",function(){$(this).parent().fadeOut("slow",function(){$(this).remove()});var o=$(this).parent().attr("data-delId");for(var g=0;g<i.length;g++){if(i[g].delId==o){i.splice(g,1)}}d.callback(i)})}var f=$(this.b).find("img");for(var c=0;c<f.length;c++){$(f[c]).off().on("click",function(){console.log($(this).attr("src"))})}};m.ImgUploadeFiles=k})(window);