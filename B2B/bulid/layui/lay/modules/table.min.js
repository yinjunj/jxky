layui.define(["laytpl","laypage","layer","form"],function(ad){var L=layui.$,Z=layui.laytpl,ah=layui.laypage,X=layui.layer,V=layui.form,U=layui.hint(),P=layui.device(),ae={config:{checkName:"LAY_CHECKED",indexName:"LAY_TABLE_INDEX"},cache:{},index:layui.table?layui.table.index+10000:0,set:function(b){var a=this;return a.config=L.extend({},a.config,b),a},on:function(b,a){return layui.onevent.call(this,M,b,a)}},af=function(){var c=this,b=c.config,a=b.id;return a&&(af.config[a]=b),{reload:function(d){c.reload.call(c,d)},config:b}},M="table",K=".layui-table",ac="layui-hide",aa="layui-table-view",E=".layui-table-header",R=".layui-table-body",W=".layui-table-main",I=".layui-table-fixed",ab=".layui-table-fixed-l",G=".layui-table-fixed-r",ag=".layui-table-tool",Y=".layui-table-sort",H="layui-table-edit",O="layui-table-hover",D=function(a){return a=a||{},['<table cellspacing="0" cellpadding="0" border="0" class="layui-table" ','{{# if(d.data.skin){ }}lay-skin="{{d.data.skin}}"{{# } }} {{# if(d.data.size){ }}lay-size="{{d.data.size}}"{{# } }} {{# if(d.data.even){ }}lay-even{{# } }}>',"<thead>","{{# layui.each(d.data.cols, function(i1, item1){ }}","<tr>","{{# layui.each(item1, function(i2, item2){ }}",'{{# if(item2.fixed && item2.fixed !== "right"){ left = true; } }}','{{# if(item2.fixed === "right"){ right = true; } }}',function(){return a.fixed&&"right"!==a.fixed?'{{# if(item2.fixed && item2.fixed !== "right"){ }}':"right"===a.fixed?'{{# if(item2.fixed === "right"){ }}':""}(),"{{# if(item2.checkbox){ }}",'<th data-field="{{ item2.field||i2 }}" data-type="checkbox" {{#if(item2.colspan){}} colspan="{{item2.colspan}}"{{#} if(item2.rowspan){}} rowspan="{{item2.rowspan}}"{{#}}} unresize="true"><div class="layui-table-cell laytable-cell-checkbox"><input type="checkbox" name="layTableCheckbox" lay-skin="primary" lay-filter="layTableAllChoose" {{# if(item2[d.data.checkName]){ }}checked{{# }; }}></div></th>',"{{# } else if(item2.space){ }}",'<th data-field="{{ item2.field||i2 }}" {{#if(item2.colspan){}} colspan="{{item2.colspan}}"{{#} if(item2.rowspan){}} rowspan="{{item2.rowspan}}"{{#}}} unresize="true"><div class="layui-table-cell laytable-cell-space"></div></th>',"{{# } else { }}",'<th data-field="{{ item2.field||i2 }}" {{#if(item2.colspan){}} colspan="{{item2.colspan}}"{{#} if(item2.rowspan){}} rowspan="{{item2.rowspan}}"{{#}}} {{# if(item2.unresize){ }}unresize="true"{{# } }}>',"{{# if(item2.colspan > 1){ }}",'<div class="layui-table-cell laytable-cell-group" {{#if(item2.align){}}align="{{item2.align}}"{{#}}}>','<span>{{item2.title||""}}</span>',"</div>","{{# } else { }}",'<div class="layui-table-cell laytable-cell-{{d.index}}-{{item2.field||i2}}" {{#if(item2.align){}}align="{{item2.align}}"{{#}}}>','<span>{{item2.title||""}}</span>',"{{# if(item2.sort){ }}",'<span class="layui-table-sort layui-inline"><i class="layui-edge layui-table-sort-asc"></i><i class="layui-edge layui-table-sort-desc"></i></span>',"{{# } }}","</div>","{{# } }}","</th>","{{# }; }}",a.fixed?"{{# }; }}":"","{{# }); }}","</tr>","{{# }); }}","</thead>","</table>"].join("")},J=['<table cellspacing="0" cellpadding="0" border="0" class="layui-table" ','{{# if(d.data.skin){ }}lay-skin="{{d.data.skin}}"{{# } }} {{# if(d.data.size){ }}lay-size="{{d.data.size}}"{{# } }} {{# if(d.data.even){ }}lay-even{{# } }}>',"<tbody></tbody>","</table>"].join(""),B=['<div class="layui-form layui-border-box {{d.VIEW_CLASS}}" lay-filter="LAY-table-{{d.index}}" style="{{# if(d.data.width){ }}width:{{d.data.width}}px;{{# } }} {{# if(d.data.height){ }}height:{{d.data.height}}px;{{# } }}">',"{{# var left, right; }}",'<div class="layui-table-header">',D(),"</div>",'<div class="layui-table-body layui-table-main">',J,"</div>","{{# if(left){ }}",'<div class="layui-table-fixed layui-table-fixed-l">','<div class="layui-table-header">',D({fixed:!0}),"</div>",'<div class="layui-table-body">',J,"</div>","</div>","{{# }; }}","{{# if(right){ }}",'<div class="layui-table-fixed layui-table-fixed-r">','<div class="layui-table-header">',D({fixed:"right"}),'<div class="layui-table-mend"></div>',"</div>",'<div class="layui-table-body">',J,"</div>","</div>","{{# }; }}","{{# if(d.data.page){ }}",'<div class="layui-table-tool">','<div class="layui-inline layui-table-page" id="layui-table-page{{d.index}}"></div>',"</div>","{{# } }}","<style>","{{# layui.each(d.data.cols, function(i1, item1){","layui.each(item1, function(i2, item2){ }}",".laytable-cell-{{d.index}}-{{item2.field||i2}}{ width:{{item2.width||50}}px }","{{# });","}); }}","</style>","</div>"].join(""),j=L(window),q=L(document),Q=function(b){var a=this;a.index=++ae.index,a.config=L.extend({},a.config,ae.config,b),a.render()};Q.prototype.config={limit:30,loading:!0},Q.prototype.render=function(g){var c,b=this;if(g&&(b.config=g),c=b.config,c.elem=L(c.elem),c.where=c.where||{},c.request=L.extend({pageName:"page",limitName:"limit"},c.request),c.response=L.extend({statusName:"code",statusCode:0,msgName:"msg",dataName:"data",countName:"count"},c.response),!c.elem[0]){return b}var k=c.elem,i=k.next("."+aa);c.height&&/^full-\d+$/.test(c.height)&&(b.fullHeightGap=c.height.split("-")[1],c.height=j.height()-b.fullHeightGap);var f=b.elem=L(Z(B).render({VIEW_CLASS:aa,data:c,index:b.index}));if(c.index=b.index,i[0]&&i.remove(),k.after(f),b.layHeader=f.find(E),b.layMain=f.find(W),b.layBody=f.find(R),b.layFixed=f.find(I),b.layFixLeft=f.find(ab),b.layFixRight=f.find(G),b.layTool=f.find(ag),c.height&&b.fullSize(),c.cols.length>1){var h=b.layFixed.find(E).find("th");h.height(b.layHeader.height()-1-parseFloat(h.css("padding-top"))-parseFloat(h.css("padding-bottom")))}b.pullData(1),b.events()},Q.prototype.reload=function(b){var a=this;a.config=L.extend({},a.config,b),a.render()},Q.prototype.pullData=function(k,h){var p=this,g=p.config,f=g.request,b=g.response,l=function(){"object"==typeof g.initSort&&p.sort(g.initSort.field,g.initSort.type)};if(g.url){var m={};m[f.pageName]=k,m[f.limitName]=g.limit,L.ajax({type:g.method||"get",url:g.url,data:L.extend(m,g.where),dataType:"json",success:function(a){return a[b.statusName]!=b.statusCode?(p.renderForm(),p.layMain.html('<div class="layui-none">'+(a[b.msgName]||"返回的数据状态异常")+"</div>")):(p.renderData(a,k,a[b.countName]),l(),h&&X.close(h),void ("function"==typeof g.done&&g.done(a,k,a[b.countName])))},error:function(c,a){p.layMain.html('<div class="layui-none">数据接口请求异常</div>'),p.renderForm(),h&&X.close(h)}})}else{if(g.data&&g.data.constructor===Array){var v={},t=k*g.limit-g.limit;v[b.dataName]=g.data.concat().splice(t,g.limit),v[b.countName]=g.data.length,p.renderData(v,k,g.data.length),l(),"function"==typeof g.done&&g.done(v,k,v[b.countName])}}},Q.prototype.page=1,Q.prototype.eachCols=function(a){layui.each(this.config.cols,function(c,b){layui.each(b,function(e,d){a(e,d,[c,b])})})},Q.prototype.renderData=function(l,g,d,a){var m=this,w=m.config,v=l[w.response.dataName]||[],k=[],i=[],t=[],b=function(){return !a&&m.sortKey?m.sort(m.sortKey.field,m.sortKey.sort,!0):(layui.each(v,function(h,f){var c=[],r=[],p=[];0!==f.length&&(a||(f[ae.config.indexName]=h),m.eachCols(function(s,o){var x=f[o.field||s];if(void 0!==x&&null!==x||(x=""),!(o.colspan>1)){var n=['<td data-field="'+(o.field||s)+'"'+function(){var u=[];return o.edit&&u.push(' data-edit="true"'),o.align&&u.push(' align="'+o.align+'"'),o.templet&&u.push(' data-content="'+x+'"'),o.toolbar&&u.push(' data-off="true"'),o.event&&u.push(' lay-event="'+o.event+'"'),o.style&&u.push(' style="'+o.style+'"'),u.join("")}()+">",'<div class="layui-table-cell laytable-cell-'+function(){return o.checkbox?"checkbox":o.space?"space":w.index+"-"+(o.field||s)}()+'">'+function(){return o.checkbox?'<input type="checkbox" name="layTableCheckbox" lay-skin="primary" '+function(){var u=ae.config.checkName;return o[u]?(f[u]=o[u],o[u]?"checked":""):f[u]?"checked":""}()+">":o.toolbar?Z(L(o.toolbar).html()||"").render(f):o.templet?Z(L(o.templet).html()||String(x)).render(f):x}(),"</div></td>"].join("");c.push(n),o.fixed&&"right"!==o.fixed&&r.push(n),"right"===o.fixed&&p.push(n)}}),k.push('<tr data-index="'+h+'">'+c.join("")+"</tr>"),i.push('<tr data-index="'+h+'">'+r.join("")+"</tr>"),t.push('<tr data-index="'+h+'">'+p.join("")+"</tr>"))}),m.layBody.scrollTop(0),m.layMain.find("tbody").html(k.join("")),m.layFixLeft.find("tbody").html(i.join("")),m.layFixRight.find("tbody").html(t.join("")),m.renderForm(),m.syncCheckAll(),m.haveInit?m.scrollPatch():setTimeout(function(){m.scrollPatch()},50),m.haveInit=!0,void X.close(m.tipsIndex))};return m.key=w.id||w.index,ae.cache[m.key]=v,a?b():0===v.length?(m.renderForm(),m.layFixed.remove(),m.layMain.html('<div class="layui-none">无数据</div>')):(b(),void (w.page&&(m.page=g,m.count=d,ah.render({elem:"layui-table-page"+w.index,count:d,groups:3,limits:w.limits||[10,20,30,40,50,60,70,80,90],limit:w.limit,curr:g,layout:["prev","page","next","skip","count","limit"],prev:'<i class="layui-icon">&#xe603;</i>',next:'<i class="layui-icon">&#xe602;</i>',jump:function(f,c){c||(m.page=f.curr,w.limit=f.limit,m.pullData(f.curr,m.loading()))}}),m.layTool.find(".layui-table-count span").html(d))))},Q.prototype.renderForm=function(a){V.render(a||"checkbox","LAY-table-"+this.index)},Q.prototype.sort=function(t,l,x,g){var b,v,z=this,s=z.config,o=s.elem.attr("lay-filter"),w=ae.cache[z.key];"string"==typeof t&&z.layHeader.find("th").each(function(f,e){var c=L(this),h=c.data("field");if(h===t){return t=c,b=h,!1}});try{var b=b||t.data("field");if(z.sortKey&&!x&&b===z.sortKey.field&&l===z.sortKey.sort){return}var d=z.layHeader.find("th .laytable-cell-"+s.index+"-"+b).find(Y);z.layHeader.find("th").find(Y).removeAttr("lay-sort"),d.attr("lay-sort",l||null),z.layFixed.find("th")}catch(k){return U.error("Table modules: Did not match to field")}z.sortKey={field:b,sort:l},"asc"===l?v=layui.sort(w,b):"desc"===l?v=layui.sort(w,b,!0):(v=layui.sort(w,ae.config.indexName),delete z.sortKey),z.renderData({data:v},z.page,z.count,!0),X.close(z.tipsIndex),g&&layui.event.call(t,M,"sort("+o+")",{field:b,type:l})},Q.prototype.loading=function(){var b=this,a=b.config;if(a.loading&&a.url){return X.msg("数据请求中",{icon:16,offset:[b.elem.offset().top+b.elem.height()/2-35-j.scrollTop()+"px",b.elem.offset().left+b.elem.width()/2-90-j.scrollLeft()+"px"],anim:-1,fixed:!1})}},Q.prototype.setCheckData=function(g,f){var d=this,c=d.config,b=ae.cache[d.key];b[g]&&(b[g][c.checkName]=f)},Q.prototype.syncCheckAll=function(){var f=this,d=f.config,c=f.layHeader.find('input[name="layTableCheckbox"]'),b=function(a){return f.eachCols(function(h,g){g.checkbox&&(g[d.checkName]=a)}),a};c[0]&&(ae.checkStatus(f.key).isAll?(c[0].checked||(c.prop("checked",!0),f.renderForm()),b(!0)):(c[0].checked&&(c.prop("checked",!1),f.renderForm()),b(!1)))},Q.prototype.getCssRule=function(g,f){var d=this,c=d.elem.find("style")[0],b=c.sheet||c.styleSheet,h=b.cssRules||b.rules;layui.each(h,function(i,e){if(e.selectorText===".laytable-cell-"+d.index+"-"+g){return f(e),!0}})},Q.prototype.fullSize=function(){var f,d=this,c=d.config,b=c.height;d.fullHeightGap&&(b=j.height()-d.fullHeightGap,b<135&&(b=135),d.elem.css("height",b)),f=parseFloat(b)-parseFloat(d.layHeader.height())-1,c.page&&(f-=parseFloat(d.layTool.outerHeight()+1)),d.layBody.css("height",f)},Q.prototype.scrollPatch=function(){var f=this,d=f.layMain.children("table"),c=f.layMain.width()-f.layMain.prop("clientWidth"),b=f.layMain.height()-f.layMain.prop("clientHeight");if(c&&b){if(!f.elem.find(".layui-table-patch")[0]){var g=L('<th class="layui-table-patch"><div class="layui-table-cell"></div></th>');g.find("div").css({width:c}),f.layHeader.eq(0).find("thead tr").append(g)}}else{f.layHeader.eq(0).find(".layui-table-patch").remove()}f.layFixed.find(R).css("height",f.layMain.height()-b),f.layFixRight[d.width()>f.layMain.width()?"removeClass":"addClass"](ac),f.layFixRight.css("right",c-1)},Q.prototype.events=function(){var k,b=this,p=b.config,l=L("body"),m={},d=b.layHeader.find("th"),i=".layui-table-cell",g=p.elem.attr("lay-filter");d.on("mousemove",function(n){var h=L(this),f=h.offset().left,c=n.clientX-f;h.attr("colspan")>1||h.attr("unresize")||m.resizeStart||(m.allowResize=h.width()-c<=10,l.css("cursor",m.allowResize?"col-resize":""))}).on("mouseleave",function(){L(this);m.resizeStart||l.css("cursor","")}).on("mousedown",function(c){if(m.allowResize){var a=L(this).data("field");c.preventDefault(),m.resizeStart=!0,m.offset=[c.clientX,c.clientY],b.getCssRule(a,function(f){m.rule=f,m.ruleWidth=parseFloat(f.style.width)})}}),q.on("mousemove",function(c){if(m.resizeStart){if(c.preventDefault(),m.rule){var a=m.ruleWidth+c.clientX-m.offset[0];m.rule.style.width=a+"px",X.close(b.tipsIndex)}k=1}}).on("mouseup",function(a){m.resizeStart&&(m={},l.css("cursor",""),b.scrollPatch()),2===k&&(k=null)}),d.on("click",function(){var c,a=L(this),f=a.find(Y),e=f.attr("lay-sort");return f[0]&&1!==k?(c="asc"===e?"desc":"desc"===e?null:"asc",void b.sort(a,c,null,!0)):k=2}).find(Y+" .layui-edge ").on("click",function(f){var c=L(this),a=c.index(),h=c.parents("th").eq(0).data("field");layui.stope(f),0===a?b.sort(h,"asc",null,!0):b.sort(h,"desc",null,!0)}),b.elem.on("click",'input[name="layTableCheckbox"]+',function(){var f=L(this).prev(),c=b.layBody.find('input[name="layTableCheckbox"]'),a=f.parents("tr").eq(0).data("index"),r=f[0].checked,h="layTableAllChoose"===f.attr("lay-filter");h?(c.each(function(o,n){n.checked=r,b.setCheckData(o,r)}),b.syncCheckAll(),b.renderForm()):(b.setCheckData(a,r),b.syncCheckAll()),layui.event.call(this,M,"checkbox("+g+")",{checked:r,data:ae.cache[b.key][a],type:h?"all":"one"})}),b.layBody.on("mouseenter","tr",function(){var c=L(this),a=c.index();b.layBody.find("tr:eq("+a+")").addClass(O)}).on("mouseleave","tr",function(){var c=L(this),a=c.index();b.layBody.find("tr:eq("+a+")").removeClass(O)}),b.layBody.on("change","."+H,function(){var f=L(this),c=this.value,a=f.parent().data("field"),r=f.parents("tr").eq(0).data("index"),h=ae.cache[b.key][r];h[a]=c,layui.event.call(this,M,"edit("+g+")",{value:c,data:h,field:a})}).on("blur","."+H,function(){var f,a=L(this),s=a.parent().data("field"),h=a.parents("tr").eq(0).data("index"),c=ae.cache[b.key][h];b.eachCols(function(n,e){e.field==s&&e.templet&&(f=e.templet)}),a.siblings(i).html(f?Z(L(f).html()||this.value).render(c):this.value),a.parent().data("content",this.value),a.remove()}),b.layBody.on("click","td",function(){var c=L(this),a=(c.data("field"),c.children(i));if(!c.data("off")){if(c.data("edit")){var f=L('<input class="'+H+'">');return f[0].value=c.data("content")||a.text(),c.find("."+H)[0]||c.append(f),f.focus()}a.prop("scrollWidth")>a.outerWidth()&&(b.tipsIndex=X.tips(['<div class="layui-table-tips-main" style="margin-top: -'+(a.height()+16)+"px;"+function(){return"sm"===p.size?"padding: 4px 15px; font-size: 12px;":"lg"===p.size?"padding: 14px 15px;":""}()+'">',a.html(),"</div>",'<i class="layui-icon layui-table-tips-c">&#x1006;</i>'].join(""),a[0],{tips:[3,""],time:-1,anim:-1,maxWidth:P.ios||P.android?300:600,isOutAnim:!1,skin:"layui-table-tips",success:function(n,h){n.find(".layui-table-tips-c").on("click",function(){X.close(h)})}}))}}),b.layBody.on("click","*[lay-event]",function(){var f=L(this),a=f.parents("tr").eq(0).data("index"),s=b.layBody.find('tr[data-index="'+a+'"]'),h="layui-table-click",c=ae.cache[b.key][a];layui.event.call(this,M,"tool("+g+")",{data:ae.clearCacheKey(c),event:f.attr("lay-event"),tr:s,del:function(){ae.cache[b.key][a]=[],s.remove(),b.scrollPatch()},update:function(n){n=n||{},layui.each(n,function(t,r){if(t in c){var u;c[t]=r,b.eachCols(function(o,e){e.field==t&&e.templet&&(u=e.templet)}),s.children('td[data-field="'+t+'"]').children(i).html(u?Z(L(u).html()||r).render(c):r)}})}}),s.addClass(h).siblings("tr").removeClass(h)}),b.layMain.on("scroll",function(){var c=L(this),a=c.scrollLeft(),f=c.scrollTop();b.layHeader.scrollLeft(a),b.layFixed.find(R).scrollTop(f),X.close(b.tipsIndex)}),j.on("resize",function(){b.fullSize(),b.scrollPatch()})},ae.init=function(f,d){d=d||{};var c=this,b=L(f?'table[lay-filter="'+f+'"]':K+"[lay-data]"),g="Table element property lay-data configuration item has a syntax error: ";return b.each(function(){var h=L(this),e=h.attr("lay-data");try{e=new Function("return "+e)()}catch(k){U.error(g+e)}var m=[],i=L.extend({elem:this,cols:[],data:[],skin:h.attr("lay-skin"),size:h.attr("lay-size"),even:"string"==typeof h.attr("lay-even")},ae.config,d,e);f&&h.hide(),h.find("thead>tr").each(function(a){i.cols[a]=[],L(this).children().each(function(p){var o=L(this),n=o.attr("lay-data");try{n=new Function("return "+n)()}catch(s){return U.error(g+n)}var t=L.extend({title:o.text(),colspan:o.attr("colspan"),rowspan:o.attr("rowspan")},n);m.push(t),i.cols[a].push(t)})}),h.find("tbody>tr").each(function(o){var n=L(this),l={};n.children("td").each(function(r,p){var a=L(this),s=a.data("field");if(s){return l[s]=a.html()}}),layui.each(m,function(r,p){var a=n.children("td").eq(r);l[p.field]=a.html()}),i.data[o]=l}),ae.render(i)}),c},ae.checkStatus=function(f){var d=0,c=[],b=ae.cache[f];return b?(layui.each(b,function(h,g){g[ae.config.checkName]&&(d++,c.push(ae.clearCacheKey(g)))}),{data:c,isAll:d===b.length}):{}},af.config={},ae.reload=function(d,c){var b=af.config[d];return b?ae.render(L.extend({},b,c)):U.error("The ID option was not found in the table instance")},ae.render=function(b){var a=new Q(b);return af.call(a)},ae.clearCacheKey=function(a){return a=L.extend({},a),delete a[ae.config.checkName],delete a[ae.config.indexName],a},ae.init(),ad(M,ae)});