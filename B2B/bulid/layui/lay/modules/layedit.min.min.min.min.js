layui.define(["layer","form"],function(y){var e=layui.$,i=layui.layer,a=layui.form,l=(layui.hint(),layui.device()),p="layedit",r="layui-show",u="layui-disabled",c=function(){var j=this;j.index=0,j.config={tool:["strong","italic","underline","del","|","left","center","right","|","link","unlink","face","image"],hideTool:[],height:280}};c.prototype.set=function(q){var j=this;return e.extend(!0,j.config,q),j},c.prototype.on=function(j,q){return layui.onevent(p,j,q)},c.prototype.build=function(z,G){G=G||{};var B=this,j=B.config,q="layui-layedit",H=e("#"+z),A="LAY_layedit_"+ ++B.index,D=H.next("."+q),E=e.extend({},j,G),F=function(){var K=[],J={};return layui.each(E.hideTool,function(M,L){J[L]=!0}),layui.each(E.tool,function(M,L){v[L]&&!J[L]&&K.push(v[L])}),K.join("")}(),I=e(['<div class="'+q+'">','<div class="layui-unselect layui-layedit-tool">'+F+"</div>",'<div class="layui-layedit-iframe">','<iframe id="'+A+'" name="'+A+'" textarea="'+z+'" frameborder="0"></iframe>',"</div>","</div>"].join(""));return l.ie&&l.ie<8?H.removeClass("layui-hide").addClass(r):(D[0]&&D.remove(),w.call(B,I,H[0],E),H.addClass("layui-hide").after(I),B.index)},c.prototype.getContent=function(j){var q=x(j);if(q[0]){return d(q[0].document.body.innerHTML)}},c.prototype.getText=function(q){var j=x(q);if(j[0]){return e(j[0].document.body).text()}},c.prototype.setContent=function(A,z,q){var j=x(A);j[0]&&(q?e(j[0].document.body).append(z):e(j[0].document.body).html(z),layedit.sync(A))},c.prototype.sync=function(j){var z=x(j);if(z[0]){var q=e("#"+z[1].attr("textarea"));q.val(d(z[0].document.body.innerHTML))}},c.prototype.getSelection=function(q){var z=x(q);if(z[0]){var j=o(z[0].document);return document.selection?j.text:j.toString()}};var w=function(A,q,z){var j=this,B=A.find("iframe");B.css({height:z.height}).on("load",function(){var F=B.contents(),G=B.prop("contentWindow"),E=F.find("head"),H=e(["<style>","*{margin: 0; padding: 0;}","body{padding: 10px; line-height: 20px; overflow-x: hidden; word-wrap: break-word; font: 14px Helvetica Neue,Helvetica,PingFang SC,Microsoft YaHei,Tahoma,Arial,sans-serif; -webkit-box-sizing: border-box !important; -moz-box-sizing: border-box !important; box-sizing: border-box !important;}","a{color:#01AAED; text-decoration:none;}a:hover{color:#c00}","p{margin-bottom: 10px;}","img{display: inline-block; border: none; vertical-align: middle;}","pre{margin: 10px 0; padding: 10px; line-height: 20px; border: 1px solid #ddd; border-left-width: 6px; background-color: #F2F2F2; color: #333; font-family: Courier New; font-size: 12px;}","</style>"].join("")),D=F.find("body");E.append(H),D.attr("contenteditable","true").css({"min-height":z.height}).html(q.value||""),t.apply(j,[G,B,q,z]),g.call(j,G,A,z)})},x=function(j){var z=e("#LAY_layedit_"+j),q=z.prop("contentWindow");return[q,z]},d=function(j){return 8==l.ie&&(j=j.replace(/<.+>/g,function(q){return q.toLowerCase()})),j},t=function(B,j,D,q){var z=B.document,A=e(z.body);A.on("keydown",function(F){var E=F.keyCode;if(13===E){var G=o(z),I=s(G),H=I.parentNode;if("pre"===H.tagName.toLowerCase()){if(F.shiftKey){return}return i.msg("请暂时用shift+enter"),!1}z.execCommand("formatBlock",!1,"<p>")}}),e(D).parents("form").on("submit",function(){var E=A.html();8==l.ie&&(E=E.replace(/<.+>/g,function(F){return F.toLowerCase()})),D.value=E}),A.on("paste",function(E){z.execCommand("formatBlock",!1,"<p>"),setTimeout(function(){f.call(B,A),D.value=A.html()},100)})},f=function(q){var j=this;j.document;q.find("*[style]").each(function(){var z=this.style.textAlign;this.removeAttribute("style"),e(this).css({"text-align":z||""})}),q.find("table").addClass("layui-table"),q.find("script,link").remove()},o=function(j){return j.selection?j.selection.createRange():j.getSelection().getRangeAt(0)},s=function(j){return j.endContainer||j.parentElement().childNodes[0]},C=function(z,B,D){var j=this.document,E=document.createElement(z);for(var A in B){E.setAttribute(A,B[A])}if(E.removeAttribute("text"),j.selection){var q=D.text||B.text;if("a"===z&&!q){return}q&&(E.innerHTML=q),D.pasteHTML(e(E).prop("outerHTML")),D.select()}else{var q=D.toString()||B.text;if("a"===z&&!q){return}q&&(E.innerHTML=q),D.deleteContents(),D.insertNode(E)}},h=function(q,z){var B=this.document,j="layedit-tool-active",D=s(o(B)),A=function(E){return q.find(".layedit-tool-"+E)};z&&z[z.hasClass(j)?"removeClass":"addClass"](j),q.find(">i").removeClass(j),A("unlink").addClass(u),e(D).parents().each(function(){var E=this.tagName.toLowerCase(),F=this.style.textAlign;"b"!==E&&"strong"!==E||A("b").addClass(j),"i"!==E&&"em"!==E||A("i").addClass(j),"u"===E&&A("u").addClass(j),"strike"===E&&A("d").addClass(j),"p"===E&&("center"===F?A("center").addClass(j):"right"===F?A("right").addClass(j):A("left").addClass(j)),"a"===E&&(A("link").addClass(j),A("unlink").removeClass(u))})},g=function(F,D,j){var q=F.document,z=e(q.body),E={link:function(J){var H=s(J),I=e(H).parent();b.call(z,{href:I.attr("href"),target:I.attr("target")},function(L){var K=I[0];"A"===K.tagName?K.href=L.url:C.call(F,"a",{target:L.target,href:L.url,text:L.url},J)})},unlink:function(H){q.execCommand("unlink")},face:function(H){n.call(this,function(I){C.call(F,"img",{src:I.src,alt:I.alt},H)})},image:function(I){var H=this;layui.use("upload",function(J){var K=j.uploadImage||{};J.render({url:K.url,method:K.type,elem:e(H).find("input")[0],done:function(L){0==L.code?(L.data=L.data||{},C.call(F,"img",{src:L.data.src,alt:L.data.title},I)):i.msg(L.msg||"上传失败")}})})},code:function(H){k.call(z,function(I){C.call(F,"pre",{text:I.code,"lay-lang":I.lang},H)})},help:function(){i.open({type:2,title:"帮助",area:["600px","380px"],shadeClose:!0,shade:0.1,skin:"layui-layer-msg",content:["http://www.layui.com/about/layedit/help.html","no"]})}},B=D.find(".layui-layedit-tool"),A=function(){var H=e(this),K=H.attr("layedit-event"),J=H.attr("lay-command");if(!H.hasClass(u)){z.focus();var I=o(q);I.commonAncestorContainer;J?(q.execCommand(J),/justifyLeft|justifyCenter|justifyRight/.test(J)&&q.execCommand("formatBlock",!1,"<p>"),setTimeout(function(){z.focus()},10)):E[K]&&E[K].call(this,I),h.call(F,B,H)}},G=/image/;B.find(">i").on("mousedown",function(){var I=e(this),H=I.attr("layedit-event");G.test(H)||A.call(this)}).on("click",function(){var I=e(this),H=I.attr("layedit-event");G.test(H)&&A.call(this)}),z.on("click",function(){h.call(F,B),i.close(n.index)})},b=function(j,q){var A=this,z=i.open({type:1,id:"LAY_layedit_link",area:"350px",shade:0.05,shadeClose:!0,moveType:1,title:"超链接",skin:"layui-layer-msg",content:['<ul class="layui-form" style="margin: 15px;">','<li class="layui-form-item">','<label class="layui-form-label" style="width: 60px;">URL</label>','<div class="layui-input-block" style="margin-left: 90px">','<input name="url" lay-verify="url" value="'+(j.href||"")+'" autofocus="true" autocomplete="off" class="layui-input">',"</div>","</li>",'<li class="layui-form-item">','<label class="layui-form-label" style="width: 60px;">打开方式</label>','<div class="layui-input-block" style="margin-left: 90px">','<input type="radio" name="target" value="_self" class="layui-input" title="当前窗口"'+("_self"!==j.target&&j.target?"":"checked")+">",'<input type="radio" name="target" value="_blank" class="layui-input" title="新窗口" '+("_blank"===j.target?"checked":"")+">","</div>","</li>",'<li class="layui-form-item" style="text-align: center;">','<button type="button" lay-submit lay-filter="layedit-link-yes" class="layui-btn"> 确定 </button>','<button style="margin-left: 20px;" type="button" class="layui-btn layui-btn-primary"> 取消 </button>',"</li>","</ul>"].join(""),success:function(E,B){var D="submit(layedit-link-yes)";a.render("radio"),E.find(".layui-btn-primary").on("click",function(){i.close(B),A.focus()}),a.on(D,function(F){i.close(b.index),q&&q(F.field)})}});b.index=z},n=function(j){var q=function(){var z=["[微笑]","[嘻嘻]","[哈哈]","[可爱]","[可怜]","[挖鼻]","[吃惊]","[害羞]","[挤眼]","[闭嘴]","[鄙视]","[爱你]","[泪]","[偷笑]","[亲亲]","[生病]","[太开心]","[白眼]","[右哼哼]","[左哼哼]","[嘘]","[衰]","[委屈]","[吐]","[哈欠]","[抱抱]","[怒]","[疑问]","[馋嘴]","[拜拜]","[思考]","[汗]","[困]","[睡]","[钱]","[失望]","[酷]","[色]","[哼]","[鼓掌]","[晕]","[悲伤]","[抓狂]","[黑线]","[阴险]","[怒骂]","[互粉]","[心]","[伤心]","[猪头]","[熊猫]","[兔子]","[ok]","[耶]","[good]","[NO]","[赞]","[来]","[弱]","[草泥马]","[神马]","[囧]","[浮云]","[给力]","[围观]","[威武]","[奥特曼]","[礼物]","[钟]","[话筒]","[蜡烛]","[蛋糕]"],A={};return layui.each(z,function(B,D){A[D]=layui.cache.dir+"images/face/"+B+".gif"}),A}();return n.hide=n.hide||function(z){"face"!==e(z.target).attr("layedit-event")&&i.close(n.index)},n.index=i.tips(function(){var z=[];return layui.each(q,function(B,A){z.push('<li title="'+B+'"><img src="'+A+'" alt="'+B+'"></li>')}),'<ul class="layui-clear">'+z.join("")+"</ul>"}(),this,{tips:1,time:0,skin:"layui-box layui-util-face",maxWidth:500,success:function(z,A){z.css({marginTop:-4,marginLeft:-10}).find(".layui-clear>li").on("click",function(){j&&j({src:q[this.title],alt:this.title}),i.close(A)}),e(document).off("click",n.hide).on("click",n.hide)}})},k=function(q){var z=this,j=i.open({type:1,id:"LAY_layedit_code",area:"550px",shade:0.05,shadeClose:!0,moveType:1,title:"插入代码",skin:"layui-layer-msg",content:['<ul class="layui-form layui-form-pane" style="margin: 15px;">','<li class="layui-form-item">','<label class="layui-form-label">请选择语言</label>','<div class="layui-input-block">','<select name="lang">','<option value="JavaScript">JavaScript</option>','<option value="HTML">HTML</option>','<option value="CSS">CSS</option>','<option value="Java">Java</option>','<option value="PHP">PHP</option>','<option value="C#">C#</option>','<option value="Python">Python</option>','<option value="Ruby">Ruby</option>','<option value="Go">Go</option>',"</select>","</div>","</li>",'<li class="layui-form-item layui-form-text">','<label class="layui-form-label">代码</label>','<div class="layui-input-block">','<textarea name="code" lay-verify="required" autofocus="true" class="layui-textarea" style="height: 200px;"></textarea>',"</div>","</li>",'<li class="layui-form-item" style="text-align: center;">','<button type="button" lay-submit lay-filter="layedit-code-yes" class="layui-btn"> 确定 </button>','<button style="margin-left: 20px;" type="button" class="layui-btn layui-btn-primary"> 取消 </button>',"</li>","</ul>"].join(""),success:function(B,D){var A="submit(layedit-code-yes)";a.render("select"),B.find(".layui-btn-primary").on("click",function(){i.close(D),z.focus()}),a.on(A,function(E){i.close(k.index),q&&q(E.field)})}});k.index=j},v={html:'<i class="layui-icon layedit-tool-html" title="HTML源代码" lay-command="html" layedit-event="html"">&#xe64b;</i><span class="layedit-tool-mid"></span>',strong:'<i class="layui-icon layedit-tool-b" title="加粗" lay-command="Bold" layedit-event="b"">&#xe62b;</i>',italic:'<i class="layui-icon layedit-tool-i" title="斜体" lay-command="italic" layedit-event="i"">&#xe644;</i>',underline:'<i class="layui-icon layedit-tool-u" title="下划线" lay-command="underline" layedit-event="u"">&#xe646;</i>',del:'<i class="layui-icon layedit-tool-d" title="删除线" lay-command="strikeThrough" layedit-event="d"">&#xe64f;</i>',"|":'<span class="layedit-tool-mid"></span>',left:'<i class="layui-icon layedit-tool-left" title="左对齐" lay-command="justifyLeft" layedit-event="left"">&#xe649;</i>',center:'<i class="layui-icon layedit-tool-center" title="居中对齐" lay-command="justifyCenter" layedit-event="center"">&#xe647;</i>',right:'<i class="layui-icon layedit-tool-right" title="右对齐" lay-command="justifyRight" layedit-event="right"">&#xe648;</i>',link:'<i class="layui-icon layedit-tool-link" title="插入链接" layedit-event="link"">&#xe64c;</i>',unlink:'<i class="layui-icon layedit-tool-unlink layui-disabled" title="清除链接" lay-command="unlink" layedit-event="unlink"">&#xe64d;</i>',face:'<i class="layui-icon layedit-tool-face" title="表情" layedit-event="face"">&#xe650;</i>',image:'<i class="layui-icon layedit-tool-image" title="图片" layedit-event="image">&#xe64a;<input type="file" name="file"></i>',code:'<i class="layui-icon layedit-tool-code" title="插入代码" layedit-event="code">&#xe64e;</i>',help:'<i class="layui-icon layedit-tool-help" title="帮助" layedit-event="help">&#xe607;</i>'},m=new c;y(p,m)});