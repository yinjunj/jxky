layui.define(["layer","form"],function(A){var R=layui.$,N=layui.layer,V=layui.form,L=(layui.hint(),layui.device()),I="layedit",H="layui-show",E="layui-disabled",T=function(){var a=this;a.index=0,a.config={tool:["strong","italic","underline","del","|","left","center","right","|","link","unlink","face","image"],hideTool:[],height:280}};T.prototype.set=function(a){var b=this;return R.extend(!0,b.config,a),b},T.prototype.on=function(b,a){return layui.onevent(I,b,a)},T.prototype.build=function(i,c){c=c||{};var g=this,l=g.config,k="layui-layedit",b=R("#"+i),h="LAY_layedit_"+ ++g.index,f=b.next("."+k),e=R.extend({},l,c),d=function(){var n=[],m={};return layui.each(e.hideTool,function(o,p){m[p]=!0}),layui.each(e.tool,function(o,p){D[p]&&!m[p]&&n.push(D[p])}),n.join("")}(),a=R(['<div class="'+k+'">','<div class="layui-unselect layui-layedit-tool">'+d+"</div>",'<div class="layui-layedit-iframe">','<iframe id="'+h+'" name="'+h+'" textarea="'+i+'" frameborder="0"></iframe>',"</div>","</div>"].join(""));return L.ie&&L.ie<8?b.removeClass("layui-hide").addClass(H):(f[0]&&f.remove(),B.call(g,a,b[0],e),b.addClass("layui-hide").after(a),g.index)},T.prototype.getContent=function(b){var a=q(b);if(a[0]){return S(a[0].document.body.innerHTML)}},T.prototype.getText=function(a){var b=q(a);if(b[0]){return R(b[0].document.body).text()}},T.prototype.setContent=function(c,d,a){var b=q(c);b[0]&&(a?R(b[0].document.body).append(d):R(b[0].document.body).html(d),layedit.sync(c))},T.prototype.sync=function(b){var c=q(b);if(c[0]){var a=R("#"+c[1].attr("textarea"));a.val(S(c[0].document.body.innerHTML))}},T.prototype.getSelection=function(a){var c=q(a);if(c[0]){var b=J(c[0].document);return document.selection?b.text:b.toString()}};var B=function(d,a,e){var b=this,c=d.find("iframe");c.css({height:e.height}).on("load",function(){var h=c.contents(),g=c.prop("contentWindow"),i=h.find("head"),f=R(["<style>","*{margin: 0; padding: 0;}","body{padding: 10px; line-height: 20px; overflow-x: hidden; word-wrap: break-word; font: 14px Helvetica Neue,Helvetica,PingFang SC,Microsoft YaHei,Tahoma,Arial,sans-serif; -webkit-box-sizing: border-box !important; -moz-box-sizing: border-box !important; box-sizing: border-box !important;}","a{color:#01AAED; text-decoration:none;}a:hover{color:#c00}","p{margin-bottom: 10px;}","img{display: inline-block; border: none; vertical-align: middle;}","pre{margin: 10px 0; padding: 10px; line-height: 20px; border: 1px solid #ddd; border-left-width: 6px; background-color: #F2F2F2; color: #333; font-family: Courier New; font-size: 12px;}","</style>"].join("")),k=h.find("body");i.append(f),k.attr("contenteditable","true").css({"min-height":e.height}).html(a.value||""),F.apply(b,[g,c,a,e]),P.call(b,g,d,e)})},q=function(b){var c=R("#LAY_layedit_"+b),a=c.prop("contentWindow");return[a,c]},S=function(a){return 8==L.ie&&(a=a.replace(/<.+>/g,function(b){return b.toLowerCase()})),a},F=function(d,b,c,a){var f=d.document,e=R(f.body);e.on("keydown",function(k){var l=k.keyCode;if(13===l){var i=J(f),g=G(i),h=g.parentNode;if("pre"===h.tagName.toLowerCase()){if(k.shiftKey){return}return N.msg("请暂时用shift+enter"),!1}f.execCommand("formatBlock",!1,"<p>")}}),R(c).parents("form").on("submit",function(){var g=e.html();8==L.ie&&(g=g.replace(/<.+>/g,function(h){return h.toLowerCase()})),c.value=g}),e.on("paste",function(g){f.execCommand("formatBlock",!1,"<p>"),setTimeout(function(){Q.call(d,e),c.value=e.html()},100)})},Q=function(a){var b=this;b.document;a.find("*[style]").each(function(){var c=this.style.textAlign;this.removeAttribute("style"),R(this).css({"text-align":c||""})}),a.find("table").addClass("layui-table"),a.find("script,link").remove()},J=function(a){return a.selection?a.selection.createRange():a.getSelection().getRangeAt(0)},G=function(a){return a.endContainer||a.parentElement().childNodes[0]},j=function(g,e,d){var b=this.document,c=document.createElement(g);for(var f in e){c.setAttribute(f,e[f])}if(c.removeAttribute("text"),b.selection){var a=d.text||e.text;if("a"===g&&!a){return}a&&(c.innerHTML=a),d.pasteHTML(R(c).prop("outerHTML")),d.select()}else{var a=d.toString()||e.text;if("a"===g&&!a){return}a&&(c.innerHTML=a),d.deleteContents(),d.insertNode(c)}},O=function(a,f){var d=this.document,b="layedit-tool-active",c=G(J(d)),e=function(g){return a.find(".layedit-tool-"+g)};f&&f[f.hasClass(b)?"removeClass":"addClass"](b),a.find(">i").removeClass(b),e("unlink").addClass(E),R(c).parents().each(function(){var h=this.tagName.toLowerCase(),g=this.style.textAlign;"b"!==h&&"strong"!==h||e("b").addClass(b),"i"!==h&&"em"!==h||e("i").addClass(b),"u"===h&&e("u").addClass(b),"strike"===h&&e("d").addClass(b),"p"===h&&("center"===g?e("center").addClass(b):"right"===g?e("right").addClass(b):e("left").addClass(b)),"a"===h&&(e("link").addClass(b),e("unlink").removeClass(E))})},P=function(b,d,i){var h=b.document,g=R(h.body),c={link:function(k){var m=G(k),l=R(m).parent();U.call(g,{href:l.attr("href"),target:l.attr("target")},function(n){var o=l[0];"A"===o.tagName?o.href=n.url:j.call(b,"a",{target:n.target,href:n.url,text:n.url},k)})},unlink:function(k){h.execCommand("unlink")},face:function(k){z.call(this,function(l){j.call(b,"img",{src:l.src,alt:l.alt},k)})},image:function(k){var l=this;layui.use("upload",function(m){var n=i.uploadImage||{};m.render({url:n.url,method:n.type,elem:R(l).find("input")[0],done:function(o){0==o.code?(o.data=o.data||{},j.call(b,"img",{src:o.data.src,alt:o.data.title},k)):N.msg(o.msg||"上传失败")}})})},code:function(k){M.call(g,function(l){j.call(b,"pre",{text:l.code,"lay-lang":l.lang},k)})},help:function(){N.open({type:2,title:"帮助",area:["600px","380px"],shadeClose:!0,shade:0.1,skin:"layui-layer-msg",content:["http://www.layui.com/about/layedit/help.html","no"]})}},e=d.find(".layui-layedit-tool"),f=function(){var m=R(this),n=m.attr("layedit-event"),k=m.attr("lay-command");if(!m.hasClass(E)){g.focus();var l=J(h);l.commonAncestorContainer;k?(h.execCommand(k),/justifyLeft|justifyCenter|justifyRight/.test(k)&&h.execCommand("formatBlock",!1,"<p>"),setTimeout(function(){g.focus()},10)):c[n]&&c[n].call(this,l),O.call(b,e,m)}},a=/image/;e.find(">i").on("mousedown",function(){var k=R(this),l=k.attr("layedit-event");a.test(l)||f.call(this)}).on("click",function(){var k=R(this),l=k.attr("layedit-event");a.test(l)&&f.call(this)}),g.on("click",function(){O.call(b,e),N.close(z.index)})},U=function(b,a){var c=this,d=N.open({type:1,id:"LAY_layedit_link",area:"350px",shade:0.05,shadeClose:!0,moveType:1,title:"超链接",skin:"layui-layer-msg",content:['<ul class="layui-form" style="margin: 15px;">','<li class="layui-form-item">','<label class="layui-form-label" style="width: 60px;">URL</label>','<div class="layui-input-block" style="margin-left: 90px">','<input name="url" lay-verify="url" value="'+(b.href||"")+'" autofocus="true" autocomplete="off" class="layui-input">',"</div>","</li>",'<li class="layui-form-item">','<label class="layui-form-label" style="width: 60px;">打开方式</label>','<div class="layui-input-block" style="margin-left: 90px">','<input type="radio" name="target" value="_self" class="layui-input" title="当前窗口"'+("_self"!==b.target&&b.target?"":"checked")+">",'<input type="radio" name="target" value="_blank" class="layui-input" title="新窗口" '+("_blank"===b.target?"checked":"")+">","</div>","</li>",'<li class="layui-form-item" style="text-align: center;">','<button type="button" lay-submit lay-filter="layedit-link-yes" class="layui-btn"> 确定 </button>','<button style="margin-left: 20px;" type="button" class="layui-btn layui-btn-primary"> 取消 </button>',"</li>","</ul>"].join(""),success:function(e,g){var f="submit(layedit-link-yes)";V.render("radio"),e.find(".layui-btn-primary").on("click",function(){N.close(g),c.focus()}),V.on(f,function(h){N.close(U.index),a&&a(h.field)})}});U.index=d},z=function(b){var a=function(){var d=["[微笑]","[嘻嘻]","[哈哈]","[可爱]","[可怜]","[挖鼻]","[吃惊]","[害羞]","[挤眼]","[闭嘴]","[鄙视]","[爱你]","[泪]","[偷笑]","[亲亲]","[生病]","[太开心]","[白眼]","[右哼哼]","[左哼哼]","[嘘]","[衰]","[委屈]","[吐]","[哈欠]","[抱抱]","[怒]","[疑问]","[馋嘴]","[拜拜]","[思考]","[汗]","[困]","[睡]","[钱]","[失望]","[酷]","[色]","[哼]","[鼓掌]","[晕]","[悲伤]","[抓狂]","[黑线]","[阴险]","[怒骂]","[互粉]","[心]","[伤心]","[猪头]","[熊猫]","[兔子]","[ok]","[耶]","[good]","[NO]","[赞]","[来]","[弱]","[草泥马]","[神马]","[囧]","[浮云]","[给力]","[围观]","[威武]","[奥特曼]","[礼物]","[钟]","[话筒]","[蜡烛]","[蛋糕]"],c={};return layui.each(d,function(f,e){c[e]=layui.cache.dir+"images/face/"+f+".gif"}),c}();return z.hide=z.hide||function(c){"face"!==R(c.target).attr("layedit-event")&&N.close(z.index)},z.index=N.tips(function(){var c=[];return layui.each(a,function(d,e){c.push('<li title="'+d+'"><img src="'+e+'" alt="'+d+'"></li>')}),'<ul class="layui-clear">'+c.join("")+"</ul>"}(),this,{tips:1,time:0,skin:"layui-box layui-util-face",maxWidth:500,success:function(d,c){d.css({marginTop:-4,marginLeft:-10}).find(".layui-clear>li").on("click",function(){b&&b({src:a[this.title],alt:this.title}),N.close(c)}),R(document).off("click",z.hide).on("click",z.hide)}})},M=function(a){var c=this,b=N.open({type:1,id:"LAY_layedit_code",area:"550px",shade:0.05,shadeClose:!0,moveType:1,title:"插入代码",skin:"layui-layer-msg",content:['<ul class="layui-form layui-form-pane" style="margin: 15px;">','<li class="layui-form-item">','<label class="layui-form-label">请选择语言</label>','<div class="layui-input-block">','<select name="lang">','<option value="JavaScript">JavaScript</option>','<option value="HTML">HTML</option>','<option value="CSS">CSS</option>','<option value="Java">Java</option>','<option value="PHP">PHP</option>','<option value="C#">C#</option>','<option value="Python">Python</option>','<option value="Ruby">Ruby</option>','<option value="Go">Go</option>',"</select>","</div>","</li>",'<li class="layui-form-item layui-form-text">','<label class="layui-form-label">代码</label>','<div class="layui-input-block">','<textarea name="code" lay-verify="required" autofocus="true" class="layui-textarea" style="height: 200px;"></textarea>',"</div>","</li>",'<li class="layui-form-item" style="text-align: center;">','<button type="button" lay-submit lay-filter="layedit-code-yes" class="layui-btn"> 确定 </button>','<button style="margin-left: 20px;" type="button" class="layui-btn layui-btn-primary"> 取消 </button>',"</li>","</ul>"].join(""),success:function(e,d){var f="submit(layedit-code-yes)";V.render("select"),e.find(".layui-btn-primary").on("click",function(){N.close(d),c.focus()}),V.on(f,function(g){N.close(M.index),a&&a(g.field)})}});M.index=b},D={html:'<i class="layui-icon layedit-tool-html" title="HTML源代码" lay-command="html" layedit-event="html"">&#xe64b;</i><span class="layedit-tool-mid"></span>',strong:'<i class="layui-icon layedit-tool-b" title="加粗" lay-command="Bold" layedit-event="b"">&#xe62b;</i>',italic:'<i class="layui-icon layedit-tool-i" title="斜体" lay-command="italic" layedit-event="i"">&#xe644;</i>',underline:'<i class="layui-icon layedit-tool-u" title="下划线" lay-command="underline" layedit-event="u"">&#xe646;</i>',del:'<i class="layui-icon layedit-tool-d" title="删除线" lay-command="strikeThrough" layedit-event="d"">&#xe64f;</i>',"|":'<span class="layedit-tool-mid"></span>',left:'<i class="layui-icon layedit-tool-left" title="左对齐" lay-command="justifyLeft" layedit-event="left"">&#xe649;</i>',center:'<i class="layui-icon layedit-tool-center" title="居中对齐" lay-command="justifyCenter" layedit-event="center"">&#xe647;</i>',right:'<i class="layui-icon layedit-tool-right" title="右对齐" lay-command="justifyRight" layedit-event="right"">&#xe648;</i>',link:'<i class="layui-icon layedit-tool-link" title="插入链接" layedit-event="link"">&#xe64c;</i>',unlink:'<i class="layui-icon layedit-tool-unlink layui-disabled" title="清除链接" lay-command="unlink" layedit-event="unlink"">&#xe64d;</i>',face:'<i class="layui-icon layedit-tool-face" title="表情" layedit-event="face"">&#xe650;</i>',image:'<i class="layui-icon layedit-tool-image" title="图片" layedit-event="image">&#xe64a;<input type="file" name="file"></i>',code:'<i class="layui-icon layedit-tool-code" title="插入代码" layedit-event="code">&#xe64e;</i>',help:'<i class="layui-icon layedit-tool-help" title="帮助" layedit-event="help">&#xe607;</i>'},K=new T;A(I,K)});