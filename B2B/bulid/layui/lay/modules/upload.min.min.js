layui.define("layer",function(a){var e=layui.$,p=layui.layer,i=layui.hint(),t=layui.device(),l={config:{},set:function(d){var b=this;return b.config=e.extend({},b.config,d),b},on:function(d,b){return layui.onevent.call(this,r,d,b)}},f=function(){var b=this;return{upload:function(d){b.upload.call(b,d)},config:b.config}},r="upload",s="layui-upload-file",u="layui-upload-form",o="layui-upload-iframe",c="layui-upload-choose",n=function(d){var b=this;b.config=e.extend({},b.config,l.config,d),b.render()};n.prototype.config={accept:"images",exts:"",auto:!0,bindAction:"",url:"",field:"file",method:"post",data:{},drag:!0,size:0,multiple:!1},n.prototype.render=function(d){var b=this,d=b.config;d.elem=e(d.elem),d.bindAction=e(d.bindAction),b.file(),b.events()},n.prototype.file=function(){var h=this,b=h.config,d=h.elemFile=e(['<input class="'+s+'" type="file" name="'+b.field+'"',b.multiple?" multiple":"",">"].join("")),g=b.elem.next();(g.hasClass(s)||g.hasClass(u))&&g.remove(),t.ie&&t.ie<10&&b.elem.wrap('<div class="layui-upload-wrap"></div>'),h.isFile()?(h.elemFile=b.elem,b.field=b.elem[0].name):b.elem.after(d),t.ie&&t.ie<10&&h.initIE()},n.prototype.initIE=function(){var d=this,g=d.config,b=e('<iframe id="'+o+'" class="'+o+'" name="'+o+'" frameborder="0"></iframe>'),h=e(['<form target="'+o+'" class="'+u+'" method="'+g.method,'" key="set-mine" enctype="multipart/form-data" action="'+g.url+'">',"</form>"].join(""));e("#"+o)[0]||e("body").append(b),g.elem.next().hasClass(o)||(d.elemFile.wrap(h),g.elem.next("."+o).append(function(){var j=[];return layui.each(g.data,function(m,k){j.push('<input type="hidden" name="'+m+'" value="'+k+'">')}),j.join("")}()))},n.prototype.msg=function(b){return p.msg(b,{icon:2,shift:6})},n.prototype.isFile=function(){var b=this.config.elem[0];if(b){return"input"===b.tagName.toLocaleLowerCase()&&"file"===b.type}},n.prototype.preview=function(d){var b=this;window.FileReader&&layui.each(b.chooseFiles,function(h,j){var g=new FileReader;g.readAsDataURL(j),g.onload=function(){d&&d(h,j,this.result)}})},n.prototype.upload=function(d,q){var k,m=this,L=m.config,w=m.elemFile[0],x=function(){layui.each(d||m.files||m.chooseFiles||w.files,function(A,C){var B=new FormData;B.append(L.field,C),layui.each(L.data,function(D,E){B.append(D,E)}),e.ajax({url:L.url,type:L.method,data:B,contentType:!1,processData:!1,dataType:"json",success:function(D){b(A,D)},error:function(){m.msg("请求上传接口出现异常"),h(A)}})})},F=function(){var A=e("#"+o);m.elemFile.parent().submit(),clearInterval(n.timer),n.timer=setInterval(function(){var B,C=A.contents().find("body");try{B=C.text()}catch(D){m.msg("获取上传后的响应信息出现异常"),clearInterval(n.timer),h()}B&&(clearInterval(n.timer),C.html(""),b(0,B))},30)},b=function(C,A){if(m.elemFile.next("."+c).remove(),w.value="","object"!=typeof A){try{A=JSON.parse(A)}catch(B){return A={},m.msg("请对上传接口返回有效JSON")}}"function"==typeof L.done&&L.done(A,C||0,function(D){m.upload(D)})},h=function(A){L.auto&&(w.value=""),"function"==typeof L.error&&L.error(A||0,function(B){m.upload(B)})},y=L.exts,j=function(){var A=[];return layui.each(d||m.chooseFiles,function(C,B){A.push(B.name)}),A}(),g={preview:function(A){m.preview(A)},upload:function(C,A){var B={};B[C]=A,m.upload(B)},pushFile:function(){return m.files=m.files||{},layui.each(m.chooseFiles,function(A,B){m.files[A]=B}),m.files}},z=function(){return"choose"===q?L.choose&&L.choose(g):(L.before&&L.before(g),t.ie?t.ie>9?x():F():void x())};switch(j=0===j.length?w.value.match(/[^\/\\]+\..+/g)||[]||"":j,L.accept){case"file":if(y&&!RegExp("\\w\\.("+y+")$","i").test(escape(j))){return m.msg("选择的文件中包含不支持的格式"),w.value=""}break;case"video":if(!RegExp("\\w\\.("+(y||"avi|mp4|wma|rmvb|rm|flash|3gp|flv")+")$","i").test(escape(j))){return m.msg("选择的视频中包含不支持的格式"),w.value=""}break;case"audio":if(!RegExp("\\w\\.("+(y||"mp3|wav|mid")+")$","i").test(escape(j))){return m.msg("选择的音频中包含不支持的格式"),w.value=""}break;default:if(layui.each(j,function(A,B){RegExp("\\w\\.("+(y||"jpg|png|gif|bmp|jpeg$")+")","i").test(escape(B))||(k=!0)}),k){return m.msg("选择的图片中包含不支持的格式"),w.value=""}}if(L.size>0&&!(t.ie&&t.ie<10)){var v;if(layui.each(m.chooseFiles,function(C,A){if(A.size>1024*L.size){var B=L.size/1024;B=B>=1?Math.floor(B)+(B%1>0?B.toFixed(1):0)+"MB":L.size+"KB",w.value="",v=B}}),v){return m.msg("文件不能超过"+v)}}z()},n.prototype.events=function(){var g=this,h=g.config,d=function(j){g.chooseFiles={},layui.each(j,function(q,k){var m=(new Date).getTime();g.chooseFiles[m+"-"+q]=k})},b=function(j,k){var q=g.elemFile,m=j.length>1?j.length+"个文件":(j[0]||{}).name||q[0].value.match(/[^\/\\]+\..+/g)||[]||"";q.next().hasClass(c)&&q.next().remove(),g.upload(null,"choose"),g.isFile()||h.choose||q.after('<span class="layui-inline '+c+'">'+m+"</span>")};h.elem.off("upload.start").on("upload.start",function(){var m=e(this),k=m.attr("lay-data");if(k){try{k=new Function("return "+k)(),g.config=e.extend({},h,k)}catch(j){i.error("Upload element property lay-data configuration item has a syntax error: "+k)}}g.config.item=m,g.elemFile[0].click()}),t.ie&&t.ie<10||h.elem.off("upload.over").on("upload.over",function(){var j=e(this);j.attr("lay-over","")}).off("upload.leave").on("upload.leave",function(){var j=e(this);j.removeAttr("lay-over")}).off("upload.drop").on("upload.drop",function(m,k){var q=e(this),j=k.originalEvent.dataTransfer.files||[];q.removeAttr("lay-over"),d(j),h.auto?g.upload(j):b(j)}),g.elemFile.off("upload.change").on("upload.change",function(){var j=this.files||[];d(j),h.auto?g.upload():b(j)}),h.bindAction.off("upload.action").on("upload.action",function(){g.upload()}),h.elem.data("haveEvents")||(g.elemFile.on("change",function(){e(this).trigger("upload.change")}),h.elem.on("click",function(){g.isFile()||e(this).trigger("upload.start")}),h.drag&&h.elem.on("dragover",function(j){j.preventDefault(),e(this).trigger("upload.over")}).on("dragleave",function(j){e(this).trigger("upload.leave")}).on("drop",function(j){j.preventDefault(),e(this).trigger("upload.drop",j)}),h.bindAction.on("click",function(){e(this).trigger("upload.action")}),h.elem.data("haveEvents",!0))},l.render=function(d){var b=new n(d);return f.call(b)},a(r,l)});