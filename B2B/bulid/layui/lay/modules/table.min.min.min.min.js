layui.define(["laytpl","laypage","layer","form"],function(n){var d=layui.$,y=layui.laytpl,t=layui.laypage,A=layui.layer,F=layui.form,N=layui.hint(),a=layui.device(),i={config:{checkName:"LAY_CHECKED",indexName:"LAY_TABLE_INDEX"},cache:{},index:layui.table?layui.table.index+10000:0,set:function(q){var j=this;return j.config=d.extend({},j.config,q),j},on:function(q,j){return layui.onevent.call(this,c,q,j)}},g=function(){var B=this,q=B.config,j=q.id;return j&&(g.config[j]=q),{reload:function(D){B.reload.call(B,D)},config:q}},c="table",e=".layui-table",w="layui-hide",x="layui-table-view",m=".layui-table-header",S=".layui-table-body",C=".layui-table-main",h=".layui-table-fixed",v=".layui-table-fixed-l",l=".layui-table-fixed-r",u=".layui-table-tool",z=".layui-table-sort",k="layui-table-edit",b="layui-table-hover",o=function(j){return j=j||{},['<table cellspacing="0" cellpadding="0" border="0" class="layui-table" ','{{# if(d.data.skin){ }}lay-skin="{{d.data.skin}}"{{# } }} {{# if(d.data.size){ }}lay-size="{{d.data.size}}"{{# } }} {{# if(d.data.even){ }}lay-even{{# } }}>',"<thead>","{{# layui.each(d.data.cols, function(i1, item1){ }}","<tr>","{{# layui.each(item1, function(i2, item2){ }}",'{{# if(item2.fixed && item2.fixed !== "right"){ left = true; } }}','{{# if(item2.fixed === "right"){ right = true; } }}',function(){return j.fixed&&"right"!==j.fixed?'{{# if(item2.fixed && item2.fixed !== "right"){ }}':"right"===j.fixed?'{{# if(item2.fixed === "right"){ }}':""}(),"{{# if(item2.checkbox){ }}",'<th data-field="{{ item2.field||i2 }}" data-type="checkbox" {{#if(item2.colspan){}} colspan="{{item2.colspan}}"{{#} if(item2.rowspan){}} rowspan="{{item2.rowspan}}"{{#}}} unresize="true"><div class="layui-table-cell laytable-cell-checkbox"><input type="checkbox" name="layTableCheckbox" lay-skin="primary" lay-filter="layTableAllChoose" {{# if(item2[d.data.checkName]){ }}checked{{# }; }}></div></th>',"{{# } else if(item2.space){ }}",'<th data-field="{{ item2.field||i2 }}" {{#if(item2.colspan){}} colspan="{{item2.colspan}}"{{#} if(item2.rowspan){}} rowspan="{{item2.rowspan}}"{{#}}} unresize="true"><div class="layui-table-cell laytable-cell-space"></div></th>',"{{# } else { }}",'<th data-field="{{ item2.field||i2 }}" {{#if(item2.colspan){}} colspan="{{item2.colspan}}"{{#} if(item2.rowspan){}} rowspan="{{item2.rowspan}}"{{#}}} {{# if(item2.unresize){ }}unresize="true"{{# } }}>',"{{# if(item2.colspan > 1){ }}",'<div class="layui-table-cell laytable-cell-group" {{#if(item2.align){}}align="{{item2.align}}"{{#}}}>','<span>{{item2.title||""}}</span>',"</div>","{{# } else { }}",'<div class="layui-table-cell laytable-cell-{{d.index}}-{{item2.field||i2}}" {{#if(item2.align){}}align="{{item2.align}}"{{#}}}>','<span>{{item2.title||""}}</span>',"{{# if(item2.sort){ }}",'<span class="layui-table-sort layui-inline"><i class="layui-edge layui-table-sort-asc"></i><i class="layui-edge layui-table-sort-desc"></i></span>',"{{# } }}","</div>","{{# } }}","</th>","{{# }; }}",j.fixed?"{{# }; }}":"","{{# }); }}","</tr>","{{# }); }}","</thead>","</table>"].join("")},f=['<table cellspacing="0" cellpadding="0" border="0" class="layui-table" ','{{# if(d.data.skin){ }}lay-skin="{{d.data.skin}}"{{# } }} {{# if(d.data.size){ }}lay-size="{{d.data.size}}"{{# } }} {{# if(d.data.even){ }}lay-even{{# } }}>',"<tbody></tbody>","</table>"].join(""),r=['<div class="layui-form layui-border-box {{d.VIEW_CLASS}}" lay-filter="LAY-table-{{d.index}}" style="{{# if(d.data.width){ }}width:{{d.data.width}}px;{{# } }} {{# if(d.data.height){ }}height:{{d.data.height}}px;{{# } }}">',"{{# var left, right; }}",'<div class="layui-table-header">',o(),"</div>",'<div class="layui-table-body layui-table-main">',f,"</div>","{{# if(left){ }}",'<div class="layui-table-fixed layui-table-fixed-l">','<div class="layui-table-header">',o({fixed:!0}),"</div>",'<div class="layui-table-body">',f,"</div>","</div>","{{# }; }}","{{# if(right){ }}",'<div class="layui-table-fixed layui-table-fixed-r">','<div class="layui-table-header">',o({fixed:"right"}),'<div class="layui-table-mend"></div>',"</div>",'<div class="layui-table-body">',f,"</div>","</div>","{{# }; }}","{{# if(d.data.page){ }}",'<div class="layui-table-tool">','<div class="layui-inline layui-table-page" id="layui-table-page{{d.index}}"></div>',"</div>","{{# } }}","<style>","{{# layui.each(d.data.cols, function(i1, item1){","layui.each(item1, function(i2, item2){ }}",".laytable-cell-{{d.index}}-{{item2.field||i2}}{ width:{{item2.width||50}}px }","{{# });","}); }}","</style>","</div>"].join(""),s=d(window),p=d(document),T=function(q){var j=this;j.index=++i.index,j.config=d.extend({},j.config,i.config,q),j.render()};T.prototype.config={limit:30,loading:!0},T.prototype.render=function(E){var j,q=this;if(E&&(q.config=E),j=q.config,j.elem=d(j.elem),j.where=j.where||{},j.request=d.extend({pageName:"page",limitName:"limit"},j.request),j.response=d.extend({statusName:"code",statusCode:0,msgName:"msg",dataName:"data",countName:"count"},j.response),!j.elem[0]){return q}var G=j.elem,B=G.next("."+x);j.height&&/^full-\d+$/.test(j.height)&&(q.fullHeightGap=j.height.split("-")[1],j.height=s.height()-q.fullHeightGap);var H=q.elem=d(y(r).render({VIEW_CLASS:x,data:j,index:q.index}));if(j.index=q.index,B[0]&&B.remove(),G.after(H),q.layHeader=H.find(m),q.layMain=H.find(C),q.layBody=H.find(S),q.layFixed=H.find(h),q.layFixLeft=H.find(v),q.layFixRight=H.find(l),q.layTool=H.find(u),j.height&&q.fullSize(),j.cols.length>1){var D=q.layFixed.find(m).find("th");D.height(q.layHeader.height()-1-parseFloat(D.css("padding-top"))-parseFloat(D.css("padding-bottom")))}q.pullData(1),q.events()},T.prototype.reload=function(q){var j=this;j.config=d.extend({},j.config,q),j.render()},T.prototype.pullData=function(K,j){var H=this,q=H.config,B=q.request,D=q.response,I=function(){"object"==typeof q.initSort&&H.sort(q.initSort.field,q.initSort.type)};if(q.url){var J={};J[B.pageName]=K,J[B.limitName]=q.limit,d.ajax({type:q.method||"get",url:q.url,data:d.extend(J,q.where),dataType:"json",success:function(L){return L[D.statusName]!=D.statusCode?(H.renderForm(),H.layMain.html('<div class="layui-none">'+(L[D.msgName]||"返回的数据状态异常")+"</div>")):(H.renderData(L,K,L[D.countName]),I(),j&&A.close(j),void ("function"==typeof q.done&&q.done(L,K,L[D.countName])))},error:function(L,M){H.layMain.html('<div class="layui-none">数据接口请求异常</div>'),H.renderForm(),j&&A.close(j)}})}else{if(q.data&&q.data.constructor===Array){var E={},G=K*q.limit-q.limit;E[D.dataName]=q.data.concat().splice(G,q.limit),E[D.countName]=q.data.length,H.renderData(E,K,q.data.length),I(),"function"==typeof q.done&&q.done(E,K,E[D.countName])}}},T.prototype.page=1,T.prototype.eachCols=function(j){layui.each(this.config.cols,function(B,q){layui.each(q,function(D,E){j(D,E,[B,q])})})},T.prototype.renderData=function(K,j,q,D){var I=this,E=I.config,G=K[E.response.dataName]||[],J=[],L=[],H=[],B=function(){return !D&&I.sortKey?I.sort(I.sortKey.field,I.sortKey.sort,!0):(layui.each(G,function(O,Q){var M=[],P=[],R=[];0!==Q.length&&(D||(Q[i.config.indexName]=O),I.eachCols(function(W,X){var V=Q[X.field||W];if(void 0!==V&&null!==V||(V=""),!(X.colspan>1)){var U=['<td data-field="'+(X.field||W)+'"'+function(){var Y=[];return X.edit&&Y.push(' data-edit="true"'),X.align&&Y.push(' align="'+X.align+'"'),X.templet&&Y.push(' data-content="'+V+'"'),X.toolbar&&Y.push(' data-off="true"'),X.event&&Y.push(' lay-event="'+X.event+'"'),X.style&&Y.push(' style="'+X.style+'"'),Y.join("")}()+">",'<div class="layui-table-cell laytable-cell-'+function(){return X.checkbox?"checkbox":X.space?"space":E.index+"-"+(X.field||W)}()+'">'+function(){return X.checkbox?'<input type="checkbox" name="layTableCheckbox" lay-skin="primary" '+function(){var Y=i.config.checkName;return X[Y]?(Q[Y]=X[Y],X[Y]?"checked":""):Q[Y]?"checked":""}()+">":X.toolbar?y(d(X.toolbar).html()||"").render(Q):X.templet?y(d(X.templet).html()||String(V)).render(Q):V}(),"</div></td>"].join("");M.push(U),X.fixed&&"right"!==X.fixed&&P.push(U),"right"===X.fixed&&R.push(U)}}),J.push('<tr data-index="'+O+'">'+M.join("")+"</tr>"),L.push('<tr data-index="'+O+'">'+P.join("")+"</tr>"),H.push('<tr data-index="'+O+'">'+R.join("")+"</tr>"))}),I.layBody.scrollTop(0),I.layMain.find("tbody").html(J.join("")),I.layFixLeft.find("tbody").html(L.join("")),I.layFixRight.find("tbody").html(H.join("")),I.renderForm(),I.syncCheckAll(),I.haveInit?I.scrollPatch():setTimeout(function(){I.scrollPatch()},50),I.haveInit=!0,void A.close(I.tipsIndex))};return I.key=E.id||E.index,i.cache[I.key]=G,D?B():0===G.length?(I.renderForm(),I.layFixed.remove(),I.layMain.html('<div class="layui-none">无数据</div>')):(B(),void (E.page&&(I.page=j,I.count=q,t.render({elem:"layui-table-page"+E.index,count:q,groups:3,limits:E.limits||[10,20,30,40,50,60,70,80,90],limit:E.limit,curr:j,layout:["prev","page","next","skip","count","limit"],prev:'<i class="layui-icon">&#xe603;</i>',next:'<i class="layui-icon">&#xe602;</i>',jump:function(O,M){M||(I.page=O.curr,E.limit=O.limit,I.pullData(O.curr,I.loading()))}}),I.layTool.find(".layui-table-count span").html(q))))},T.prototype.renderForm=function(j){F.render(j||"checkbox","LAY-table-"+this.index)},T.prototype.sort=function(H,L,D,M){var B,G,q=this,I=q.config,J=I.elem.attr("lay-filter"),E=i.cache[q.key];"string"==typeof H&&q.layHeader.find("th").each(function(P,Q){var R=d(this),O=R.data("field");if(O===H){return H=R,B=O,!1}});try{var B=B||H.data("field");if(q.sortKey&&!D&&B===q.sortKey.field&&L===q.sortKey.sort){return}var j=q.layHeader.find("th .laytable-cell-"+I.index+"-"+B).find(z);q.layHeader.find("th").find(z).removeAttr("lay-sort"),j.attr("lay-sort",L||null),q.layFixed.find("th")}catch(K){return N.error("Table modules: Did not match to field")}q.sortKey={field:B,sort:L},"asc"===L?G=layui.sort(E,B):"desc"===L?G=layui.sort(E,B,!0):(G=layui.sort(E,i.config.indexName),delete q.sortKey),q.renderData({data:G},q.page,q.count,!0),A.close(q.tipsIndex),M&&layui.event.call(H,c,"sort("+J+")",{field:B,type:L})},T.prototype.loading=function(){var q=this,j=q.config;if(j.loading&&j.url){return A.msg("数据请求中",{icon:16,offset:[q.elem.offset().top+q.elem.height()/2-35-s.scrollTop()+"px",q.elem.offset().left+q.elem.width()/2-90-s.scrollLeft()+"px"],anim:-1,fixed:!1})}},T.prototype.setCheckData=function(E,B){var D=this,j=D.config,q=i.cache[D.key];q[E]&&(q[E][j.checkName]=B)},T.prototype.syncCheckAll=function(){var j=this,B=j.config,D=j.layHeader.find('input[name="layTableCheckbox"]'),q=function(E){return j.eachCols(function(G,H){H.checkbox&&(H[B.checkName]=E)}),E};D[0]&&(i.checkStatus(j.key).isAll?(D[0].checked||(D.prop("checked",!0),j.renderForm()),q(!0)):(D[0].checked&&(D.prop("checked",!1),j.renderForm()),q(!1)))},T.prototype.getCssRule=function(B,D){var E=this,j=E.elem.find("style")[0],q=j.sheet||j.styleSheet,G=q.cssRules||q.rules;layui.each(G,function(H,I){if(I.selectorText===".laytable-cell-"+E.index+"-"+B){return D(I),!0}})},T.prototype.fullSize=function(){var j,B=this,D=B.config,q=D.height;B.fullHeightGap&&(q=s.height()-B.fullHeightGap,q<135&&(q=135),B.elem.css("height",q)),j=parseFloat(q)-parseFloat(B.layHeader.height())-1,D.page&&(j-=parseFloat(B.layTool.outerHeight()+1)),B.layBody.css("height",j)},T.prototype.scrollPatch=function(){var B=this,D=B.layMain.children("table"),E=B.layMain.width()-B.layMain.prop("clientWidth"),q=B.layMain.height()-B.layMain.prop("clientHeight");if(E&&q){if(!B.elem.find(".layui-table-patch")[0]){var j=d('<th class="layui-table-patch"><div class="layui-table-cell"></div></th>');j.find("div").css({width:E}),B.layHeader.eq(0).find("thead tr").append(j)}}else{B.layHeader.eq(0).find(".layui-table-patch").remove()}B.layFixed.find(S).css("height",B.layMain.height()-q),B.layFixRight[D.width()>B.layMain.width()?"removeClass":"addClass"](w),B.layFixRight.css("right",E-1)},T.prototype.events=function(){var D,E=this,I=E.config,B=d("body"),j={},q=E.layHeader.find("th"),G=".layui-table-cell",H=I.elem.attr("lay-filter");q.on("mousemove",function(J){var K=d(this),L=K.offset().left,M=J.clientX-L;K.attr("colspan")>1||K.attr("unresize")||j.resizeStart||(j.allowResize=K.width()-M<=10,B.css("cursor",j.allowResize?"col-resize":""))}).on("mouseleave",function(){d(this);j.resizeStart||B.css("cursor","")}).on("mousedown",function(K){if(j.allowResize){var J=d(this).data("field");K.preventDefault(),j.resizeStart=!0,j.offset=[K.clientX,K.clientY],E.getCssRule(J,function(L){j.rule=L,j.ruleWidth=parseFloat(L.style.width)})}}),p.on("mousemove",function(K){if(j.resizeStart){if(K.preventDefault(),j.rule){var J=j.ruleWidth+K.clientX-j.offset[0];j.rule.style.width=J+"px",A.close(E.tipsIndex)}D=1}}).on("mouseup",function(J){j.resizeStart&&(j={},B.css("cursor",""),E.scrollPatch()),2===D&&(D=null)}),q.on("click",function(){var J,K=d(this),L=K.find(z),M=L.attr("lay-sort");return L[0]&&1!==D?(J="asc"===M?"desc":"desc"===M?null:"asc",void E.sort(K,J,null,!0)):D=2}).find(z+" .layui-edge ").on("click",function(M){var J=d(this),K=J.index(),L=J.parents("th").eq(0).data("field");layui.stope(M),0===K?E.sort(L,"asc",null,!0):E.sort(L,"desc",null,!0)}),E.elem.on("click",'input[name="layTableCheckbox"]+',function(){var O=d(this).prev(),J=E.layBody.find('input[name="layTableCheckbox"]'),K=O.parents("tr").eq(0).data("index"),M=O[0].checked,L="layTableAllChoose"===O.attr("lay-filter");L?(J.each(function(P,Q){Q.checked=M,E.setCheckData(P,M)}),E.syncCheckAll(),E.renderForm()):(E.setCheckData(K,M),E.syncCheckAll()),layui.event.call(this,c,"checkbox("+H+")",{checked:M,data:i.cache[E.key][K],type:L?"all":"one"})}),E.layBody.on("mouseenter","tr",function(){var K=d(this),J=K.index();E.layBody.find("tr:eq("+J+")").addClass(b)}).on("mouseleave","tr",function(){var K=d(this),J=K.index();E.layBody.find("tr:eq("+J+")").removeClass(b)}),E.layBody.on("change","."+k,function(){var O=d(this),J=this.value,K=O.parent().data("field"),M=O.parents("tr").eq(0).data("index"),L=i.cache[E.key][M];L[K]=J,layui.event.call(this,c,"edit("+H+")",{value:J,data:L,field:K})}).on("blur","."+k,function(){var O,K=d(this),M=K.parent().data("field"),L=K.parents("tr").eq(0).data("index"),J=i.cache[E.key][L];E.eachCols(function(Q,P){P.field==M&&P.templet&&(O=P.templet)}),K.siblings(G).html(O?y(d(O).html()||this.value).render(J):this.value),K.parent().data("content",this.value),K.remove()}),E.layBody.on("click","td",function(){var L=d(this),J=(L.data("field"),L.children(G));if(!L.data("off")){if(L.data("edit")){var K=d('<input class="'+k+'">');return K[0].value=L.data("content")||J.text(),L.find("."+k)[0]||L.append(K),K.focus()}J.prop("scrollWidth")>J.outerWidth()&&(E.tipsIndex=A.tips(['<div class="layui-table-tips-main" style="margin-top: -'+(J.height()+16)+"px;"+function(){return"sm"===I.size?"padding: 4px 15px; font-size: 12px;":"lg"===I.size?"padding: 14px 15px;":""}()+'">',J.html(),"</div>",'<i class="layui-icon layui-table-tips-c">&#x1006;</i>'].join(""),J[0],{tips:[3,""],time:-1,anim:-1,maxWidth:a.ios||a.android?300:600,isOutAnim:!1,skin:"layui-table-tips",success:function(M,O){M.find(".layui-table-tips-c").on("click",function(){A.close(O)})}}))}}),E.layBody.on("click","*[lay-event]",function(){var O=d(this),K=O.parents("tr").eq(0).data("index"),M=E.layBody.find('tr[data-index="'+K+'"]'),L="layui-table-click",J=i.cache[E.key][K];layui.event.call(this,c,"tool("+H+")",{data:i.clearCacheKey(J),event:O.attr("lay-event"),tr:M,del:function(){i.cache[E.key][K]=[],M.remove(),E.scrollPatch()},update:function(P){P=P||{},layui.each(P,function(R,U){if(R in J){var Q;J[R]=U,E.eachCols(function(W,V){V.field==R&&V.templet&&(Q=V.templet)}),M.children('td[data-field="'+R+'"]').children(G).html(Q?y(d(Q).html()||U).render(J):U)}})}}),M.addClass(L).siblings("tr").removeClass(L)}),E.layMain.on("scroll",function(){var L=d(this),J=L.scrollLeft(),K=L.scrollTop();E.layHeader.scrollLeft(J),E.layFixed.find(S).scrollTop(K),A.close(E.tipsIndex)}),s.on("resize",function(){E.fullSize(),E.scrollPatch()})},i.init=function(B,D){D=D||{};var E=this,q=d(B?'table[lay-filter="'+B+'"]':e+"[lay-data]"),j="Table element property lay-data configuration item has a syntax error: ";return q.each(function(){var J=d(this),K=J.attr("lay-data");try{K=new Function("return "+K)()}catch(H){N.error(j+K)}var G=[],I=d.extend({elem:this,cols:[],data:[],skin:J.attr("lay-skin"),size:J.attr("lay-size"),even:"string"==typeof J.attr("lay-even")},i.config,D,K);B&&J.hide(),J.find("thead>tr").each(function(L){I.cols[L]=[],d(this).children().each(function(Q){var R=d(this),M=R.attr("lay-data");try{M=new Function("return "+M)()}catch(P){return N.error(j+M)}var O=d.extend({title:R.text(),colspan:R.attr("colspan"),rowspan:R.attr("rowspan")},M);G.push(O),I.cols[L].push(O)})}),J.find("tbody>tr").each(function(O){var L=d(this),M={};L.children("td").each(function(R,U){var P=d(this),Q=P.data("field");if(Q){return M[Q]=P.html()}}),layui.each(G,function(Q,R){var P=L.children("td").eq(Q);M[R.field]=P.html()}),I.data[O]=M}),i.render(I)}),E},i.checkStatus=function(j){var B=0,D=[],q=i.cache[j];return q?(layui.each(q,function(E,G){G[i.config.checkName]&&(B++,D.push(i.clearCacheKey(G)))}),{data:D,isAll:B===q.length}):{}},g.config={},i.reload=function(j,B){var q=g.config[j];return q?i.render(d.extend({},q,B)):N.error("The ID option was not found in the table instance")},i.render=function(q){var j=new T(q);return g.call(j)},i.clearCacheKey=function(j){return j=d.extend({},j),delete j[i.config.checkName],delete j[i.config.indexName],j},i.init(),n(c,i)});