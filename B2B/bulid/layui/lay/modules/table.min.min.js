layui.define(["laytpl","laypage","layer","form"],function(F){var m=layui.$,a=layui.laytpl,y=layui.laypage,c=layui.layer,e=layui.form,f=layui.hint(),i=layui.device(),C={config:{checkName:"LAY_CHECKED",indexName:"LAY_TABLE_INDEX"},cache:{},index:layui.table?layui.table.index+10000:0,set:function(j){var q=this;return q.config=m.extend({},q.config,j),q},on:function(j,q){return layui.onevent.call(this,l,j,q)}},A=function(){var B=this,j=B.config,q=j.id;return q&&(A.config[q]=j),{reload:function(D){B.reload.call(B,D)},config:j}},l="table",n=".layui-table",N="layui-hide",T="layui-table-view",t=".layui-table-header",g=".layui-table-body",d=".layui-table-main",p=".layui-table-fixed",S=".layui-table-fixed-l",s=".layui-table-fixed-r",z=".layui-table-tool",b=".layui-table-sort",r="layui-table-edit",k="layui-table-hover",u=function(j){return j=j||{},['<table cellspacing="0" cellpadding="0" border="0" class="layui-table" ','{{# if(d.data.skin){ }}lay-skin="{{d.data.skin}}"{{# } }} {{# if(d.data.size){ }}lay-size="{{d.data.size}}"{{# } }} {{# if(d.data.even){ }}lay-even{{# } }}>',"<thead>","{{# layui.each(d.data.cols, function(i1, item1){ }}","<tr>","{{# layui.each(item1, function(i2, item2){ }}",'{{# if(item2.fixed && item2.fixed !== "right"){ left = true; } }}','{{# if(item2.fixed === "right"){ right = true; } }}',function(){return j.fixed&&"right"!==j.fixed?'{{# if(item2.fixed && item2.fixed !== "right"){ }}':"right"===j.fixed?'{{# if(item2.fixed === "right"){ }}':""}(),"{{# if(item2.checkbox){ }}",'<th data-field="{{ item2.field||i2 }}" data-type="checkbox" {{#if(item2.colspan){}} colspan="{{item2.colspan}}"{{#} if(item2.rowspan){}} rowspan="{{item2.rowspan}}"{{#}}} unresize="true"><div class="layui-table-cell laytable-cell-checkbox"><input type="checkbox" name="layTableCheckbox" lay-skin="primary" lay-filter="layTableAllChoose" {{# if(item2[d.data.checkName]){ }}checked{{# }; }}></div></th>',"{{# } else if(item2.space){ }}",'<th data-field="{{ item2.field||i2 }}" {{#if(item2.colspan){}} colspan="{{item2.colspan}}"{{#} if(item2.rowspan){}} rowspan="{{item2.rowspan}}"{{#}}} unresize="true"><div class="layui-table-cell laytable-cell-space"></div></th>',"{{# } else { }}",'<th data-field="{{ item2.field||i2 }}" {{#if(item2.colspan){}} colspan="{{item2.colspan}}"{{#} if(item2.rowspan){}} rowspan="{{item2.rowspan}}"{{#}}} {{# if(item2.unresize){ }}unresize="true"{{# } }}>',"{{# if(item2.colspan > 1){ }}",'<div class="layui-table-cell laytable-cell-group" {{#if(item2.align){}}align="{{item2.align}}"{{#}}}>','<span>{{item2.title||""}}</span>',"</div>","{{# } else { }}",'<div class="layui-table-cell laytable-cell-{{d.index}}-{{item2.field||i2}}" {{#if(item2.align){}}align="{{item2.align}}"{{#}}}>','<span>{{item2.title||""}}</span>',"{{# if(item2.sort){ }}",'<span class="layui-table-sort layui-inline"><i class="layui-edge layui-table-sort-asc"></i><i class="layui-edge layui-table-sort-desc"></i></span>',"{{# } }}","</div>","{{# } }}","</th>","{{# }; }}",j.fixed?"{{# }; }}":"","{{# }); }}","</tr>","{{# }); }}","</thead>","</table>"].join("")},o=['<table cellspacing="0" cellpadding="0" border="0" class="layui-table" ','{{# if(d.data.skin){ }}lay-skin="{{d.data.skin}}"{{# } }} {{# if(d.data.size){ }}lay-size="{{d.data.size}}"{{# } }} {{# if(d.data.even){ }}lay-even{{# } }}>',"<tbody></tbody>","</table>"].join(""),w=['<div class="layui-form layui-border-box {{d.VIEW_CLASS}}" lay-filter="LAY-table-{{d.index}}" style="{{# if(d.data.width){ }}width:{{d.data.width}}px;{{# } }} {{# if(d.data.height){ }}height:{{d.data.height}}px;{{# } }}">',"{{# var left, right; }}",'<div class="layui-table-header">',u(),"</div>",'<div class="layui-table-body layui-table-main">',o,"</div>","{{# if(left){ }}",'<div class="layui-table-fixed layui-table-fixed-l">','<div class="layui-table-header">',u({fixed:!0}),"</div>",'<div class="layui-table-body">',o,"</div>","</div>","{{# }; }}","{{# if(right){ }}",'<div class="layui-table-fixed layui-table-fixed-r">','<div class="layui-table-header">',u({fixed:"right"}),'<div class="layui-table-mend"></div>',"</div>",'<div class="layui-table-body">',o,"</div>","</div>","{{# }; }}","{{# if(d.data.page){ }}",'<div class="layui-table-tool">','<div class="layui-inline layui-table-page" id="layui-table-page{{d.index}}"></div>',"</div>","{{# } }}","<style>","{{# layui.each(d.data.cols, function(i1, item1){","layui.each(item1, function(i2, item2){ }}",".laytable-cell-{{d.index}}-{{item2.field||i2}}{ width:{{item2.width||50}}px }","{{# });","}); }}","</style>","</div>"].join(""),x=m(window),v=m(document),h=function(j){var q=this;q.index=++C.index,q.config=m.extend({},q.config,C.config,j),q.render()};h.prototype.config={limit:30,loading:!0},h.prototype.render=function(E){var H,j=this;if(E&&(j.config=E),H=j.config,H.elem=m(H.elem),H.where=H.where||{},H.request=m.extend({pageName:"page",limitName:"limit"},H.request),H.response=m.extend({statusName:"code",statusCode:0,msgName:"msg",dataName:"data",countName:"count"},H.response),!H.elem[0]){return j}var q=H.elem,B=q.next("."+T);H.height&&/^full-\d+$/.test(H.height)&&(j.fullHeightGap=H.height.split("-")[1],H.height=x.height()-j.fullHeightGap);var G=j.elem=m(a(w).render({VIEW_CLASS:T,data:H,index:j.index}));if(H.index=j.index,B[0]&&B.remove(),q.after(G),j.layHeader=G.find(t),j.layMain=G.find(d),j.layBody=G.find(g),j.layFixed=G.find(p),j.layFixLeft=G.find(S),j.layFixRight=G.find(s),j.layTool=G.find(z),H.height&&j.fullSize(),H.cols.length>1){var D=j.layFixed.find(t).find("th");D.height(j.layHeader.height()-1-parseFloat(D.css("padding-top"))-parseFloat(D.css("padding-bottom")))}j.pullData(1),j.events()},h.prototype.reload=function(j){var q=this;q.config=m.extend({},q.config,j),q.render()},h.prototype.pullData=function(D,E){var j=this,G=j.config,H=G.request,I=G.response,B=function(){"object"==typeof G.initSort&&j.sort(G.initSort.field,G.initSort.type)};if(G.url){var q={};q[H.pageName]=D,q[H.limitName]=G.limit,m.ajax({type:G.method||"get",url:G.url,data:m.extend(q,G.where),dataType:"json",success:function(L){return L[I.statusName]!=I.statusCode?(j.renderForm(),j.layMain.html('<div class="layui-none">'+(L[I.msgName]||"返回的数据状态异常")+"</div>")):(j.renderData(L,D,L[I.countName]),B(),E&&c.close(E),void ("function"==typeof G.done&&G.done(L,D,L[I.countName])))},error:function(M,L){j.layMain.html('<div class="layui-none">数据接口请求异常</div>'),j.renderForm(),E&&c.close(E)}})}else{if(G.data&&G.data.constructor===Array){var J={},K=D*G.limit-G.limit;J[I.dataName]=G.data.concat().splice(K,G.limit),J[I.countName]=G.data.length,j.renderData(J,D,G.data.length),B(),"function"==typeof G.done&&G.done(J,D,J[I.countName])}}},h.prototype.page=1,h.prototype.eachCols=function(j){layui.each(this.config.cols,function(B,q){layui.each(q,function(D,E){j(D,E,[B,q])})})},h.prototype.renderData=function(q,E,G,I){var j=this,J=j.config,K=q[J.response.dataName]||[],B=[],D=[],L=[],H=function(){return !I&&j.sortKey?j.sort(j.sortKey.field,j.sortKey.sort,!0):(layui.each(K,function(M,P){var R=[],O=[],Q=[];0!==P.length&&(I||(P[C.config.indexName]=M),j.eachCols(function(V,W){var U=P[W.field||V];if(void 0!==U&&null!==U||(U=""),!(W.colspan>1)){var X=['<td data-field="'+(W.field||V)+'"'+function(){var Y=[];return W.edit&&Y.push(' data-edit="true"'),W.align&&Y.push(' align="'+W.align+'"'),W.templet&&Y.push(' data-content="'+U+'"'),W.toolbar&&Y.push(' data-off="true"'),W.event&&Y.push(' lay-event="'+W.event+'"'),W.style&&Y.push(' style="'+W.style+'"'),Y.join("")}()+">",'<div class="layui-table-cell laytable-cell-'+function(){return W.checkbox?"checkbox":W.space?"space":J.index+"-"+(W.field||V)}()+'">'+function(){return W.checkbox?'<input type="checkbox" name="layTableCheckbox" lay-skin="primary" '+function(){var Y=C.config.checkName;return W[Y]?(P[Y]=W[Y],W[Y]?"checked":""):P[Y]?"checked":""}()+">":W.toolbar?a(m(W.toolbar).html()||"").render(P):W.templet?a(m(W.templet).html()||String(U)).render(P):U}(),"</div></td>"].join("");R.push(X),W.fixed&&"right"!==W.fixed&&O.push(X),"right"===W.fixed&&Q.push(X)}}),B.push('<tr data-index="'+M+'">'+R.join("")+"</tr>"),D.push('<tr data-index="'+M+'">'+O.join("")+"</tr>"),L.push('<tr data-index="'+M+'">'+Q.join("")+"</tr>"))}),j.layBody.scrollTop(0),j.layMain.find("tbody").html(B.join("")),j.layFixLeft.find("tbody").html(D.join("")),j.layFixRight.find("tbody").html(L.join("")),j.renderForm(),j.syncCheckAll(),j.haveInit?j.scrollPatch():setTimeout(function(){j.scrollPatch()},50),j.haveInit=!0,void c.close(j.tipsIndex))};return j.key=J.id||J.index,C.cache[j.key]=K,I?H():0===K.length?(j.renderForm(),j.layFixed.remove(),j.layMain.html('<div class="layui-none">无数据</div>')):(H(),void (J.page&&(j.page=E,j.count=G,y.render({elem:"layui-table-page"+J.index,count:G,groups:3,limits:J.limits||[10,20,30,40,50,60,70,80,90],limit:J.limit,curr:E,layout:["prev","page","next","skip","count","limit"],prev:'<i class="layui-icon">&#xe603;</i>',next:'<i class="layui-icon">&#xe602;</i>',jump:function(M,O){O||(j.page=M.curr,J.limit=M.limit,j.pullData(M.curr,j.loading()))}}),j.layTool.find(".layui-table-count span").html(G))))},h.prototype.renderForm=function(j){e.render(j||"checkbox","LAY-table-"+this.index)},h.prototype.sort=function(L,q,I,D){var H,K,G=this,M=G.config,j=M.elem.attr("lay-filter"),J=C.cache[G.key];"string"==typeof L&&G.layHeader.find("th").each(function(P,Q){var R=m(this),O=R.data("field");if(O===L){return L=R,H=O,!1}});try{var H=H||L.data("field");if(G.sortKey&&!I&&H===G.sortKey.field&&q===G.sortKey.sort){return}var E=G.layHeader.find("th .laytable-cell-"+M.index+"-"+H).find(b);G.layHeader.find("th").find(b).removeAttr("lay-sort"),E.attr("lay-sort",q||null),G.layFixed.find("th")}catch(B){return f.error("Table modules: Did not match to field")}G.sortKey={field:H,sort:q},"asc"===q?K=layui.sort(J,H):"desc"===q?K=layui.sort(J,H,!0):(K=layui.sort(J,C.config.indexName),delete G.sortKey),G.renderData({data:K},G.page,G.count,!0),c.close(G.tipsIndex),D&&layui.event.call(L,l,"sort("+j+")",{field:H,type:q})},h.prototype.loading=function(){var j=this,q=j.config;if(q.loading&&q.url){return c.msg("数据请求中",{icon:16,offset:[j.elem.offset().top+j.elem.height()/2-35-x.scrollTop()+"px",j.elem.offset().left+j.elem.width()/2-90-x.scrollLeft()+"px"],anim:-1,fixed:!1})}},h.prototype.setCheckData=function(q,B){var D=this,E=D.config,j=C.cache[D.key];j[q]&&(j[q][E.checkName]=B)},h.prototype.syncCheckAll=function(){var q=this,B=q.config,D=q.layHeader.find('input[name="layTableCheckbox"]'),j=function(E){return q.eachCols(function(G,H){H.checkbox&&(H[B.checkName]=E)}),E};D[0]&&(C.checkStatus(q.key).isAll?(D[0].checked||(D.prop("checked",!0),q.renderForm()),j(!0)):(D[0].checked&&(D.prop("checked",!1),q.renderForm()),j(!1)))},h.prototype.getCssRule=function(B,D){var E=this,G=E.elem.find("style")[0],j=G.sheet||G.styleSheet,q=j.cssRules||j.rules;layui.each(q,function(H,I){if(I.selectorText===".laytable-cell-"+E.index+"-"+B){return D(I),!0}})},h.prototype.fullSize=function(){var q,B=this,D=B.config,j=D.height;B.fullHeightGap&&(j=x.height()-B.fullHeightGap,j<135&&(j=135),B.elem.css("height",j)),q=parseFloat(j)-parseFloat(B.layHeader.height())-1,D.page&&(q-=parseFloat(B.layTool.outerHeight()+1)),B.layBody.css("height",q)},h.prototype.scrollPatch=function(){var B=this,D=B.layMain.children("table"),E=B.layMain.width()-B.layMain.prop("clientWidth"),j=B.layMain.height()-B.layMain.prop("clientHeight");if(E&&j){if(!B.elem.find(".layui-table-patch")[0]){var q=m('<th class="layui-table-patch"><div class="layui-table-cell"></div></th>');q.find("div").css({width:E}),B.layHeader.eq(0).find("thead tr").append(q)}}else{B.layHeader.eq(0).find(".layui-table-patch").remove()}B.layFixed.find(g).css("height",B.layMain.height()-j),B.layFixRight[D.width()>B.layMain.width()?"removeClass":"addClass"](N),B.layFixRight.css("right",E-1)},h.prototype.events=function(){var D,q=this,H=q.config,B=m("body"),j={},I=q.layHeader.find("th"),E=".layui-table-cell",G=H.elem.attr("lay-filter");I.on("mousemove",function(M){var J=m(this),K=J.offset().left,L=M.clientX-K;J.attr("colspan")>1||J.attr("unresize")||j.resizeStart||(j.allowResize=J.width()-L<=10,B.css("cursor",j.allowResize?"col-resize":""))}).on("mouseleave",function(){m(this);j.resizeStart||B.css("cursor","")}).on("mousedown",function(K){if(j.allowResize){var J=m(this).data("field");K.preventDefault(),j.resizeStart=!0,j.offset=[K.clientX,K.clientY],q.getCssRule(J,function(L){j.rule=L,j.ruleWidth=parseFloat(L.style.width)})}}),v.on("mousemove",function(K){if(j.resizeStart){if(K.preventDefault(),j.rule){var J=j.ruleWidth+K.clientX-j.offset[0];j.rule.style.width=J+"px",c.close(q.tipsIndex)}D=1}}).on("mouseup",function(J){j.resizeStart&&(j={},B.css("cursor",""),q.scrollPatch()),2===D&&(D=null)}),I.on("click",function(){var M,J=m(this),K=J.find(b),L=K.attr("lay-sort");return K[0]&&1!==D?(M="asc"===L?"desc":"desc"===L?null:"asc",void q.sort(J,M,null,!0)):D=2}).find(b+" .layui-edge ").on("click",function(L){var M=m(this),J=M.index(),K=M.parents("th").eq(0).data("field");layui.stope(L),0===J?q.sort(K,"asc",null,!0):q.sort(K,"desc",null,!0)}),q.elem.on("click",'input[name="layTableCheckbox"]+',function(){var M=m(this).prev(),O=q.layBody.find('input[name="layTableCheckbox"]'),J=M.parents("tr").eq(0).data("index"),L=M[0].checked,K="layTableAllChoose"===M.attr("lay-filter");K?(O.each(function(P,Q){Q.checked=L,q.setCheckData(P,L)}),q.syncCheckAll(),q.renderForm()):(q.setCheckData(J,L),q.syncCheckAll()),layui.event.call(this,l,"checkbox("+G+")",{checked:L,data:C.cache[q.key][J],type:K?"all":"one"})}),q.layBody.on("mouseenter","tr",function(){var K=m(this),J=K.index();q.layBody.find("tr:eq("+J+")").addClass(k)}).on("mouseleave","tr",function(){var K=m(this),J=K.index();q.layBody.find("tr:eq("+J+")").removeClass(k)}),q.layBody.on("change","."+r,function(){var M=m(this),O=this.value,J=M.parent().data("field"),L=M.parents("tr").eq(0).data("index"),K=C.cache[q.key][L];K[J]=O,layui.event.call(this,l,"edit("+G+")",{value:O,data:K,field:J})}).on("blur","."+r,function(){var M,J=m(this),L=J.parent().data("field"),K=J.parents("tr").eq(0).data("index"),O=C.cache[q.key][K];q.eachCols(function(Q,P){P.field==L&&P.templet&&(M=P.templet)}),J.siblings(E).html(M?a(m(M).html()||this.value).render(O):this.value),J.parent().data("content",this.value),J.remove()}),q.layBody.on("click","td",function(){var L=m(this),J=(L.data("field"),L.children(E));if(!L.data("off")){if(L.data("edit")){var K=m('<input class="'+r+'">');return K[0].value=L.data("content")||J.text(),L.find("."+r)[0]||L.append(K),K.focus()}J.prop("scrollWidth")>J.outerWidth()&&(q.tipsIndex=c.tips(['<div class="layui-table-tips-main" style="margin-top: -'+(J.height()+16)+"px;"+function(){return"sm"===H.size?"padding: 4px 15px; font-size: 12px;":"lg"===H.size?"padding: 14px 15px;":""}()+'">',J.html(),"</div>",'<i class="layui-icon layui-table-tips-c">&#x1006;</i>'].join(""),J[0],{tips:[3,""],time:-1,anim:-1,maxWidth:i.ios||i.android?300:600,isOutAnim:!1,skin:"layui-table-tips",success:function(O,M){O.find(".layui-table-tips-c").on("click",function(){c.close(M)})}}))}}),q.layBody.on("click","*[lay-event]",function(){var M=m(this),J=M.parents("tr").eq(0).data("index"),L=q.layBody.find('tr[data-index="'+J+'"]'),K="layui-table-click",O=C.cache[q.key][J];layui.event.call(this,l,"tool("+G+")",{data:C.clearCacheKey(O),event:M.attr("lay-event"),tr:L,del:function(){C.cache[q.key][J]=[],L.remove(),q.scrollPatch()},update:function(P){P=P||{},layui.each(P,function(R,U){if(R in O){var Q;O[R]=U,q.eachCols(function(W,V){V.field==R&&V.templet&&(Q=V.templet)}),L.children('td[data-field="'+R+'"]').children(E).html(Q?a(m(Q).html()||U).render(O):U)}})}}),L.addClass(K).siblings("tr").removeClass(K)}),q.layMain.on("scroll",function(){var L=m(this),J=L.scrollLeft(),K=L.scrollTop();q.layHeader.scrollLeft(J),q.layFixed.find(g).scrollTop(K),c.close(q.tipsIndex)}),x.on("resize",function(){q.fullSize(),q.scrollPatch()})},C.init=function(B,D){D=D||{};var E=this,j=m(B?'table[lay-filter="'+B+'"]':n+"[lay-data]"),q="Table element property lay-data configuration item has a syntax error: ";return j.each(function(){var J=m(this),K=J.attr("lay-data");try{K=new Function("return "+K)()}catch(H){f.error(q+K)}var G=[],I=m.extend({elem:this,cols:[],data:[],skin:J.attr("lay-skin"),size:J.attr("lay-size"),even:"string"==typeof J.attr("lay-even")},C.config,D,K);B&&J.hide(),J.find("thead>tr").each(function(L){I.cols[L]=[],m(this).children().each(function(P){var Q=m(this),R=Q.attr("lay-data");try{R=new Function("return "+R)()}catch(O){return f.error(q+R)}var M=m.extend({title:Q.text(),colspan:Q.attr("colspan"),rowspan:Q.attr("rowspan")},R);G.push(M),I.cols[L].push(M)})}),J.find("tbody>tr").each(function(M){var O=m(this),L={};O.children("td").each(function(R,U){var P=m(this),Q=P.data("field");if(Q){return L[Q]=P.html()}}),layui.each(G,function(Q,R){var P=O.children("td").eq(Q);L[R.field]=P.html()}),I.data[M]=L}),C.render(I)}),E},C.checkStatus=function(q){var B=0,D=[],j=C.cache[q];return j?(layui.each(j,function(E,G){G[C.config.checkName]&&(B++,D.push(C.clearCacheKey(G)))}),{data:D,isAll:B===j.length}):{}},A.config={},C.reload=function(q,B){var j=A.config[q];return j?C.render(m.extend({},j,B)):f.error("The ID option was not found in the table instance")},C.render=function(j){var q=new h(j);return A.call(q)},C.clearCacheKey=function(j){return j=m.extend({},j),delete j[C.config.checkName],delete j[C.config.indexName],j},C.init(),F(l,C)});