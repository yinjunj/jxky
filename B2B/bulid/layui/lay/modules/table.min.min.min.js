layui.define(["laytpl","laypage","layer","form"],function(K){var W=layui.$,ah=layui.laytpl,E=layui.laypage,af=layui.layer,ad=layui.form,ac=layui.hint(),Z=layui.device(),P={config:{checkName:"LAY_CHECKED",indexName:"LAY_TABLE_INDEX"},cache:{},index:layui.table?layui.table.index+10000:0,set:function(a){var b=this;return b.config=W.extend({},b.config,a),b},on:function(a,b){return layui.onevent.call(this,X,a,b)}},R=function(){var c=this,a=c.config,b=a.id;return b&&(R.config[b]=a),{reload:function(d){c.reload.call(c,d)},config:a}},X="table",V=".layui-table",B="layui-hide",j="layui-table-view",L=".layui-table-header",ab=".layui-table-body",ae=".layui-table-main",Q=".layui-table-fixed",q=".layui-table-fixed-l",M=".layui-table-fixed-r",D=".layui-table-tool",ag=".layui-table-sort",O="layui-table-edit",Y="layui-table-hover",J=function(a){return a=a||{},['<table cellspacing="0" cellpadding="0" border="0" class="layui-table" ','{{# if(d.data.skin){ }}lay-skin="{{d.data.skin}}"{{# } }} {{# if(d.data.size){ }}lay-size="{{d.data.size}}"{{# } }} {{# if(d.data.even){ }}lay-even{{# } }}>',"<thead>","{{# layui.each(d.data.cols, function(i1, item1){ }}","<tr>","{{# layui.each(item1, function(i2, item2){ }}",'{{# if(item2.fixed && item2.fixed !== "right"){ left = true; } }}','{{# if(item2.fixed === "right"){ right = true; } }}',function(){return a.fixed&&"right"!==a.fixed?'{{# if(item2.fixed && item2.fixed !== "right"){ }}':"right"===a.fixed?'{{# if(item2.fixed === "right"){ }}':""}(),"{{# if(item2.checkbox){ }}",'<th data-field="{{ item2.field||i2 }}" data-type="checkbox" {{#if(item2.colspan){}} colspan="{{item2.colspan}}"{{#} if(item2.rowspan){}} rowspan="{{item2.rowspan}}"{{#}}} unresize="true"><div class="layui-table-cell laytable-cell-checkbox"><input type="checkbox" name="layTableCheckbox" lay-skin="primary" lay-filter="layTableAllChoose" {{# if(item2[d.data.checkName]){ }}checked{{# }; }}></div></th>',"{{# } else if(item2.space){ }}",'<th data-field="{{ item2.field||i2 }}" {{#if(item2.colspan){}} colspan="{{item2.colspan}}"{{#} if(item2.rowspan){}} rowspan="{{item2.rowspan}}"{{#}}} unresize="true"><div class="layui-table-cell laytable-cell-space"></div></th>',"{{# } else { }}",'<th data-field="{{ item2.field||i2 }}" {{#if(item2.colspan){}} colspan="{{item2.colspan}}"{{#} if(item2.rowspan){}} rowspan="{{item2.rowspan}}"{{#}}} {{# if(item2.unresize){ }}unresize="true"{{# } }}>',"{{# if(item2.colspan > 1){ }}",'<div class="layui-table-cell laytable-cell-group" {{#if(item2.align){}}align="{{item2.align}}"{{#}}}>','<span>{{item2.title||""}}</span>',"</div>","{{# } else { }}",'<div class="layui-table-cell laytable-cell-{{d.index}}-{{item2.field||i2}}" {{#if(item2.align){}}align="{{item2.align}}"{{#}}}>','<span>{{item2.title||""}}</span>',"{{# if(item2.sort){ }}",'<span class="layui-table-sort layui-inline"><i class="layui-edge layui-table-sort-asc"></i><i class="layui-edge layui-table-sort-desc"></i></span>',"{{# } }}","</div>","{{# } }}","</th>","{{# }; }}",a.fixed?"{{# }; }}":"","{{# }); }}","</tr>","{{# }); }}","</thead>","</table>"].join("")},U=['<table cellspacing="0" cellpadding="0" border="0" class="layui-table" ','{{# if(d.data.skin){ }}lay-skin="{{d.data.skin}}"{{# } }} {{# if(d.data.size){ }}lay-size="{{d.data.size}}"{{# } }} {{# if(d.data.even){ }}lay-even{{# } }}>',"<tbody></tbody>","</table>"].join(""),H=['<div class="layui-form layui-border-box {{d.VIEW_CLASS}}" lay-filter="LAY-table-{{d.index}}" style="{{# if(d.data.width){ }}width:{{d.data.width}}px;{{# } }} {{# if(d.data.height){ }}height:{{d.data.height}}px;{{# } }}">',"{{# var left, right; }}",'<div class="layui-table-header">',J(),"</div>",'<div class="layui-table-body layui-table-main">',U,"</div>","{{# if(left){ }}",'<div class="layui-table-fixed layui-table-fixed-l">','<div class="layui-table-header">',J({fixed:!0}),"</div>",'<div class="layui-table-body">',U,"</div>","</div>","{{# }; }}","{{# if(right){ }}",'<div class="layui-table-fixed layui-table-fixed-r">','<div class="layui-table-header">',J({fixed:"right"}),'<div class="layui-table-mend"></div>',"</div>",'<div class="layui-table-body">',U,"</div>","</div>","{{# }; }}","{{# if(d.data.page){ }}",'<div class="layui-table-tool">','<div class="layui-inline layui-table-page" id="layui-table-page{{d.index}}"></div>',"</div>","{{# } }}","<style>","{{# layui.each(d.data.cols, function(i1, item1){","layui.each(item1, function(i2, item2){ }}",".laytable-cell-{{d.index}}-{{item2.field||i2}}{ width:{{item2.width||50}}px }","{{# });","}); }}","</style>","</div>"].join(""),G=W(window),I=W(document),aa=function(a){var b=this;b.index=++P.index,b.config=W.extend({},b.config,P.config,a),b.render()};aa.prototype.config={limit:30,loading:!0},aa.prototype.render=function(e){var b,a=this;if(e&&(a.config=e),b=a.config,b.elem=W(b.elem),b.where=b.where||{},b.request=W.extend({pageName:"page",limitName:"limit"},b.request),b.response=W.extend({statusName:"code",statusCode:0,msgName:"msg",dataName:"data",countName:"count"},b.response),!b.elem[0]){return a}var d=b.elem,g=d.next("."+j);b.height&&/^full-\d+$/.test(b.height)&&(a.fullHeightGap=b.height.split("-")[1],b.height=G.height()-a.fullHeightGap);var c=a.elem=W(ah(H).render({VIEW_CLASS:j,data:b,index:a.index}));if(b.index=a.index,g[0]&&g.remove(),d.after(c),a.layHeader=c.find(L),a.layMain=c.find(ae),a.layBody=c.find(ab),a.layFixed=c.find(Q),a.layFixLeft=c.find(q),a.layFixRight=c.find(M),a.layTool=c.find(D),b.height&&a.fullSize(),b.cols.length>1){var f=a.layFixed.find(L).find("th");f.height(a.layHeader.height()-1-parseFloat(f.css("padding-top"))-parseFloat(f.css("padding-bottom")))}a.pullData(1),a.events()},aa.prototype.reload=function(a){var b=this;b.config=W.extend({},b.config,a),b.render()},aa.prototype.pullData=function(a,k){var d=this,i=d.config,h=i.request,g=i.response,c=function(){"object"==typeof i.initSort&&d.sort(i.initSort.field,i.initSort.type)};if(i.url){var b={};b[h.pageName]=a,b[h.limitName]=i.limit,W.ajax({type:i.method||"get",url:i.url,data:W.extend(b,i.where),dataType:"json",success:function(l){return l[g.statusName]!=g.statusCode?(d.renderForm(),d.layMain.html('<div class="layui-none">'+(l[g.msgName]||"返回的数据状态异常")+"</div>")):(d.renderData(l,a,l[g.countName]),c(),k&&af.close(k),void ("function"==typeof i.done&&i.done(l,a,l[g.countName])))},error:function(m,l){d.layMain.html('<div class="layui-none">数据接口请求异常</div>'),d.renderForm(),k&&af.close(k)}})}else{if(i.data&&i.data.constructor===Array){var f={},e=a*i.limit-i.limit;f[g.dataName]=i.data.concat().splice(e,i.limit),f[g.countName]=i.data.length,d.renderData(f,a,i.data.length),c(),"function"==typeof i.done&&i.done(f,a,f[g.countName])}}},aa.prototype.page=1,aa.prototype.eachCols=function(a){layui.each(this.config.cols,function(c,b){layui.each(b,function(e,d){a(e,d,[c,b])})})},aa.prototype.renderData=function(b,l,k,h){var d=this,g=d.config,f=b[g.response.dataName]||[],c=[],a=[],e=[],i=function(){return !h&&d.sortKey?d.sort(d.sortKey.field,d.sortKey.sort,!0):(layui.each(f,function(r,o){var m=[],p=[],n=[];0!==o.length&&(h||(o[P.config.indexName]=r),d.eachCols(function(t,s){var u=o[s.field||t];if(void 0!==u&&null!==u||(u=""),!(s.colspan>1)){var v=['<td data-field="'+(s.field||t)+'"'+function(){var w=[];return s.edit&&w.push(' data-edit="true"'),s.align&&w.push(' align="'+s.align+'"'),s.templet&&w.push(' data-content="'+u+'"'),s.toolbar&&w.push(' data-off="true"'),s.event&&w.push(' lay-event="'+s.event+'"'),s.style&&w.push(' style="'+s.style+'"'),w.join("")}()+">",'<div class="layui-table-cell laytable-cell-'+function(){return s.checkbox?"checkbox":s.space?"space":g.index+"-"+(s.field||t)}()+'">'+function(){return s.checkbox?'<input type="checkbox" name="layTableCheckbox" lay-skin="primary" '+function(){var w=P.config.checkName;return s[w]?(o[w]=s[w],s[w]?"checked":""):o[w]?"checked":""}()+">":s.toolbar?ah(W(s.toolbar).html()||"").render(o):s.templet?ah(W(s.templet).html()||String(u)).render(o):u}(),"</div></td>"].join("");m.push(v),s.fixed&&"right"!==s.fixed&&p.push(v),"right"===s.fixed&&n.push(v)}}),c.push('<tr data-index="'+r+'">'+m.join("")+"</tr>"),a.push('<tr data-index="'+r+'">'+p.join("")+"</tr>"),e.push('<tr data-index="'+r+'">'+n.join("")+"</tr>"))}),d.layBody.scrollTop(0),d.layMain.find("tbody").html(c.join("")),d.layFixLeft.find("tbody").html(a.join("")),d.layFixRight.find("tbody").html(e.join("")),d.renderForm(),d.syncCheckAll(),d.haveInit?d.scrollPatch():setTimeout(function(){d.scrollPatch()},50),d.haveInit=!0,void af.close(d.tipsIndex))};return d.key=g.id||g.index,P.cache[d.key]=f,h?i():0===f.length?(d.renderForm(),d.layFixed.remove(),d.layMain.html('<div class="layui-none">无数据</div>')):(i(),void (g.page&&(d.page=l,d.count=k,E.render({elem:"layui-table-page"+g.index,count:k,groups:3,limits:g.limits||[10,20,30,40,50,60,70,80,90],limit:g.limit,curr:l,layout:["prev","page","next","skip","count","limit"],prev:'<i class="layui-icon">&#xe603;</i>',next:'<i class="layui-icon">&#xe602;</i>',jump:function(n,m){m||(d.page=n.curr,g.limit=n.limit,d.pullData(n.curr,d.loading()))}}),d.layTool.find(".layui-table-count span").html(k))))},aa.prototype.renderForm=function(a){ad.render(a||"checkbox","LAY-table-"+this.index)},aa.prototype.sort=function(f,b,i,a){var k,g,l=this,e=l.config,d=e.elem.attr("lay-filter"),h=P.cache[l.key];"string"==typeof f&&l.layHeader.find("th").each(function(p,o){var n=W(this),r=n.data("field");if(r===f){return f=n,k=r,!1}});try{var k=k||f.data("field");if(l.sortKey&&!i&&k===l.sortKey.field&&b===l.sortKey.sort){return}var m=l.layHeader.find("th .laytable-cell-"+e.index+"-"+k).find(ag);l.layHeader.find("th").find(ag).removeAttr("lay-sort"),m.attr("lay-sort",b||null),l.layFixed.find("th")}catch(c){return ac.error("Table modules: Did not match to field")}l.sortKey={field:k,sort:b},"asc"===b?g=layui.sort(h,k):"desc"===b?g=layui.sort(h,k,!0):(g=layui.sort(h,P.config.indexName),delete l.sortKey),l.renderData({data:g},l.page,l.count,!0),af.close(l.tipsIndex),a&&layui.event.call(f,X,"sort("+d+")",{field:k,type:b})},aa.prototype.loading=function(){var a=this,b=a.config;if(b.loading&&b.url){return af.msg("数据请求中",{icon:16,offset:[a.elem.offset().top+a.elem.height()/2-35-G.scrollTop()+"px",a.elem.offset().left+a.elem.width()/2-90-G.scrollLeft()+"px"],anim:-1,fixed:!1})}},aa.prototype.setCheckData=function(c,e){var d=this,b=d.config,a=P.cache[d.key];a[c]&&(a[c][b.checkName]=e)},aa.prototype.syncCheckAll=function(){var b=this,d=b.config,c=b.layHeader.find('input[name="layTableCheckbox"]'),a=function(e){return b.eachCols(function(g,f){f.checkbox&&(f[d.checkName]=e)}),e};c[0]&&(P.checkStatus(b.key).isAll?(c[0].checked||(c.prop("checked",!0),b.renderForm()),a(!0)):(c[0].checked&&(c.prop("checked",!1),b.renderForm()),a(!1)))},aa.prototype.getCssRule=function(f,e){var d=this,b=d.elem.find("style")[0],a=b.sheet||b.styleSheet,c=a.cssRules||a.rules;layui.each(c,function(h,g){if(g.selectorText===".laytable-cell-"+d.index+"-"+f){return e(g),!0}})},aa.prototype.fullSize=function(){var b,d=this,c=d.config,a=c.height;d.fullHeightGap&&(a=G.height()-d.fullHeightGap,a<135&&(a=135),d.elem.css("height",a)),b=parseFloat(a)-parseFloat(d.layHeader.height())-1,c.page&&(b-=parseFloat(d.layTool.outerHeight()+1)),d.layBody.css("height",b)},aa.prototype.scrollPatch=function(){var e=this,d=e.layMain.children("table"),c=e.layMain.width()-e.layMain.prop("clientWidth"),a=e.layMain.height()-e.layMain.prop("clientHeight");if(c&&a){if(!e.elem.find(".layui-table-patch")[0]){var b=W('<th class="layui-table-patch"><div class="layui-table-cell"></div></th>');b.find("div").css({width:c}),e.layHeader.eq(0).find("thead tr").append(b)}}else{e.layHeader.eq(0).find(".layui-table-patch").remove()}e.layFixed.find(ab).css("height",e.layMain.height()-a),e.layFixRight[d.width()>e.layMain.width()?"removeClass":"addClass"](B),e.layFixRight.css("right",c-1)},aa.prototype.events=function(){var g,f=this,c=f.config,h=W("body"),b={},a=f.layHeader.find("th"),e=".layui-table-cell",d=c.elem.attr("lay-filter");a.on("mousemove",function(m){var l=W(this),k=l.offset().left,i=m.clientX-k;l.attr("colspan")>1||l.attr("unresize")||b.resizeStart||(b.allowResize=l.width()-i<=10,h.css("cursor",b.allowResize?"col-resize":""))}).on("mouseleave",function(){W(this);b.resizeStart||h.css("cursor","")}).on("mousedown",function(i){if(b.allowResize){var k=W(this).data("field");i.preventDefault(),b.resizeStart=!0,b.offset=[i.clientX,i.clientY],f.getCssRule(k,function(l){b.rule=l,b.ruleWidth=parseFloat(l.style.width)})}}),I.on("mousemove",function(i){if(b.resizeStart){if(i.preventDefault(),b.rule){var k=b.ruleWidth+i.clientX-b.offset[0];b.rule.style.width=k+"px",af.close(f.tipsIndex)}g=1}}).on("mouseup",function(i){b.resizeStart&&(b={},h.css("cursor",""),f.scrollPatch()),2===g&&(g=null)}),a.on("click",function(){var m,l=W(this),k=l.find(ag),i=k.attr("lay-sort");return k[0]&&1!==g?(m="asc"===i?"desc":"desc"===i?null:"asc",void f.sort(l,m,null,!0)):g=2}).find(ag+" .layui-edge ").on("click",function(i){var m=W(this),l=m.index(),k=m.parents("th").eq(0).data("field");layui.stope(i),0===l?f.sort(k,"asc",null,!0):f.sort(k,"desc",null,!0)}),f.elem.on("click",'input[name="layTableCheckbox"]+',function(){var n=W(this).prev(),m=f.layBody.find('input[name="layTableCheckbox"]'),l=n.parents("tr").eq(0).data("index"),i=n[0].checked,k="layTableAllChoose"===n.attr("lay-filter");k?(m.each(function(p,o){o.checked=i,f.setCheckData(p,i)}),f.syncCheckAll(),f.renderForm()):(f.setCheckData(l,i),f.syncCheckAll()),layui.event.call(this,X,"checkbox("+d+")",{checked:i,data:P.cache[f.key][l],type:k?"all":"one"})}),f.layBody.on("mouseenter","tr",function(){var i=W(this),k=i.index();f.layBody.find("tr:eq("+k+")").addClass(Y)}).on("mouseleave","tr",function(){var i=W(this),k=i.index();f.layBody.find("tr:eq("+k+")").removeClass(Y)}),f.layBody.on("change","."+O,function(){var n=W(this),m=this.value,l=n.parent().data("field"),i=n.parents("tr").eq(0).data("index"),k=P.cache[f.key][i];k[l]=m,layui.event.call(this,X,"edit("+d+")",{value:m,data:k,field:l})}).on("blur","."+O,function(){var n,l=W(this),i=l.parent().data("field"),k=l.parents("tr").eq(0).data("index"),m=P.cache[f.key][k];f.eachCols(function(o,p){p.field==i&&p.templet&&(n=p.templet)}),l.siblings(e).html(n?ah(W(n).html()||this.value).render(m):this.value),l.parent().data("content",this.value),l.remove()}),f.layBody.on("click","td",function(){var i=W(this),l=(i.data("field"),i.children(e));if(!i.data("off")){if(i.data("edit")){var k=W('<input class="'+O+'">');return k[0].value=i.data("content")||l.text(),i.find("."+O)[0]||i.append(k),k.focus()}l.prop("scrollWidth")>l.outerWidth()&&(f.tipsIndex=af.tips(['<div class="layui-table-tips-main" style="margin-top: -'+(l.height()+16)+"px;"+function(){return"sm"===c.size?"padding: 4px 15px; font-size: 12px;":"lg"===c.size?"padding: 14px 15px;":""}()+'">',l.html(),"</div>",'<i class="layui-icon layui-table-tips-c">&#x1006;</i>'].join(""),l[0],{tips:[3,""],time:-1,anim:-1,maxWidth:Z.ios||Z.android?300:600,isOutAnim:!1,skin:"layui-table-tips",success:function(m,n){m.find(".layui-table-tips-c").on("click",function(){af.close(n)})}}))}}),f.layBody.on("click","*[lay-event]",function(){var n=W(this),l=n.parents("tr").eq(0).data("index"),i=f.layBody.find('tr[data-index="'+l+'"]'),k="layui-table-click",m=P.cache[f.key][l];layui.event.call(this,X,"tool("+d+")",{data:P.clearCacheKey(m),event:n.attr("lay-event"),tr:i,del:function(){P.cache[f.key][l]=[],i.remove(),f.scrollPatch()},update:function(o){o=o||{},layui.each(o,function(r,p){if(r in m){var s;m[r]=p,f.eachCols(function(t,u){u.field==r&&u.templet&&(s=u.templet)}),i.children('td[data-field="'+r+'"]').children(e).html(s?ah(W(s).html()||p).render(m):p)}})}}),i.addClass(k).siblings("tr").removeClass(k)}),f.layMain.on("scroll",function(){var i=W(this),l=i.scrollLeft(),k=i.scrollTop();f.layHeader.scrollLeft(l),f.layFixed.find(ab).scrollTop(k),af.close(f.tipsIndex)}),G.on("resize",function(){f.fullSize(),f.scrollPatch()})},P.init=function(e,d){d=d||{};var c=this,a=W(e?'table[lay-filter="'+e+'"]':V+"[lay-data]"),b="Table element property lay-data configuration item has a syntax error: ";return a.each(function(){var g=W(this),f=g.attr("lay-data");try{f=new Function("return "+f)()}catch(i){ac.error(b+f)}var k=[],h=W.extend({elem:this,cols:[],data:[],skin:g.attr("lay-skin"),size:g.attr("lay-size"),even:"string"==typeof g.attr("lay-even")},P.config,d,f);e&&g.hide(),g.find("thead>tr").each(function(l){h.cols[l]=[],W(this).children().each(function(o){var n=W(this),m=n.attr("lay-data");try{m=new Function("return "+m)()}catch(p){return ac.error(b+m)}var r=W.extend({title:n.text(),colspan:n.attr("colspan"),rowspan:n.attr("rowspan")},m);k.push(r),h.cols[l].push(r)})}),g.find("tbody>tr").each(function(n){var m=W(this),l={};m.children("td").each(function(p,o){var s=W(this),r=s.data("field");if(r){return l[r]=s.html()}}),layui.each(k,function(p,o){var r=m.children("td").eq(p);l[o.field]=r.html()}),h.data[n]=l}),P.render(h)}),c},P.checkStatus=function(b){var d=0,c=[],a=P.cache[b];return a?(layui.each(a,function(f,e){e[P.config.checkName]&&(d++,c.push(P.clearCacheKey(e)))}),{data:c,isAll:d===a.length}):{}},R.config={},P.reload=function(b,c){var a=R.config[b];return a?P.render(W.extend({},a,c)):ac.error("The ID option was not found in the table instance")},P.render=function(a){var b=new aa(a);return R.call(b)},P.clearCacheKey=function(a){return a=W.extend({},a),delete a[P.config.checkName],delete a[P.config.indexName],a},P.init(),K(X,P)});