var obj="";var detailVue=new Vue({el:"#index",data:{cartMess:{proId:"",shopId:"",type:"0",moId:"",moZid:""},buycarid_proid:"",buyshop_id:"",buymoId:"",buymoZid:"",indexId:0,shareShow:false,nowTime:"",show:false,detail:[],pics:[],cate_title:"",title:"",miaoshu:"",picsDetail:[],picFirst:"",markPriceOld:"",markPrice:"",sealPrice:"",promotion:[],promoShow:false,spec:[],dorShop:[],AppShop:[],appPage:0,num:1,score:"5.0",redStar:5,witStar:0,fixeShow:false,assesShow:true,couponShow:false,minNum:1,stock:0,sale:0,plList:[],biaoqian:"",plHp:0,plZp:0,plCp:0},mounted:function(){var b=this;b.nowTime=new Date().getTime();$.ajax({url:"/web_api/discuss/discuss_manage.php?m=Discuss_list&goods_id="+GetQueryStringAtob("id")+"&status=0",type:"get",async:true,dataType:"json",success:function(a){if(a.status==1){b.plList=a.data;b.biaoqian=a.impression;b.score=(parseInt(a.feedback.hpl)*0.05).toFixed(1);b.redStar=Math.round(parseInt(a.feedback.hpl)*0.05);b.witStar=5-b.redStar;b.plHp=a.hpnumber.hpnumber;b.plZp=a.zpnumber.zpnumber;b.plCp=a.cpnumber.cpnumber;vm.imgHoverBig()}}});$.ajax({url:"/web_api/item/index.php?c=PCGoods&m=IndexGoodsList&call_index=webdztj",type:"get",async:true,dataType:"json",success:function(a){b.dorShop=a.data}});$.ajax({url:"/web_api/item/index.php?c=PCGoods&m=IndexGoodsList&call_index=webptrx",async:true,dataType:"json",success:function(a){b.AppShop=a.data}});$.ajax({url:"/web_api/item/index.php?c=PCGoods&m=GetGoodsInfo",async:false,data:{pid:GetQueryStringAtob("pid"),id:GetQueryStringAtob("id")},dataType:"json",success:function(f){var d=f.data;if(f.status=1){b.detail=d.goods;b.buyshop_id=d.shop.ID;b.spec=d.product;var a="";if(GetQueryStringAtob("pid")==""){b.title=d.product[0].product_title;b.miaoshu=d.product[0].miaoshu;b.picFirst=d.product[0].imgs[0];b.pics=d.product[0].imgs;b.picsDetail=d.product[0].contents_mobi;b.indexId=0;b.markPriceOld=d.product[0].b2c_seal_price;b.markPrice=d.product[0].market_price;b.sealPrice=d.product[0].seal_price;b.stock=d.product[0].stock_headquarters;b.sale=d.product[0].sales;b.cate_title=d.product[0].cate_title;b.minNum=d.product[0].minimum_order_quantity;b.num=d.product[0].minimum_order_quantity;b.cartMess.proId=d.product[0].product_id;b.cartMess.shopId=d.product[0].shop_id;b.buycarid_proid=d.product[0].product_id;a=d.product[0].promotion}$.each(b.spec,function(c){if(b.spec[c].product_id==GetQueryStringAtob("pid")){b.picFirst=d.product[c].imgs[0];b.title=d.product[c].product_title;b.miaoshu=d.product[c].miaoshu;b.pics=d.product[c].imgs;b.picsDetail=d.product[c].contents_mobi;b.indexId=c;b.markPriceOld=d.product[c].b2c_seal_price;b.markPrice=d.product[c].market_price;b.stock=d.product[c].stock_headquarters;b.sale=d.product[c].sales;b.sealPrice=d.product[c].seal_price;b.cate_title=d.product[c].cate_title;b.minNum=d.product[c].minimum_order_quantity;b.num=d.product[c].minimum_order_quantity;b.cartMess.proId=d.product[c].product_id;b.cartMess.shopId=d.product[c].shop_id;b.buycarid_proid=d.product[c].product_id;a=d.product[c].promotion}});$.each(a,function(k){var c=a[k].start_time.replace(new RegExp("-","gm"),"/");var i=a[k].end_time.replace(new RegExp("-","gm"),"/");var l=(new Date(c)).getTime();var e=(new Date(i)).getTime();if(b.nowTime>=l&&b.nowTime<=e){b.promotion.push(a[k]);b.promoShow=true}});if(b.promotion.length!=0){b.cartMess.moId=b.promotion[0].id;b.buymoId=b.promotion[0].id;b.cartMess.moZid="";b.buymoZid="";if(b.promotion[0].gift.length!=0){if(b.promotion[0].zp_type==2){b.cartMess.moZid+=b.promotion[0].gift[0].id+","}else{$.each(b.promotion[0].gift,function(c){b.cartMess.moZid+=b.promotion[0].gift[c].id+","})}$.each(b.promotion[0].gift,function(c){b.buymoZid+=b.promotion[0].gift[c].id+","})}}}}});this.redStar=Math.round(this.score);this.witStar=5-this.redStar;window.addEventListener("scroll",this.handleScroll)},methods:{changePl:function(c){var d=this;$.ajax({url:"/web_api/discuss/discuss_manage.php?m=Discuss_list&goods_id="+GetQueryStringAtob("id")+"&status="+c,type:"get",async:true,dataType:"json",success:function(a){if(a.status==1){d.plList=a.data;vm.imgHoverBig()}}})},handleScroll:function(){var b=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;if(b>=800){this.fixeShow=true}else{this.fixeShow=false}},guige:function(h){var j=h.currentTarget;var i=this;if(!$(j).hasClass("active")){var g=$(j).index();$(j).addClass("active").siblings().removeClass("active");i.markPriceOld=i.spec[g].b2c_seal_price;i.markPrice=i.spec[g].market_price;i.stock=i.spec[g].stock_headquarters;i.sale=i.spec[g].sales;i.title=i.spec[g].product_title;i.miaoshu=i.spec[g].miaoshu;i.sealPrice=i.spec[g].seal_price;i.picFirst=i.spec[g].imgs[0];i.pics=i.spec[g].imgs;i.picsDetail=i.spec[g].contents_mobi;i.minNum=i.spec[g].minimum_order_quantity;i.num=i.spec[g].minimum_order_quantity;i.cartMess.proId=i.spec[g].product_id;i.cartMess.shopId=i.spec[g].shop_id;i.buycarid_proid=i.spec[g].product_id;obj=new mag(".show",".bigshow",".smallshow",".mask",".bigitem",i.pics.length);obj.init();var e=i.spec[g].promotion;i.promotion=[];if(e.length==0){i.promoShow=false;i.cartMess.moId="";i.cartMess.moZid="";i.buymoId="";i.buymoZid=""}else{$.each(e,function(d){var a=e[d].start_time.replace(new RegExp("-","gm"),"/");var c=e[d].end_time.replace(new RegExp("-","gm"),"/");var f=(new Date(a)).getTime();var b=(new Date(c)).getTime();if(i.nowTime>=f&&i.nowTime<=b){i.promotion.push(e[d]);i.promoShow=true}if(i.promotion.length!=0){i.cartMess.moId=i.promotion[0].id;i.buymoId=i.promotion[0].id;i.cartMess.moZid="";i.buymoZid="";if(i.promotion[0].gift.length!=0){if(i.promotion[0].zp_type==2){i.cartMess.moZid+=i.promotion[0].gift[0].id+","}else{$.each(i.promotion[0].gift,function(k){i.cartMess.moZid+=i.promotion[0].gift[k].id+","})}$.each(i.promotion[0].gift,function(k){i.buymoZid+=i.promotion[0].gift[k].id+","})}}})}}},detailClick:function(c){var d=c.currentTarget;if(!$(d).hasClass("active")){$(d).css({background:"#D5282C",color:"#fff"}).siblings().css({background:"transparent",color:"#949494"});$(d).addClass("active").siblings().removeClass("active");this.assesShow=!this.assesShow}},numClick:function(f,e){var d=f.currentTarget;if(e=="-"){if(this.num<=this.minNum){layer.msg("该商品最小起订量为"+this.minNum);this.num=this.minNum;return false}this.num--}else{this.num++}},numInput:function(){if(this.num<this.minNum){layer.msg("该商品最小起订量为"+this.minNum);this.num=this.minNum;return false}},payClick:function(){var c=this;if(vm.loginIs){if(c.num<c.minNum){layer.msg("该商品最小起订量为"+c.minNum)}else{if(c.num>c.stock){layer.msg("库存不足！")}else{var d=window.btoa("carid_proid="+c.buycarid_proid+"&is_car=1&type=0&number="+c.num+"&shop_id="+c.buyshop_id+"&motion_id="+c.buymoId+"&motion_zpid="+c.buymoZid);window.location.href="pay.html?"+d}}}else{vm.loginModel()}}}});window.onload=function(){obj=new mag(".show",".bigshow",".smallshow",".mask",".bigitem",detailVue.pics.length);obj.init();if($(".middle").children().length<=5){$(".smallshow>.next").css({background:"url(bulid/img/glass/next.png) no-repeat",cursor:"not-allowed"})}var b=$(".ptrx>li").height();$(".nextjt").click(function(){var a=$(".ptrx>li").length;if($(".ptrx").position().top<=-188*(a-3)){$(".ptrx").position().top=-188*(a-3)}else{$(".ptrx").animate({top:"-=570"},100)}});$(".prevjt").click(function(){if($(".ptrx").position().top>=0){$(".ptrx").animate({top:0},100)}else{$(".ptrx").animate({top:"+=570"},100)}})};