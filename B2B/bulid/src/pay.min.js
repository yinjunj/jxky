new Vue({el:"#index",data:{balanShow:false,show:false,pIndex:"",goodsPay:[],adrArr:[],adrName:"",adrAdr:"",adrPhone:"",order_type:"送货上门",totals:0,sendPrice:0,sendPrice1:0,message:[],payFs:"zfb",motionId:[],motionZid:[],zpMot:[],caridProid:[],specialId:"",shopId:"",numBuy:1,balance:"0.00",syBalnce:true},mounted:function(){var a=this;var b={carid_proid:"",is_car:"",type:"",shop_id:"",number:"",motion_id:"",motion_zpid:""};b.is_car=GetQueryStringAtob("is_car");b.carid_proid=GetQueryStringAtob("carid_proid");if(GetQueryStringAtob("is_car")==1){b.type=GetQueryStringAtob("type");b.shop_id=GetQueryStringAtob("shop_id");a.shopId=GetQueryStringAtob("shop_id");b.number=GetQueryStringAtob("number");a.numBuy=GetQueryStringAtob("number");b.motion_id=GetQueryStringAtob("motion_id");b.motion_zpid=GetQueryStringAtob("motion_zpid")}$.ajax({url:"/web_api/item/index.php?c=PC_shoppingcar&m=pay_list",async:false,data:b,dataType:"json",success:function(c){if(c.login_status==0){vm.loginModel()}else{if(c.status==1){if(c.data.ress_address.length!=0){a.adrArr=c.data.ress_address;a.adrName=c.data.ress_address[0].user_name;a.adrAdr=c.data.ress_address[0].province+c.data.ress_address[0].city+c.data.ress_address[0].area+c.data.ress_address[0].address;a.adrPhone=c.data.ress_address[0].mobile}a.goodsPay=c.data.goods;a.balance=c.data.b2b_balance;a.sendPrice=parseFloat(c.data.special_money);a.sendPrice1=parseFloat(c.data.special_money);a.totals=c.data.amount_pay-a.sendPrice;var e=c.data.goods;$.each(e,function(h){var d="";var g=[];var f="";a.specialId+=(e[h].special_id||0)+",";$.each(e[h].data_child,function(i){d+=(e[h].data_child[i].motion_id||0)+",";g.push(e[h].data_child[i].motion_zpid||0);f+=e[h].data_child[i].id+","});a.motionId.push(d);a.motionZid.push(g);a.zpMot.push(g);a.caridProid.push(f)});vm.imgHover()}else{layer.msg(c.msg)}}}})},methods:{promoZp:function(g,b,a){var f=this;var c=g.currentTarget;f.motionZid=[];var h=f.goodsPay;$.each(h,function(e){var d=[];$.each(h[e].data_child,function(i){if(b==e&&a==i){d.push($(c).val())}else{d.push(h[e].data_child[i].motion_zpid||0)}});f.motionZid.push(d)});f.zpMot=f.motionZid},promoIndex:function(k,g,f,h,i){var b=k.currentTarget;var j=this;j.pIndex=$(b).val();var c=j.goodsPay[g].data_child[f].Promotion;$(b).parent().siblings().find(".promoTitle").html(c[j.pIndex].title);$(b).parent().siblings().find(".promoZP").hide();j.motionId=[];var m=$(b).find("option:selected").attr("alt");var l=$(b).find("option:selected").attr("zpType");if(m=="mzeng"&&l=="2"){$(b).siblings().show();j.motionZid=j.zpMot}else{$(b).siblings().hide();j.motionZid=[]}$.each(j.goodsPay,function(o){var e="";$.each(j.goodsPay[o].data_child,function(p){if(o==g&&p==f){$.each(j.goodsPay[o].data_child[p].Promotion,function(q){if(q==j.pIndex){e+=(j.goodsPay[o].data_child[p].Promotion[q].id||0)+","}})}else{e+=(j.goodsPay[o].data_child[p].motion_id||0)+","}});j.motionId.push(e)});var n=(h*c[j.pIndex].seal_price).toFixed(2);$(b).parent().siblings().find(".sealPce").html("￥"+c[j.pIndex].seal_price);$(b).parent().siblings().find(".total").html("￥"+n);if(c[j.pIndex].type=="mzhe"){var a=Math.floor(h/c[j.pIndex].mzhe_number);if(a>0){a*c[j.pIndex].reduce_amount>c[j.pIndex].point?a=10-c[j.pIndex].point:a=a*c[j.pIndex].reduce_amount;var n=(h*i*(1-(a*0.1))).toFixed(2);$(b).parent().siblings().find(".total").html("￥"+n)}}else{if(c[j.pIndex].type=="mjy"){if(h*i>=c[j.pIndex].full_amount){var n=(h*i-c[j.pIndex].reduce_amount).toFixed(2);$(b).parent().siblings().find(".total").html("￥"+n)}}else{if(c[j.pIndex].type=="mjt"){if(h>=c[j.pIndex].mj_number){var n=(h*i-c[j.pIndex].reduce_amount).toFixed(2);$(b).parent().siblings().find(".total").html("￥"+n)}}else{if(c[j.pIndex].type=="mzeng"){var d="赠：";$.each(c[j.pIndex].titles,function(e){d+='<img class="toolimg" alt="'+c[j.pIndex].titles[e].zp_title+'" src="'+c[j.pIndex].titles[e].zp_pro_img+'"/>'});$(b).parent().siblings().find(".promoZP").show().html(d);vm.imgHover()}}}}j.totalz();j.total()},totalz:function(){var a=this;a.sendPrice=0;a.sendPrice1=0;$("tbody").each(function(){var c=0;var b=$(this).index()-1;$(this).find(".total").each(function(){var e=parseFloat($(this).text().substring(1));c+=e});var d=a.goodsPay[b];if(d.full_money&&c>=d.full_money){a.sendPrice-=Math.floor(c)*d.reduce_percen*0.01;a.sendPrice1-=Math.floor(c)*d.reduce_percen*0.01}else{if(d.full_money&&c>=d.droop_moneys){a.sendPrice+=Math.floor(c)*d.collect_percen*0.01;a.sendPrice1+=Math.floor(c)*d.collect_percen*0.01}else{if(d.collect_money){a.sendPrice+=parseFloat(d.collect_money);a.sendPrice1+=parseFloat(d.collect_money)}}}})},total:function(){var a=this;a.totals=0;$(".total").each(function(){var b=parseFloat($(this).text().substring(1));a.totals+=b})},payClick:function(){var a=this;if(a.order_type=="送货上门"&&a.adrName==""){layer.msg("请添加收货地址！");return false}if(a.payFs=="Balance"){if(a.totals+a.sendPrice>a.balance){layer.msg("您的余额不足！请选择其他支付方式或者前往充值！");return false}else{layer.prompt({title:"请输入支付密码！",formType:1},function(d,c){var b="pay_pwd="+d+"&user_id="+vm.user.uId+"&key=H1ereN3nfdF6wZcoeBdYUfQv7tq1Pq5t";var e=md5(b).toUpperCase();$.ajax({url:"/web_api/item/index.php?c=PC_order&m=order_add",async:true,data:{dealer_name:a.adrName,dealer_mobile:a.adrPhone,dealer_address:a.adrAdr,message:a.message,order_type:a.order_type,pay_type:a.payFs,motion_id:a.motionId,motion_zpid:a.motionZid,pay_device:"PC",coupon_id:"",is_car:GetQueryStringAtob("is_car"),carid_proid:a.caridProid,special_id:a.specialId,shop_id:a.shopId,number:a.numBuy,pwd:e},dataType:"json",success:function(f){if(f.login_status==0){vm.loginModel()}else{if(f.status=="5"){layer.closeAll();layer.msg(f.msg,{time:2000,end:function(){location.replace("myself.html");sessionStorage.setItem("index",2)}})}else{layer.msg(f.msg)}}}})})}}else{$.ajax({url:"/web_api/item/index.php?c=PC_order&m=order_add",async:true,data:{dealer_name:a.adrName,dealer_mobile:a.adrPhone,dealer_address:a.adrAdr,message:a.message,order_type:a.order_type,pay_type:a.payFs,motion_id:a.motionId,motion_zpid:a.motionZid,pay_device:"PC",coupon_id:"",is_car:GetQueryStringAtob("is_car"),carid_proid:a.caridProid,special_id:a.specialId,shop_id:a.shopId,number:a.numBuy},dataType:"json",success:function(d){if(d.login_status==0){vm.loginModel()}else{if(d.status==2){location.replace("/web_api/alipay/pagepay/pagepay.php")}else{if(d.status==3){var c=d.data;var f=d.order_id;var e=d.order_seqno;var b=function(){$.ajax({url:"/web_api/item/index.php?c=PC_order&m=query_order",async:false,data:{order_seqno:e,order_id:f},dataType:"json",success:function(h){if(h.status==1){layer.msg(h.msg,{shade:0.3,time:1500,end:function(){location.replace("myself.html");sessionStorage.setItem("index",2)}})}}})};var g=setInterval(b,3000);layer.open({type:1,shade:0.3,area:["240px","270px"],title:false,content:'<div style="padding: 10px;"><div class="tc"><img style="width: 200px;" src="'+c+'" alt=""></div><div style="display: flex; justify-content: space-between; width: 140px; margin: 5px auto;"><div><img src="bulid/img/saoma.png" alt="" style="width: 32px;"></div><div style="color: rgb(148, 148, 148); text-align: left;"><div style="margin-top: -2px;">打开 <span style="color: rgb(255, 69, 2);">手机微信 &nbsp;&nbsp;&nbsp;</span></div><div style="margin-top: -4px;">扫一扫继续支付</div></div></div></div>',end:function(){location.replace("myself.html");sessionStorage.setItem("index",2)}})}else{if(d.status==4){location.replace("/web_api/unionpay/demo/api_01_gateway/Form_6_2_FrontConsume.php")}else{if(d.status==1){location.replace("myself.html");sessionStorage.setItem("index",2)}else{layer.msg(d.msg)}}}}}}})}},modelAdr:function(){$(".pick-area").html(" ");$(".pick-area6").pickArea({width:"340",borderColor:"#ff8c00",arrowColor:"#ff8c00",listBdColor:"#ff8c00",color:"#ff8c00",hoverColor:"#ff8c00",getVal:function(){}})},sureClick:function(f,c,a){var b=f.currentTarget;var d=this;if(!$(b).hasClass("active")){$(b).addClass("active").siblings().removeClass("active")}if(c=="adr"){d.adrName=$(b).children().eq(0).text().split("：")[1];d.adrAdr=$(b).children().eq(1).text().split("：")[1];d.adrPhone=$(b).children().eq(2).text().split("：")[1]}else{if(c=="deliver"){d.order_type=$(b).text();if($(b).index()==0){d.sendPrice=d.sendPrice1}else{d.sendPrice=0}}else{if(c=="pay"){d.payFs=a;if(a=="Balance"){d.balanShow=true;d.syBalnce=true}else{d.balanShow=false;d.syBalnce=false}}}}}}});