var getObjectURL=function(c){var d=null;if(window.createObjectURL!=undefined){d=window.createObjectURL(c)}else{if(window.URL!=undefined){d=window.URL.createObjectURL(c)}else{if(window.webkitURL!=undefined){d=window.webkitURL.createObjectURL(c)}}}return d};function changepic(f){var e="https://img.aiucar.cn/";var d=$(f);$.ajax({url:"/api/oss/get.php?dir=user",type:"get",async:false,dataType:"json",success:function(q){var m=document.getElementById("form");var c=new FormData;var a=new FormData(m);var b=new Date();var p=b.getTime()+""+Math.random()*100000000000000000;var o=d.attr("name");c.set("key",q.dir+p+".jpg");c.set("policy",q.policy);c.set("OSSAccessKeyId",q.accessid);c.set("success_action_status","200");c.set("expire",q.expire);c.set("host",q.host);c.set("Signature",q.signature);c.append("file",a.get(o));var n=new XMLHttpRequest();n.open("POST",e);n.send(c);n.onreadystatechange=function(){if(n.readyState==4&&n.status==200){img_url_submit(q.dir+p+".jpg");layer.msg("上传成功！")}}}})}function img_url_submit(d){var c=getObjectURL($("#imgHead")[0].files[0]);$.ajax({url:"/web_api/item/index.php?c=PCHome&m=UpdateUsersInfo",async:true,data:{head_img:d},dataType:"json",beforeSend:function(){layer.load(1,{shade:0.3})},success:function(a){layer.closeAll();if(a.login_status==0){vm.loginModel()}else{if(a.status==1){$("#show").attr("src",c)}else{layer.msg(a.msg)}}}})}function qhCred(b){if(!$(b).hasClass("active")){$(b).addClass("active").siblings().removeClass("active");$("#credDrop").children().eq($(b).index()).show().siblings().hide()}}function creditzf(){$("#zffs").find(".addxy").hide();layer.open({type:1,shade:0.3,area:["450px","380px"],title:"支付方式",btn:["确认","取消"],content:$("#zffs"),yes:function(){}})}new Vue({el:"#index",data:{activeDel:{"text-align":"center",color:"#fff",background:"rgba(0,0,0,.4)","font-size":"2em","z-index":"22",position:"absolute",width:"100%",height:"100%",top:"0",left:"0"},page:0,pageTotal:1,show:true,index:1,spDetail:"",showAddr:false,codes:"获取验证码",myCollect:[],collectShow:false,history:[],historyShow:false,myCart:[],cartShow:false,myOrder:[],statusType:"all",order1Num:0,order2Num:0,order3Num:0,order4Num:0,orderShow:false,myAdr:[],adrShow:false,zfType:"zfb",myself:[],PLorder_id:"",PLorder_product_id:"",textVal:"",PLpic:"",PLnum1:0,PLnum2:0,PLnum3:0,PLnum4:0,PLnum5:0,PLpf1:0,PLpf2:0},mounted:function(){var c=this;var d=sessionStorage.getItem("index");if(d!=null){$(".myselfHead>div:nth-child("+d+")").click()}},methods:{dgzhxx:function(){layer.open({type:1,closeBtn:0,anim:2,area:["751px","284px"],shadeClose:true,title:false,content:'<div><img style="width: 751px;height: 284px;" src="../bulid/img/dgzhxx.png" alt=""></div>'})},credit:function(){layer.open({type:1,closeBtn:0,anim:2,area:["360px","360px"],shadeClose:true,title:false,content:'<div><div class="dis_flex credit"><span onclick="qhCred(this)" class="active hoverOpacity">账户明细</span><span onclick="qhCred(this)" class="hoverOpacity">还款金额</span></div><div id="credDrop"><div><ul style="color: #000;max-height: 305px;overflow: auto"><li style="border-bottom: 1px solid #ddd;padding: 8px 15px;" class="dis_flex"><div><div style="font-weight: bold;font-size: 1.1em">订单编号:</div><div style="color: #666">54465PFFSD5456415</div></div><div><div style="font-weight: bold;font-size: 1.1em">信用消费:<span style="color: red">￥33.00</span></div><div style="color: #666">2018-8-08-05 11:22</div></div></li><li style="border-bottom: 1px solid #ddd;padding: 8px 15px;" class="dis_flex"><div><div style="font-weight: bold;font-size: 1.1em">订单编号:</div><div style="color: #666">54465PFFSD5456415</div></div><div><div style="font-weight: bold;font-size: 1.1em">信用消费:<span style="color: red">￥33.00</span></div><div style="color: #666">2018-8-08-05 11:22</div></div></li></ul></div><div class="dis_no" style="font-size: 1.2em;margin-top: 35px;"><div class="dis_flex" style="justify-content: center"><div><div>使用额度：<span style="color: #1CACEC;font-weight: bold">￥5555.55</span></div><div>使用账期：<span>20天</span></div><div style="margin-top: 22px;">本期还款金额：<span style="color: red;font-weight: bold">￥555.55</span></div><div>本期还款日期：<span>2018-08-08</span></div><div onclick="creditzf()" style="margin-top: 22px"><span class="hoverOpacity" style="background: red;display: inline-block;padding: 10px 80px;color: #fff">立即还款</span></div></div></div></div></div></div>'})},orderIdClick:function(c,d){this.PLorder_product_id=c;this.PLorder_id=d},discuss:function(f){var e=f.currentTarget;var d=this;if($(".imgAll").find("li")){$(".imsg").each(function(){d.PLpic+=$(this).attr("value")+","})}$.ajax({url:"/web_api/discuss/discuss_manage.php?m=Off_evaluate",async:true,data:{uid:vm.user.uId,uname:vm.user.userName,order_id:d.PLorder_id,order_product_id:d.PLorder_product_id,content:d.textVal,pic:d.PLpic,num1:d.PLnum1,num2:d.PLnum2,num3:d.PLnum3,num4:d.PLnum4,num5:d.PLnum5,pf1:d.PLpf1,pf2:d.PLpf2},dataType:"json",beforeSend:function(){layer.load(1,{shade:0.3})},success:function(a){layer.closeAll();if(a.status==1){layer.msg("评论成功！",{time:2000,end:function(){$(e).siblings(".btn.btn-default").click()}})}else{layer.msg(a.msg)}}})},sureClick:function(g,e){var f=g.currentTarget;var h=this;if(!$(f).hasClass("active")){$(f).addClass("active").siblings().removeClass("active");h.zfType=e}},payList:function(){if(vm.checkedNames==""){layer.msg("请选择商品！")}else{var b=window.btoa("carid_proid="+vm.checkedNames+"&is_car=0");window.location.href="pay.html?"+b}},indexClick:function(c){var d=this;$(window).unbind("scroll");if(c==1){$.ajax({url:"/web_api/item/index.php?c=PCHome&m=MyCenter",async:true,dataType:"json",beforeSend:function(){layer.load(1,{shade:0.3})},success:function(a){layer.closeAll();if(a.login_status==0){vm.loginModel()}else{if(a.status==1){d.myself=a.data.UserInfo}}}})}else{if(c==2){d.page=0;d.orderNum();d.myOrder=[];d.orderList(d.page,d.statusType)}else{if(c==3){$.ajax({url:"/web_api/item/index.php?c=PC_shoppingcar&m=shopping_list",async:true,dataType:"json",beforeSend:function(){layer.load(1,{shade:0.3})},success:function(a){layer.closeAll();if(a.login_status==0){vm.loginModel()}else{if(a.status==1){d.myCart=a.data;d.cartShow=true}vm.imgHover()}}})}else{if(c==4){$.ajax({url:"/web_api/item/index.php?c=PCGoods&m=UserGoodsCollectList",async:true,dataType:"json",beforeSend:function(){layer.load(1,{shade:0.3})},success:function(a){layer.closeAll();if(a.login_status==0){vm.loginModel()}else{if(a.status==1){d.myCollect=a.data;d.collectShow=true;if(a.data.length==0){d.collectShow=false}}else{d.collectShow=false}}}})}else{if(c==5){$.ajax({url:"/web_api/item/index.php?c=PC_address&m=address",async:true,dataType:"json",beforeSend:function(){layer.load(1,{shade:0.3})},success:function(a){if(a.login_status==0){vm.loginModel()}else{if(a.status==1){d.myAdr=a.data;d.adrShow=true}layer.closeAll()}}})}else{if(c==6){$.ajax({url:"/web_api/item/index.php?c=PCHome&m=GoodsHistoryList",async:true,dataType:"json",beforeSend:function(){layer.load(1,{shade:0.3})},success:function(a){layer.closeAll();if(a.login_status==0){vm.loginModel()}else{if(a.status==1){if(a.data.length==0){d.historyShow=false}else{var b=[];$.each(a.data,function(f){b=b.concat(a.data[f].child_data)});d.history=b;d.historyShow=true}}else{d.historyShow=false}}}})}else{$(window).unbind("scroll")}}}}}}},shfw:function(h){var i=h.currentTarget;var j=$(i).parents("tr").find("td:first-child").html();var e=$(i).parents("tr").find("td:nth-child(2)").html();var g=$(i).parents("tr").find("td:nth-child(3)").html();this.spDetail='<table style="width: 90%;"><tr><td width="80%">'+j+'</td><td width="10%">'+g+'</td><td width="10%" style="text-align: center">'+e+"</td></tr></table>"},qxdd:function(b){layer.confirm("是否确认取消该订单？",{title:"提示！",btn:["确认","取消"]},function(){$.ajax({url:"/web_api/item/index.php?c=PC_orderlist&m=order_cancel&order_id="+b,async:true,dataType:"json",beforeSend:function(){layer.load(1,{shade:0.3})},success:function(a){if(a.login_status==0){vm.loginModel()}else{layer.closeAll();if(a.status==1){layer.msg(a.msg,{shade:0.3,time:1000,end:function(){location.reload()}})}else{layer.msg(a.msg)}}}})})},ljzf:function(c,d){if(d=="Balance"){layer.prompt({title:"请输入支付密码！",formType:1},function(b,g){var h="pay_pwd="+b+"&user_id="+vm.user.uId+"&key=H1ereN3nfdF6wZcoeBdYUfQv7tq1Pq5t";var a=md5(h).toUpperCase();$.ajax({url:"/web_api/item/index.php?c=PC_orderlist&m=pay&order_seqnos="+c,async:true,data:{pay_type:d,pay_pwd:a},dataType:"json",success:function(e){if(e.login_status==0){vm.loginModel()}else{if(e.status==5){layer.msg(e.msg,{time:2000,end:function(){location.reload()}})}else{layer.msg(e.msg)}}}})})}else{$.ajax({url:"/web_api/item/index.php?c=PC_orderlist&m=pay&order_seqnos="+c,async:true,data:{pay_type:d},dataType:"json",success:function(j){if(j.login_status==0){vm.loginModel()}else{if(j.status==2){window.location.href="/web_api/alipay/pagepay/pagepay.php"}else{if(j.status==3){var k=j.data;var b=j.order_id;var i=j.order_seqno;var l=function(){$.ajax({url:"/web_api/item/index.php?c=PC_order&m=query_order",async:false,data:{order_seqno:i,order_id:b},dataType:"json",success:function(e){if(e.status==1){layer.msg(e.msg,{shade:0.3,time:1500,end:function(){location.replace("myself.html");sessionStorage.setItem("index",2)}})}}})};var a=setInterval(l,3000);layer.open({type:1,shade:0.3,area:["240px","270px"],title:false,content:'<div style="padding: 10px;"><div class="tc"><img style="width: 200px;" src="'+k+'" alt=""></div><div style="display: flex; justify-content: space-between; width: 140px; margin: 5px auto;"><div><img src="bulid/img/saoma.png" alt="" style="width: 32px;"></div><div style="color: rgb(148, 148, 148); text-align: left;"><div style="margin-top: -2px;">打开 <span style="color: rgb(255, 69, 2);">手机微信 &nbsp;&nbsp;&nbsp;</span></div><div style="margin-top: -4px;">扫一扫继续支付</div></div></div></div>',end:function(){window.clearInterval(a)}})}else{if(j.status==4){window.location.href="/web_api/unionpay/demo/api_01_gateway/Form_6_2_FrontConsume.php"}else{if(j.status==1){layer.msg(j.msg,{time:1500,end:function(){location.reload()}})}else{layer.msg(j.msg)}}}}}}})}},ggzf:function(c){var d=this;layer.open({type:1,shade:0.3,area:["450px","380px"],title:"修改支付方式",btn:["确认","取消"],content:$("#zffs"),yes:function(){d.ljzf(c,d.zfType)}})},scdd:function(d,f){var e=d.currentTarget;layer.confirm("是否确认删除该订单？",{title:"提示！",btn:["确认","取消"]},function(){$.ajax({url:"/web_api/item/index.php?c=PC_orderlist&m=order_del&order_id="+f,async:true,dataType:"json",success:function(a){if(a.login_status==0){vm.loginModel()}else{if(a.status==1){layer.msg(a.msg,{time:1000,shade:0.3,end:function(){location.reload()}})}else{layer.msg(a.msg)}}}})})},pjSpan:function(g,f){var e=g.currentTarget;var h=this;if(!$(e).hasClass("active")){$(e).addClass("active");if(f==1){h.PLnum1=1}else{if(f==2){h.PLnum2=1}else{if(f==3){h.PLnum3=1}else{if(f==4){h.PLnum4=1}else{h.PLnum5=1}}}}}else{$(e).removeClass("active");if(f==1){h.PLnum1=0}else{if(f==2){h.PLnum2=0}else{if(f==3){h.PLnum3=0}else{if(f==4){h.PLnum4=0}else{h.PLnum5=0}}}}}},star:function(h,e){var j=h.currentTarget;var g=$(j).index();var i=this;if(e==1){i.PLpf1=g}else{i.PLpf2=g}$(j).siblings().removeClass("active");$(j).prevAll().addClass("active");$(j).addClass("active")},codeClick:function(l,o){var p=l.currentTarget;var j=$(p).parent().siblings().find(".phoneReg").val();var n=this;if(!(/^1(3|4|5|7|8)\d{9}$/.test(j))){layer.msg("请输入正确的手机号码！")}else{if(n.myself.mobile!=j){layer.msg("您输入的手机号码与绑定的手机号码不一致！");return false}if(this.codes==="获取验证码"){var n=this;var m=Date.parse(new Date());m=m/1000;var k="m="+o+"&mobile="+j+"&timestamp="+m+"&key=6ljH6wpC4vDPy%Ruqlr4JJmG0kLo%^yN";var e={m:o,mobile:j,timestamp:m,sign:md5(k).toUpperCase()};$.ajax({url:"/web_api/messages/send.php",type:"post",data:e,dataType:"json",success:function(b){if(b.Message!="OK"){layer.msg("发送短信过于频繁，请稍后重试")}else{var c=60;n.codes="重新发送("+c+")";var a=setInterval(function(){c--;if(c===0){n.codes="获取验证码";clearInterval(a)}else{n.codes="重新发送("+c+")"}},1000)}}})}}},submit:function(t,p){var v=t.currentTarget;var r=$(v).parent().siblings().find(".phoneReg").val();var w=$(v).parent().siblings().find(".codeReg").val();var e=$(v).parent().siblings().find(".pass1").val();var o=$(v).parent().siblings().find(".pass2").val();if(e==""||o==""){layer.msg("请输入密码！");return false}else{if(e.length>16||e.length<6){layer.msg("请输入6~16位的密码！");return false}else{if(e!=o){layer.msg("您两次输入的密码不一致！");return false}}}var s=Date.parse(new Date());s=s/1000;var n={};if(p=="UserSetPayPassWord"){var q="pay_pwd="+e+"&user_id="+vm.user.uId+"&key=H1ereN3nfdF6wZcoeBdYUfQv7tq1Pq5t";var u=md5(q).toUpperCase();var x="c=PCHome&code="+w+"&m="+p+"&mobile="+r+"&paypassword="+u+"&timestamp="+s+"&key=6ljH6wpC4vDPy%Ruqlr4JJmG0kLo%^yN";n={c:"PCHome",m:p,mobile:r,code:w,paypassword:u,timestamp:s,sign:md5(x).toUpperCase()}}else{var q="pwd="+e+"&key=!qJwHh!8Ln6ELn3rbFMk5c$vW#l13QLe";var u=md5(q).toUpperCase();var x="c=PCHome&code="+w+"&m=UserSetPassWord&mobile="+r+"&pwd="+u+"&timestamp="+s+"&type="+p+"&key=6ljH6wpC4vDPy%Ruqlr4JJmG0kLo%^yN";n={c:"PCHome",m:"UserSetPassWord",mobile:r,type:p,code:w,pwd:u,timestamp:s,sign:md5(x).toUpperCase()}}$.ajax({url:"/web_api/item/index.php",type:"post",data:n,dataType:"json",success:function(a){if(a.status==1){layer.msg("修改成功！",{time:1500,end:function(){$(".close").click();$(v).parent().siblings().find(".phoneReg").val("");$(v).parent().siblings().find(".codeReg").val("");$(v).parent().siblings().find(".pass1").val("");$(v).parent().siblings().find(".pass2").val("")}})}else{layer.msg(a.msg)}}})},handleClick:function(f){var d=this;var e=f.currentTarget;this.index=$(e).index()+1;sessionStorage.setItem("index",this.index);if(!$(e).hasClass("active")){$(e).addClass("active").siblings().removeClass("active")}d.indexClick(this.index)},addrOpen:function(){this.showAddr=true;$(".pick-area").html(" ");$(".pick-area6").pickArea({width:"340",borderColor:"#ff8c00",arrowColor:"#ff8c00",listBdColor:"#ff8c00",color:"#ff8c00",hoverColor:"#ff8c00",getVal:function(){}})},addrNorm:function(d,f){var e=d.currentTarget;$.ajax({url:"/web_api/item/index.php?c=PC_address&m=stat&id="+f,async:true,dataType:"json",success:function(a){if(a.login_status==0){vm.loginModel()}else{layer.msg(a.msg);if(a.status==1){$(e).removeClass("active");$(e).parent().parent().siblings().children().removeClass("active");$(e).parent().parent().siblings().children().find(".normal_btn_set").addClass("active");$(e).parent().parent().children(":first").addClass("active")}}}})},addrUpdate:function(m,j){var n=m.currentTarget;var i=$(n).html();if(i=="修改"){$(n).html("确认").parent().siblings().find(".updInput").attr("disabled",false).css("background","#FBF8D0")}else{var k=$(n).parent().siblings().find(".nameInp").val();var e=$(n).parent().siblings().find(".adrInp").val();var l=$(n).parent().siblings().find(".phoneInp").val();if(k==""){layer.msg("请输入姓名！")}else{if(l==""){layer.msg("请输入联系电话！")}else{$.ajax({url:"/web_api/item/index.php?c=PC_address&m=add_address",async:true,data:{name:k,mobile:l,address:e,id:j},dataType:"json",success:function(a){if(a.login_status==0){vm.loginModel()}else{layer.msg(a.msg);if(a.status==1){$(n).html("修改").parent().siblings().find(".updInput").attr("disabled",true).css("background","transparent")}}}})}}}},addrDel:function(d,f){var e=d.currentTarget;layer.confirm("是否确认删除该地址信息？",{title:"提示！",btn:["确认","取消"]},function(){$.ajax({url:"/web_api/item/index.php?c=PC_address&m=dell",async:true,data:{id:f},dataType:"json",success:function(a){if(a.login_status==0){vm.loginModel()}else{layer.msg(a.msg);if(a.status==1){$(e).parents(".adr_old").remove()}}}})},function(){})},delCart:function(d,f){var e=d.currentTarget;layer.confirm("是否确认删除该商品？",{title:"提示！",btn:["确认","取消"]},function(){$.ajax({url:"/web_api/item/index.php?c=PC_shoppingcar&m=car_del&car_id="+f,async:true,dataType:"json",success:function(a){if(a.login_status==0){vm.loginModel()}else{layer.msg(a.msg);if(a.status==1){if($(e).parents("tbody").find("tr").length==2){$(e).parents("tbody").remove()}else{$(e).parents("tr").remove()}vm.inputNum()}}}})},function(){})},delCartCheck:function(){if(vm.checkedNames!=""){layer.confirm("是否确认删除选中商品？",{title:"提示！",btn:["确认","取消"]},function(){$.ajax({url:"/web_api/item/index.php?c=PC_shoppingcar&m=car_del&car_id="+vm.checkedNames,async:true,dataType:"json",success:function(b){if(b.login_status==0){vm.loginModel()}else{layer.msg(b.msg);if(b.status==1){location.reload()}}}})},function(){})}},orDetail:function(c){var d=window.btoa("aid="+c);window.open("orderDetail.html?"+d)},orderNum:function(){var b=this;$.ajax({url:"/web_api/item/index.php?c=PC_orderlist&m=order_number",async:true,dataType:"json",success:function(a){b.order1Num=a.stay_payment;b.order2Num=a.stay_shipment;b.order3Num=a.stay_take;b.order4Num=a.stay_evaluate}})},orderList:function(f,e){var d=this;d.page=f;$.ajax({url:"/web_api/item/index.php?c=PC_orderlist&m=order_list&pagesize=10",async:true,data:{page:f,list:e},dataType:"json",beforeSend:function(){layer.load(1,{shade:0.3})},success:function(a){layer.closeAll();if(a.login_status==0){vm.loginModel()}else{if(a.status==1){d.myOrder=d.myOrder.concat(a.data.order_list);d.pageTotal=a.data.order_number;d.orderShow=true;$(window).bind("scroll",function(){var c=$(this).scrollTop();var h=$(document).height();var b=$(this).height();if(c+b==h){$(window).unbind("scroll");if(d.page>=d.pageTotal/10){return false}d.page++;d.orderList(d.page,d.statusType)}})}vm.imgHover()}}})},orderStatus:function(g,f){var e=g.currentTarget;var h=this;if(!$(e).hasClass("active")){$(e).addClass("active").siblings().removeClass("active");h.myOrder=[];h.statusType=f;h.orderList(0,h.statusType)}},collectDel:function(c){var d=c.currentTarget;layer.confirm("是否确认删除该店铺？",{title:"提示！",btn:["确认","取消"]},function(){$(d).parents(".collect").remove();layer.closeAll()},function(){})},dorHead:function(c){var d=c.currentTarget;if(!$(d).hasClass("active")){$(d).addClass("active").siblings().removeClass("active")}},onceAgain:function(i){var l=this;var g=[];var j="";var k="";var h="";$.each(l.myOrder,function(a){if(l.myOrder[a].aid==i){g=l.myOrder[a].child_data;h=l.myOrder[a].shop_id}});$.each(g,function(a){j+=g[a].product_id+",";k+=g[a].quantity+","});$.ajax({url:"/web_api/item/index.php?c=PC_orderlist&m=order_shopping_add",type:"get",data:{pro_id:j,number:k,shop_id:h},dataType:"json",success:function(a){if(a.login_status==0){vm.loginModel()}else{if(a.status==0){layer.msg(a.msg)}else{sessionStorage.setItem("index",3);location.reload()}}}})}}});