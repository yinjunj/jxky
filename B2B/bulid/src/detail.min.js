var obj="";var detailVue=new Vue({el:"#index",data:{cartMess:{proId:"",shopId:"",type:"0",moId:"",moZid:"",moType:""},buycarid_proid:"",buyshop_id:"",buymoId:"",buymoZid:"",indexId:0,shareShow:false,nowTime:"",show:false,detail:[],pics:[],cate_title:"",title:"",miaoshu:"",picsDetail:[],picFirst:"",markPriceOld:"",markPrice:"",sealPrice:"",promotion:[],promoShow:false,spec:[],dorShop:[],AppShop:[],appPage:0,num:1,score:"5.0",redStar:5,witStar:0,fixeShow:false,assesShow:true,couponShow:false,minNum:1,stock:0,sale:0,plList:[],biaoqian:"",plHp:0,plZp:0,plCp:0},mounted:function(){var a=this;a.nowTime=new Date().getTime();$.ajax({url:"/web_api/discuss/discuss_manage.php?m=Discuss_list&goods_id="+GetQueryStringAtob("id")+"&status=0",type:"get",async:true,dataType:"json",success:function(b){if(b.status==1){a.plList=b.data;a.biaoqian=b.impression;a.score=(parseInt(b.feedback.hpl)*0.05).toFixed(1);a.redStar=Math.round(parseInt(b.feedback.hpl)*0.05);a.witStar=5-a.redStar;a.plHp=b.hpnumber.hpnumber;a.plZp=b.zpnumber.zpnumber;a.plCp=b.cpnumber.cpnumber;vm.imgHoverBig()}}});$.ajax({url:"/web_api/item/index.php?c=PCGoods&m=IndexGoodsList&call_index=webdztj",type:"get",async:true,dataType:"json",success:function(b){a.dorShop=b.data}});$.ajax({url:"/web_api/item/index.php?c=PCGoods&m=IndexGoodsList&call_index=webptrx",async:true,dataType:"json",success:function(b){a.AppShop=b.data}});$.ajax({url:"/web_api/item/index.php?c=PCGoods&m=GetGoodsInfo",async:false,data:{pid:GetQueryStringAtob("pid"),id:GetQueryStringAtob("id")},dataType:"json",success:function(c){var e=c.data;if(c.status=1){a.detail=e.goods;a.buyshop_id=e.shop.ID;a.spec=e.product;var b="";if(GetQueryStringAtob("pid")==""){a.title=e.product[0].product_title;a.miaoshu=e.product[0].miaoshu;a.picFirst=e.product[0].imgs[0];a.pics=e.product[0].imgs;a.picsDetail=e.product[0].contents_mobi;a.indexId=0;a.markPriceOld=e.product[0].b2c_seal_price;a.markPrice=e.product[0].market_price;a.sealPrice=e.product[0].seal_price;a.stock=e.product[0].stock_headquarters;a.sale=e.product[0].sales;a.cate_title=e.product[0].cate_title;a.minNum=e.product[0].minimum_order_quantity;a.num=e.product[0].minimum_order_quantity;a.cartMess.proId=e.product[0].product_id;a.cartMess.shopId=e.product[0].shop_id;a.cartMess.moType=e.product[0].promotion[0].type;a.buycarid_proid=e.product[0].product_id;b=e.product[0].promotion}$.each(a.spec,function(d){if(a.spec[d].product_id==GetQueryStringAtob("pid")){a.picFirst=e.product[d].imgs[0];a.title=e.product[d].product_title;a.miaoshu=e.product[d].miaoshu;a.pics=e.product[d].imgs;a.picsDetail=e.product[d].contents_mobi;a.indexId=d;a.markPriceOld=e.product[d].b2c_seal_price;a.markPrice=e.product[d].market_price;a.stock=e.product[d].stock_headquarters;a.sale=e.product[d].sales;a.sealPrice=e.product[d].seal_price;a.cate_title=e.product[d].cate_title;a.minNum=e.product[d].minimum_order_quantity;a.num=e.product[d].minimum_order_quantity;a.cartMess.proId=e.product[d].product_id;a.cartMess.shopId=e.product[d].shop_id;a.buycarid_proid=e.product[d].product_id;b=e.product[d].promotion}});$.each(b,function(f){var j=b[f].start_time.replace(new RegExp("-","gm"),"/");var g=b[f].end_time.replace(new RegExp("-","gm"),"/");var d=(new Date(j)).getTime();var h=(new Date(g)).getTime();if(a.nowTime>=d&&a.nowTime<=h){a.promotion.push(b[f]);a.promoShow=true}});if(a.promotion.length!=0){a.cartMess.moId=a.promotion[0].id;a.buymoId=a.promotion[0].id;a.cartMess.moZid="";a.buymoZid="";if(a.promotion[0].gift.length!=0){if(a.promotion[0].zp_type==2){a.cartMess.moZid+=a.promotion[0].gift[0].id+","}else{$.each(a.promotion[0].gift,function(d){a.cartMess.moZid+=a.promotion[0].gift[d].id+","})}$.each(a.promotion[0].gift,function(d){a.buymoZid+=a.promotion[0].gift[d].id+","})}}}}});this.redStar=Math.round(this.score);this.witStar=5-this.redStar;window.addEventListener("scroll",this.handleScroll)},methods:{changePl:function(b){var a=this;$.ajax({url:"/web_api/discuss/discuss_manage.php?m=Discuss_list&goods_id="+GetQueryStringAtob("id")+"&status="+b,type:"get",async:true,dataType:"json",success:function(c){if(c.status==1){a.plList=c.data;vm.imgHoverBig()}}})},handleScroll:function(){var a=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;if(a>=800){this.fixeShow=true}else{this.fixeShow=false}},guige:function(f){var c=f.currentTarget;var d=this;if(!$(c).hasClass("active")){var a=$(c).index();$(c).addClass("active").siblings().removeClass("active");d.markPriceOld=d.spec[a].b2c_seal_price;d.markPrice=d.spec[a].market_price;d.stock=d.spec[a].stock_headquarters;d.sale=d.spec[a].sales;d.title=d.spec[a].product_title;d.miaoshu=d.spec[a].miaoshu;d.sealPrice=d.spec[a].seal_price;d.picFirst=d.spec[a].imgs[0];d.pics=d.spec[a].imgs;d.picsDetail=d.spec[a].contents_mobi;d.minNum=d.spec[a].minimum_order_quantity;d.num=d.spec[a].minimum_order_quantity;d.cartMess.proId=d.spec[a].product_id;d.cartMess.shopId=d.spec[a].shop_id;d.buycarid_proid=d.spec[a].product_id;obj=new mag(".show",".bigshow",".smallshow",".mask",".bigitem",d.pics.length);obj.init();var b=d.spec[a].promotion;d.promotion=[];if(b.length==0){d.promoShow=false;d.cartMess.moId="";d.cartMess.moZid="";d.buymoId="";d.buymoZid=""}else{$.each(b,function(g){var k=b[g].start_time.replace(new RegExp("-","gm"),"/");var h=b[g].end_time.replace(new RegExp("-","gm"),"/");var e=(new Date(k)).getTime();var j=(new Date(h)).getTime();if(d.nowTime>=e&&d.nowTime<=j){d.promotion.push(b[g]);d.promoShow=true}if(d.promotion.length!=0){d.cartMess.moId=d.promotion[0].id;d.buymoId=d.promotion[0].id;d.cartMess.moZid="";d.buymoZid="";if(d.promotion[0].gift.length!=0){if(d.promotion[0].zp_type==2){d.cartMess.moZid+=d.promotion[0].gift[0].id+","}else{$.each(d.promotion[0].gift,function(i){d.cartMess.moZid+=d.promotion[0].gift[i].id+","})}$.each(d.promotion[0].gift,function(i){d.buymoZid+=d.promotion[0].gift[i].id+","})}}})}}},detailClick:function(b){var a=b.currentTarget;if(!$(a).hasClass("active")){$(a).css({background:"#D5282C",color:"#fff"}).siblings().css({background:"transparent",color:"#949494"});$(a).addClass("active").siblings().removeClass("active");this.assesShow=!this.assesShow}},numClick:function(c,a){var b=c.currentTarget;if(a=="-"){if(this.num<=this.minNum){layer.msg("该商品最小起订量为"+this.minNum);this.num=this.minNum;return false}this.num--}else{this.num++}},numInput:function(){if(this.num<this.minNum){layer.msg("该商品最小起订量为"+this.minNum);this.num=this.minNum;return false}},payClick:function(){var b=this;if(vm.loginIs){if(b.num<b.minNum){layer.msg("该商品最小起订量为"+b.minNum)}else{if(b.num>b.stock){layer.msg("库存不足！")}else{var a=window.btoa("carid_proid="+b.buycarid_proid+"&is_car=1&type=0&number="+b.num+"&shop_id="+b.buyshop_id+"&motion_id="+b.buymoId+"&motion_zpid="+b.buymoZid);window.location.href="pay.html?"+a}}}else{vm.loginModel()}}}});window.onload=function(){obj=new mag(".show",".bigshow",".smallshow",".mask",".bigitem",detailVue.pics.length);obj.init();if($(".middle").children().length<=5){$(".smallshow>.next").css({background:"url(bulid/img/glass/next.png) no-repeat",cursor:"not-allowed"})}var a=$(".ptrx>li").height();$(".nextjt").click(function(){var b=$(".ptrx>li").length;if($(".ptrx").position().top<=-188*(b-3)){$(".ptrx").position().top=-188*(b-3)}else{$(".ptrx").animate({top:"-=570"},100)}});$(".prevjt").click(function(){if($(".ptrx").position().top>=0){$(".ptrx").animate({top:0},100)}else{$(".ptrx").animate({top:"+=570"},100)}})};