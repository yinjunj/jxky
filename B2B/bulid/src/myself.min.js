var getObjectURL=function(b){var a=null;if(window.createObjectURL!=undefined){a=window.createObjectURL(b)}else{if(window.URL!=undefined){a=window.URL.createObjectURL(b)}else{if(window.webkitURL!=undefined){a=window.webkitURL.createObjectURL(b)}}}return a};function changepic(c){var a="https://img.aiucar.cn/";var b=$(c);$.ajax({url:"/api/oss/get.php?dir=user",type:"get",async:false,dataType:"json",success:function(e){var i=document.getElementById("form");var j=new FormData;var l=new FormData(i);var k=new Date();var f=k.getTime()+""+Math.random()*100000000000000000;var g=b.attr("name");j.set("key",e.dir+f+".jpg");j.set("policy",e.policy);j.set("OSSAccessKeyId",e.accessid);j.set("success_action_status","200");j.set("expire",e.expire);j.set("host",e.host);j.set("Signature",e.signature);j.append("file",l.get(g));var h=new XMLHttpRequest();h.open("POST",a);h.send(j);h.onreadystatechange=function(){if(h.readyState==4&&h.status==200){img_url_submit(e.dir+f+".jpg");layer.msg("上传成功！")}}}})}function img_url_submit(a){var b=getObjectURL($("#imgHead")[0].files[0]);$.ajax({url:"/web_api/item/index.php?c=PCHome&m=UpdateUsersInfo",async:true,data:{head_img:a},dataType:"json",beforeSend:function(){layer.load(1,{shade:0.3})},success:function(c){layer.closeAll();if(c.login_status==0){vm.loginModel()}else{if(c.status==1){$("#show").attr("src",b)}else{layer.msg(c.msg)}}}})}function qhCred(a){if(!$(a).hasClass("active")){$(a).addClass("active").siblings().removeClass("active");$("#credDrop").children().eq($(a).index()).show().siblings().hide()}}function creditzf(){$("#zffs").find(".addxy").hide();layer.open({type:1,shade:0.3,area:["450px","380px"],title:"支付方式",btn:["确认","取消"],content:$("#zffs"),yes:function(){}})}var myselfs=new Vue({el:"#index",data:{activeDel:{"text-align":"center",color:"#fff",background:"rgba(0,0,0,.4)","font-size":"2em","z-index":"22",position:"absolute",width:"100%",height:"100%",top:"0",left:"0"},page:0,pageTotal:1,show:true,index:1,spDetail:"",showAddr:false,codes:"获取验证码",myCollect:[],collectShow:false,history:[],historyShow:false,myCart:[],cartShow:false,myOrder:[],statusType:"all",order1Num:0,order2Num:0,order3Num:0,order4Num:0,orderShow:false,myAdr:[],adrShow:false,zfType:"zfb",myself:[],PLorder_id:"",PLorder_product_id:"",textVal:"",PLpic:"",PLnum1:0,PLnum2:0,PLnum3:0,PLnum4:0,PLnum5:0,PLpf1:0,PLpf2:0},mounted:function(){var b=this;var a=sessionStorage.getItem("index");if(a!=null){$(".myselfHead>div:nth-child("+a+")").click()}},methods:{dgzhxx:function(){layer.open({type:1,closeBtn:0,anim:2,area:["751px","284px"],shadeClose:true,title:false,content:'<div><img style="width: 751px;height: 284px;" src="../bulid/img/dgzhxx.png" alt=""></div>'})},credit:function(){layer.open({type:1,closeBtn:0,anim:2,area:["360px","360px"],shadeClose:true,title:false,content:'<div><div class="dis_flex credit"><span onclick="qhCred(this)" class="active hoverOpacity">账户明细</span><span onclick="qhCred(this)" class="hoverOpacity">还款金额</span></div><div id="credDrop"><div><ul style="color: #000;max-height: 305px;overflow: auto"><li style="border-bottom: 1px solid #ddd;padding: 8px 15px;" class="dis_flex"><div><div style="font-weight: bold;font-size: 1.1em">订单编号:</div><div style="color: #666">54465PFFSD5456415</div></div><div><div style="font-weight: bold;font-size: 1.1em">信用消费:<span style="color: red">￥33.00</span></div><div style="color: #666">2018-8-08-05 11:22</div></div></li><li style="border-bottom: 1px solid #ddd;padding: 8px 15px;" class="dis_flex"><div><div style="font-weight: bold;font-size: 1.1em">订单编号:</div><div style="color: #666">54465PFFSD5456415</div></div><div><div style="font-weight: bold;font-size: 1.1em">信用消费:<span style="color: red">￥33.00</span></div><div style="color: #666">2018-8-08-05 11:22</div></div></li></ul></div><div class="dis_no" style="font-size: 1.2em;margin-top: 35px;"><div class="dis_flex" style="justify-content: center"><div><div>使用额度：<span style="color: #1CACEC;font-weight: bold">￥5555.55</span></div><div>使用账期：<span>20天</span></div><div style="margin-top: 22px;">本期还款金额：<span style="color: red;font-weight: bold">￥555.55</span></div><div>本期还款日期：<span>2018-08-08</span></div><div onclick="creditzf()" style="margin-top: 22px"><span class="hoverOpacity" style="background: red;display: inline-block;padding: 10px 80px;color: #fff">立即还款</span></div></div></div></div></div></div>'})},orderIdClick:function(b,a){this.PLorder_product_id=b;this.PLorder_id=a},discuss:function(c){var a=c.currentTarget;var b=this;if($(".imgAll").find("li")){$(".imsg").each(function(){b.PLpic+=$(this).attr("value")+","})}$.ajax({url:"/web_api/discuss/discuss_manage.php?m=Off_evaluate",async:true,data:{uid:vm.user.uId,uname:vm.user.userName,order_id:b.PLorder_id,order_product_id:b.PLorder_product_id,content:b.textVal,pic:b.PLpic,num1:b.PLnum1,num2:b.PLnum2,num3:b.PLnum3,num4:b.PLnum4,num5:b.PLnum5,pf1:b.PLpf1,pf2:b.PLpf2},dataType:"json",beforeSend:function(){layer.load(1,{shade:0.3})},success:function(d){layer.closeAll();if(d.status==1){layer.msg("评论成功！",{time:2000,end:function(){$(a).siblings(".btn.btn-default").click()}})}else{layer.msg(d.msg)}}})},sureClick:function(d,b){var a=d.currentTarget;var c=this;if(!$(a).hasClass("active")){$(a).addClass("active").siblings().removeClass("active");c.zfType=b}},payList:function(){if(vm.checkedNames==""){layer.msg("请选择商品！")}else{var a=window.btoa("carid_proid="+vm.checkedNames+"&is_car=0");window.location.href="pay.html?"+a}},indexClick:function(b){var a=this;$(window).unbind("scroll");if(b==1){$.ajax({url:"/web_api/item/index.php?c=PCHome&m=MyCenter",async:true,dataType:"json",beforeSend:function(){layer.load(1,{shade:0.3})},success:function(c){layer.closeAll();if(c.login_status==0){vm.loginModel()}else{if(c.status==1){a.myself=c.data.UserInfo}}}})}else{if(b==2){a.page=0;a.orderNum();a.myOrder=[];a.orderList(a.page,a.statusType)}else{if(b==3){$.ajax({url:"/web_api/item/index.php?c=PC_shoppingcar&m=shopping_list",async:true,dataType:"json",beforeSend:function(){layer.load(1,{shade:0.3})},success:function(c){layer.closeAll();if(c.login_status==0){vm.loginModel()}else{if(c.status==1){a.myCart=c.data;a.cartShow=true}vm.imgHover()}}})}else{if(b==4){$.ajax({url:"/web_api/item/index.php?c=PCGoods&m=UserGoodsCollectList",async:true,dataType:"json",beforeSend:function(){layer.load(1,{shade:0.3})},success:function(c){layer.closeAll();if(c.login_status==0){vm.loginModel()}else{if(c.status==1){a.myCollect=c.data;a.collectShow=true;if(c.data.length==0){a.collectShow=false}}else{a.collectShow=false}}}})}else{if(b==5){$.ajax({url:"/web_api/item/index.php?c=PC_address&m=address",async:true,dataType:"json",beforeSend:function(){layer.load(1,{shade:0.3})},success:function(c){if(c.login_status==0){vm.loginModel()}else{if(c.status==1){a.myAdr=c.data;a.adrShow=true}layer.closeAll()}}})}else{if(b==6){$.ajax({url:"/web_api/item/index.php?c=PCHome&m=GoodsHistoryList",async:true,dataType:"json",beforeSend:function(){layer.load(1,{shade:0.3})},success:function(d){layer.closeAll();if(d.login_status==0){vm.loginModel()}else{if(d.status==1){if(d.data.length==0){a.historyShow=false}else{var c=[];$.each(d.data,function(e){c=c.concat(d.data[e].child_data)});a.history=c;a.historyShow=true}}else{a.historyShow=false}}}})}else{$(window).unbind("scroll")}}}}}}},shfw:function(f){var d=f.currentTarget;var c=$(d).parents("tr").find("td:first-child").html();var b=$(d).parents("tr").find("td:nth-child(2)").html();var a=$(d).parents("tr").find("td:nth-child(3)").html();this.spDetail='<table style="width: 90%;"><tr><td width="80%">'+c+'</td><td width="10%">'+a+'</td><td width="10%" style="text-align: center">'+b+"</td></tr></table>"},qxdd:function(a){layer.confirm("是否确认取消该订单？",{title:"提示！",btn:["确认","取消"]},function(){$.ajax({url:"/web_api/item/index.php?c=PC_orderlist&m=order_cancel&order_id="+a,async:true,dataType:"json",beforeSend:function(){layer.load(1,{shade:0.3})},success:function(b){if(b.login_status==0){vm.loginModel()}else{layer.closeAll();if(b.status==1){layer.msg(b.msg,{shade:0.3,time:1000,end:function(){location.reload()}})}else{layer.msg(b.msg)}}}})})},ljzf:function(b,a){if(a=="Balance"){layer.prompt({title:"请输入支付密码！",formType:1},function(e,d){var c="pay_pwd="+e+"&user_id="+vm.user.uId+"&key=H1ereN3nfdF6wZcoeBdYUfQv7tq1Pq5t";var f=md5(c).toUpperCase();$.ajax({url:"/web_api/item/index.php?c=PC_orderlist&m=pay&order_seqnos="+b,async:true,data:{pay_type:a,pwd:f},dataType:"json",success:function(g){if(g.login_status==0){vm.loginModel()}else{if(g.status==5){layer.msg(g.msg,{time:2000,end:function(){location.reload()}})}else{layer.msg(g.msg)}}}})})}else{$.ajax({url:"/web_api/item/index.php?c=PC_orderlist&m=pay&order_seqnos="+b,async:true,data:{pay_type:a},dataType:"json",success:function(e){if(e.login_status==0){vm.loginModel()}else{if(e.status==2){window.location.href="/web_api/alipay/pagepay/pagepay.php"}else{if(e.status==3){var d=e.data;var g=e.order_id;var f=e.order_seqno;var c=function(){$.ajax({url:"/web_api/item/index.php?c=PC_order&m=query_order",async:false,data:{order_seqno:f,order_id:g},dataType:"json",success:function(i){if(i.status==1){layer.msg(i.msg,{shade:0.3,time:1500,end:function(){location.replace("myself.html");sessionStorage.setItem("index",2)}})}}})};var h=setInterval(c,3000);layer.open({type:1,shade:0.3,area:["240px","270px"],title:false,content:'<div style="padding: 10px;"><div class="tc"><img style="width: 200px;" src="'+d+'" alt=""></div><div style="display: flex; justify-content: space-between; width: 140px; margin: 5px auto;"><div><img src="bulid/img/saoma.png" alt="" style="width: 32px;"></div><div style="color: rgb(148, 148, 148); text-align: left;"><div style="margin-top: -2px;">打开 <span style="color: rgb(255, 69, 2);">手机微信 &nbsp;&nbsp;&nbsp;</span></div><div style="margin-top: -4px;">扫一扫继续支付</div></div></div></div>',end:function(){window.clearInterval(h)}})}else{if(e.status==4){window.location.href="/web_api/unionpay/demo/api_01_gateway/Form_6_2_FrontConsume.php"}else{if(e.status==1){layer.msg(e.msg,{time:1500,end:function(){location.reload()}})}else{layer.msg(e.msg)}}}}}}})}},ggzf:function(b){var a=this;layer.open({type:1,shade:0.3,area:["450px","380px"],title:"修改支付方式",btn:["确认","取消"],content:$("#zffs"),yes:function(){a.ljzf(b,a.zfType)}})},scdd:function(b,c){var a=b.currentTarget;layer.confirm("是否确认删除该订单？",{title:"提示！",btn:["确认","取消"]},function(){$.ajax({url:"/web_api/item/index.php?c=PC_orderlist&m=order_del&order_id="+c,async:true,dataType:"json",success:function(d){if(d.login_status==0){vm.loginModel()}else{if(d.status==1){layer.msg(d.msg,{time:1000,shade:0.3,end:function(){location.reload()}})}else{layer.msg(d.msg)}}}})})},pjSpan:function(d,a){var b=d.currentTarget;var c=this;if(!$(b).hasClass("active")){$(b).addClass("active");if(a==1){c.PLnum1=1}else{if(a==2){c.PLnum2=1}else{if(a==3){c.PLnum3=1}else{if(a==4){c.PLnum4=1}else{c.PLnum5=1}}}}}else{$(b).removeClass("active");if(a==1){c.PLnum1=0}else{if(a==2){c.PLnum2=0}else{if(a==3){c.PLnum3=0}else{if(a==4){c.PLnum4=0}else{c.PLnum5=0}}}}}},star:function(f,b){var c=f.currentTarget;var a=$(c).index();var d=this;if(b==1){d.PLpf1=a}else{d.PLpf2=a}$(c).siblings().removeClass("active");$(c).prevAll().addClass("active");$(c).addClass("active")},codeClick:function(h,d){var c=h.currentTarget;var a=$(c).parent().siblings().find(".phoneReg").val();var f=this;if(!(/^1(3|4|5|7|8)\d{9}$/.test(a))){layer.msg("请输入正确的手机号码！")}else{if(f.myself.mobile!=a){layer.msg("您输入的手机号码与绑定的手机号码不一致！");return false}if(this.codes==="获取验证码"){var f=this;var g=Date.parse(new Date());g=g/1000;var i="m="+d+"&mobile="+a+"&timestamp="+g+"&key=6ljH6wpC4vDPy%Ruqlr4JJmG0kLo%^yN";var b={m:d,mobile:a,timestamp:g,sign:md5(i).toUpperCase()};$.ajax({url:"/web_api/messages/send.php",type:"post",data:b,dataType:"json",success:function(j){if(j.Message!="OK"){layer.msg("发送短信过于频繁，请稍后重试")}else{var e=60;f.codes="重新发送("+e+")";var k=setInterval(function(){e--;if(e===0){f.codes="获取验证码";clearInterval(k)}else{f.codes="重新发送("+e+")"}},1000)}}})}}},submit:function(f,j){var c=f.currentTarget;var h=$(c).parent().siblings().find(".phoneReg").val();var b=$(c).parent().siblings().find(".codeReg").val();var m=$(c).parent().siblings().find(".pass1").val();var k=$(c).parent().siblings().find(".pass2").val();if(m==""||k==""){layer.msg("请输入密码！");return false}else{if(m.length>16||m.length<6){layer.msg("请输入6~16位的密码！");return false}else{if(m!=k){layer.msg("您两次输入的密码不一致！");return false}}}var g=Date.parse(new Date());g=g/1000;var l={};if(j=="UserSetPayPassWord"){var i="pay_pwd="+m+"&user_id="+vm.user.uId+"&key=H1ereN3nfdF6wZcoeBdYUfQv7tq1Pq5t";var d=md5(i).toUpperCase();var a="c=PCHome&code="+b+"&m="+j+"&mobile="+h+"&paypassword="+d+"&timestamp="+g+"&key=6ljH6wpC4vDPy%Ruqlr4JJmG0kLo%^yN";l={c:"PCHome",m:j,mobile:h,code:b,paypassword:d,timestamp:g,sign:md5(a).toUpperCase()}}else{var i="pwd="+m+"&key=!qJwHh!8Ln6ELn3rbFMk5c$vW#l13QLe";var d=md5(i).toUpperCase();var a="c=PCHome&code="+b+"&m=UserSetPassWord&mobile="+h+"&pwd="+d+"&timestamp="+g+"&type="+j+"&key=6ljH6wpC4vDPy%Ruqlr4JJmG0kLo%^yN";l={c:"PCHome",m:"UserSetPassWord",mobile:h,type:j,code:b,pwd:d,timestamp:g,sign:md5(a).toUpperCase()}}$.ajax({url:"/web_api/item/index.php",type:"post",data:l,dataType:"json",success:function(e){if(e.status==1){layer.msg("修改成功！",{time:1500,end:function(){$(".close").click();$(c).parent().siblings().find(".phoneReg").val("");$(c).parent().siblings().find(".codeReg").val("");$(c).parent().siblings().find(".pass1").val("");$(c).parent().siblings().find(".pass2").val("")}})}else{layer.msg(e.msg)}}})},handleClick:function(c){var b=this;var a=c.currentTarget;this.index=$(a).index()+1;sessionStorage.setItem("index",this.index);if(!$(a).hasClass("active")){$(a).addClass("active").siblings().removeClass("active")}b.indexClick(this.index)},addrOpen:function(){this.showAddr=true;$(".pick-area").html(" ");$(".pick-area6").pickArea({width:"340",borderColor:"#ff8c00",arrowColor:"#ff8c00",listBdColor:"#ff8c00",color:"#ff8c00",hoverColor:"#ff8c00",getVal:function(){}})},addrNorm:function(b,c){var a=b.currentTarget;$.ajax({url:"/web_api/item/index.php?c=PC_address&m=stat&id="+c,async:true,dataType:"json",success:function(d){if(d.login_status==0){vm.loginModel()}else{layer.msg(d.msg);if(d.status==1){$(a).removeClass("active");$(a).parent().parent().siblings().children().removeClass("active");$(a).parent().parent().siblings().children().find(".normal_btn_set").addClass("active");$(a).parent().parent().children(":first").addClass("active")}}}})},addrUpdate:function(d,h){var c=d.currentTarget;var a=$(c).html();if(a=="修改"){$(c).html("确认").parent().siblings().find(".updInput").attr("disabled",false).css("background","#FBF8D0")}else{var g=$(c).parent().siblings().find(".nameInp").val();var b=$(c).parent().siblings().find(".adrInp").val();var f=$(c).parent().siblings().find(".phoneInp").val();if(g==""){layer.msg("请输入姓名！")}else{if(f==""){layer.msg("请输入联系电话！")}else{$.ajax({url:"/web_api/item/index.php?c=PC_address&m=add_address",async:true,data:{name:g,mobile:f,address:b,id:h},dataType:"json",success:function(e){if(e.login_status==0){vm.loginModel()}else{layer.msg(e.msg);if(e.status==1){$(c).html("修改").parent().siblings().find(".updInput").attr("disabled",true).css("background","transparent")}}}})}}}},addrDel:function(b,c){var a=b.currentTarget;layer.confirm("是否确认删除该地址信息？",{title:"提示！",btn:["确认","取消"]},function(){$.ajax({url:"/web_api/item/index.php?c=PC_address&m=dell",async:true,data:{id:c},dataType:"json",success:function(d){if(d.login_status==0){vm.loginModel()}else{layer.msg(d.msg);if(d.status==1){$(a).parents(".adr_old").remove()}}}})},function(){})},delCart:function(b,c){var a=b.currentTarget;layer.confirm("是否确认删除该商品？",{title:"提示！",btn:["确认","取消"]},function(){$.ajax({url:"/web_api/item/index.php?c=PC_shoppingcar&m=car_del&car_id="+c,async:true,dataType:"json",success:function(d){if(d.login_status==0){vm.loginModel()}else{layer.msg(d.msg);if(d.status==1){if($(a).parents("tbody").find("tr").length==2){$(a).parents("tbody").remove()}else{$(a).parents("tr").remove()}vm.inputNum()}}}})},function(){})},delCartCheck:function(){if(vm.checkedNames!=""){layer.confirm("是否确认删除选中商品？",{title:"提示！",btn:["确认","取消"]},function(){$.ajax({url:"/web_api/item/index.php?c=PC_shoppingcar&m=car_del&car_id="+vm.checkedNames,async:true,dataType:"json",success:function(a){if(a.login_status==0){vm.loginModel()}else{layer.msg(a.msg);if(a.status==1){location.reload()}}}})},function(){})}},orDetail:function(b){var a=window.btoa("aid="+b);window.open("orderDetail.html?"+a)},orderNum:function(){var a=this;$.ajax({url:"/web_api/item/index.php?c=PC_orderlist&m=order_number",async:true,dataType:"json",success:function(b){a.order1Num=b.stay_payment;a.order2Num=b.stay_shipment;a.order3Num=b.stay_take;a.order4Num=b.stay_evaluate}})},orderList:function(c,a){var b=this;b.page=c;$.ajax({url:"/web_api/item/index.php?c=PC_orderlist&m=order_list&pagesize=10",async:true,data:{page:c,list:a},dataType:"json",beforeSend:function(){layer.load(1,{shade:0.3})},success:function(d){layer.closeAll();if(d.login_status==0){vm.loginModel()}else{if(d.status==1){b.myOrder=b.myOrder.concat(d.data.order_list);b.pageTotal=d.data.order_number;b.orderShow=true;$(window).bind("scroll",function(){var f=$(this).scrollTop();var e=$(document).height();var g=$(this).height();if(f+g==e){$(window).unbind("scroll");if(b.page>=b.pageTotal/10){return false}b.page++;b.orderList(b.page,b.statusType)}})}vm.imgHover()}}})},orderStatus:function(d,a){var b=d.currentTarget;var c=this;if(!$(b).hasClass("active")){$(b).addClass("active").siblings().removeClass("active");c.myOrder=[];c.statusType=a;c.orderList(0,c.statusType)}},collectDel:function(b){var a=b.currentTarget;layer.confirm("是否确认删除该店铺？",{title:"提示！",btn:["确认","取消"]},function(){$(a).parents(".collect").remove();layer.closeAll()},function(){})},dorHead:function(b){var a=b.currentTarget;if(!$(a).hasClass("active")){$(a).addClass("active").siblings().removeClass("active")}},onceAgain:function(f){var c=this;var b=[];var e="";var d="";var a="";$.each(c.myOrder,function(g){if(c.myOrder[g].aid==f){b=c.myOrder[g].child_data;a=c.myOrder[g].shop_id}});$.each(b,function(g){e+=b[g].product_id+",";d+=b[g].quantity+","});$.ajax({url:"/web_api/item/index.php?c=PC_orderlist&m=order_shopping_add",type:"get",data:{pro_id:e,number:d,shop_id:a},dataType:"json",success:function(g){if(g.login_status==0){vm.loginModel()}else{if(g.status==0){layer.msg(g.msg)}else{sessionStorage.setItem("index",3);location.reload()}}}})}}});